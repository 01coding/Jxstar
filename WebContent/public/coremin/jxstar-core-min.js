/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
jdLang={};JxLang={};(function(){var a=function(){Ext.fly("label_company").dom.innerHTML=jx.index.company+" "+jx.index.right+" 2010";Ext.fly("label_usercode").dom.innerHTML=jx.index.usercode;Ext.fly("label_userpass").dom.innerHTML=jx.index.userpass;document.title=jx.index.proname+" V1.0"};var c=function(d,e){if(!d||d.length<2){return d}var h=e.orgTable;var g=e.langTable;var f=new RegExp(h,"ig");return d.replace(f,g)};var b=function(g,n){if(!g||g.length<2){return g}var f="",d="";var o=n.orgTable;var e=n.langTable;var m=g.split(";");var j=m[0].split(".")[0];if(j==o){j=e}for(var h=0;h<m.length;h++){if(m[h].length==0){continue}var l=m[h].split(".");if(l.length>1){j=l[0];if(j==o){j=e}f=j+"."+l[1]}else{f=j+"."+m[h]}d+=f+";"}if(d.length>0){d=d.substr(0,d.length-1)}return d};Ext.apply(JxLang,{BASE:"zh",type:"zh",selectConfig:{},eventLang:function(h,d){if(this.type==this.BASE){return}if(Ext.isEmpty(jeLang)){return}var g,e=d.eventCode;var f=jeLang[h];if(f){g=f[e]}if(Ext.isEmpty(g)){g=(jeLang.sysevent)[e]}if(!Ext.isEmpty(g)){d.text=g}},moduleText:function(d,f){if(this.type==this.BASE){return f}if(Ext.isEmpty(jfLang)){return f}var e=jfLang.module[d];return(e)?e:f},funText:function(f,e){if(this.type==this.BASE){return e}if(Ext.isEmpty(jfLang)){return e}var d=jfLang.fun[f];return(d)?d:e},otherText:function(e,d,g){if(this.type==this.BASE){return g}if(Ext.isEmpty(joLang)){return g}var f=joLang[e][d];return(f)?f:g},fieldLang:function(g){var e=this.type;var f=jdLang[g];if(f){return f[e]}var d="/public/locale/field/"+g+"-lang.js";JxUtil.loadJS(d);if(!jdLang[g]){return}return jdLang[g][e]},formText:function(d,l){for(var g=0,m=d.length;g<m;g++){var f=d[g].name,e=d[g].fieldLabel;if(f&&e&&l){var j=l[f];if(j){d[g].fieldLabel=j}}var h=d[g].items;if(h&&h.length>0){JxLang.formText(h,l)}}},gridField:function(h,e){if(this.type==this.BASE){return}if(e==null||e.length==0){return}if(h==null||h.length==0){return}var g=this.fieldLang(h);if(g==null){return}for(var d=0,j=e.length;d<j;d++){if(e[d].col==null||e[d].field==null){continue}var f=g[e[d].field.name];if(f){e[d].col.header=f}}},formField:function(f,d){if(this.type==this.BASE){return}if(d==null||d.length==0){return}if(f==null||f.length==0){return}var e=this.fieldLang(f);JxLang.formText(d,e);JxLang.formTitle(f,d)},formTitle:function(o,h){for(var g=0,p=h.length;g<p;g++){var e=h[g].items;if(!e){continue}for(var f=0,d=e.length;f<d;f++){var l=e[f].title;e[f].title=JxLang.otherText("formtitle",o+"__"+f,l)}}},langSelectConfig:function(e){if(Jxstar.systemVar.sys__lang__use!="1"){return e}var f=e.nodeId;var d=this.selectConfig[f];if(d){e.nodeId=d.langFunId}else{return e}e.sourceField=b(e.sourceField,d);e.whereSql=c(e.whereSql,d)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
SessionTimer={};(function(){Ext.apply(SessionTimer,{timeLogout:0,warnDialog:null,SESSION_TIMEOUT:30*60,resetTimer:function(){this.timeLogout=this.SESSION_TIMEOUT},startTimer:function(){var c=this.timeLogout;this.timeLogout=c-1;var a=1*60;if(c==0){this.signedOut()}else{if(c<=a){var b=this;var d=function(){b.warnDialog=null;b.resetTimer();var e="funid=queryevent&eventcode=cond_query";e+="&selfunid=login";Request.dataRequest(e,null)};if(this.warnDialog==null){window.focus();this.warnDialog=Ext.MessageBox.show({title:jx.base.hint,msg:c+jx.base.exitsys,buttons:Ext.MessageBox.OK,animEl:"mb9",fn:d,width:200,icon:Ext.MessageBox.INFO})}else{this.warnDialog.updateText(c+jx.base.exitsys)}}}window.setTimeout("SessionTimer.startTimer()",1000)},signedOut:function(){JxUtil.logout(true);JxUtil.isLogout=true;window.location.href=Jxstar.path}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Ext.ns("Jxstar");Jxstar.GridNode=function(a){this.config=a;this.param=a.param;this.selectModel=this.param.selectModel||"";this.nodeId=this.param.funid;this.pageType=this.param.isedit=="1"?"editgrid":"grid";this.define=Jxstar.findNode(this.nodeId);this.event=new Jxstar.GridEvent(this.define);this.page=null;this.parentNodeId="";this.state="0";this.right={edit:"1",print:"1",audit:"1",other:"1"};if(this.state=="0"){JxLang.gridField(this.nodeId,this.param.cols)}};Jxstar.GridNode.prototype={showPage:function(c,b){if(c!=null){this.pageType=c;if(c=="subgrid"&&this.param.isedit=="1"){this.pageType="subeditgrid"}if(c=="grid"&&this.param.isedit=="1"){this.pageType="editgrid"}if(c=="check"){this.pageType="chkgrid"}}var a=Jxstar.systemVar.page__show__subtools;if(a=="1"&&this.pageType.indexOf("sub")>=0){this.param.showTools=true}if(b!=null){this.parentNodeId=b}if(!this.createPage()){return}this.extEvent();if(this.pageType.indexOf("notool")<0){if(!this.define.isCloud||this.pageType.indexOf("sub")<0||this.param.showTools){this.createTool()}}this.initPage();return this.page},createCmAndStore:function(m){if(m==null||m.length==0){JxHint.alert(jx.node.nofields);return false}var n=this;var o=[];var j=[];var a=Jxstar.systemVar.page__grid__state||"0";var q=0,h=0;if(!n.param.noRowNum){var f={renderer:function(w,x,i,y){if(this.rowspan){x.cellAttr='rowspan="'+this.rowspan+'"'}return y+1+Jxstar.startNo}};if(a=="1"){f.header='<div class="x-gray"><i class="fa gear"></i></div>'}var l=new Ext.grid.RowNumberer(f);j[q]=l;q++}var c=(n.pageType=="notoolgrid")||(n.pageType=="combogrid");var r=null;if(n.selectModel=="check"||(n.selectModel==""&&!c)){if(n.sm==null){r=new Ext.grid.CheckboxSelectionModel();r.width=40}else{r=n.sm}j[q]=r;q++}for(var p=0;p<m.length;p++){var u=m[p].col;if(u==null){continue}var s=m[p].field;if(s!=null){o[h++]=s;u.dataIndex=s.name;u.id=s.name}if(n.define.isCloud&&!c&&(n.pageType=="grid"||n.pageType.indexOf("chk")>=0)){var t=n.param.showFormField||n.define.first;if(s&&t.length>0&&(t==s.name||(s.name+"&").indexOf("__"+t+"&")>0)&&!u.renderer){u.renderer=function(w,v,i){return'<a class="x-ashow">'+w+"</a>"};u.listeners={click:function(x,y,A,z){var w=y.getStore();var i=w.getAt(A);var v={define:n.define,grid:y,record:i,store:w};JxCloud.showForm(v)}}}}j[q++]=u}var g=new Ext.grid.ColumnModel(j);var d=Jxstar.path+"/commonAction.do?eventcode=query_data&funid=queryevent&pagetype="+n.pageType;d+="&query_funid="+n.nodeId+"&user_id="+Jxstar.session.user_id;if(n.param.queryurl){d=n.param.queryurl;if(d.indexOf("&user_id=")<0){d+="&user_id="+Jxstar.session.user_id}}var e;if(n.param.storeFn){e=n.param.storeFn(o)}else{e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({method:"POST",url:d,listeners:{exception:function(v,i,z,y,x,w){e.removeAll();x.srcdesc="GridNode.js?url="+d;JxUtil.errorResponse(x)}}}),reader:new Ext.data.JsonReader({root:"data.root",totalProperty:"data.total"},o),remoteSort:true,sortInfo:n.param.sorts,groupField:n.param.groupField,pruneModifiedRecords:true})}e.on("beforeload",function(){Jxstar.startNo=0});var b=function(w,v){Jxstar.st=(new Date()).getTime();var i=w.getModifiedRecords();if(i.length>0){if(confirm(jx.node.reloaddata)){n.event.editSave();return false}}return true};e.on("beforeload",b);n.sm=r;n.cm=g;n.store=e;n.noCheck=c},storeLoad:function(j){var q=this;Jxstar.loadDataBc(q.page);var p=Jxstar.systemVar.show__use__time;if(Ext.isEmpty(p)||p=="1"){Jxstar.et=(new Date()).getTime();var d=Jxstar.et-Jxstar.st;JxHint.hint("use time(ms): "+d)}if(!q.param.noRowNum){var i=j.getCount()+Jxstar.startNo;var f=i.toString().length;var l=q.page.getColumnModel();if(f>4){l.setColumnWidth(0,f*10)}else{var a=l.getColumnWidth(0);if(a>42){l.setColumnWidth(0,40)}}}var o=q.param.initRowH||130;if(this.param.showTools){if(o<155){o=155}}var c=q.param.maxGridH;var h=q.param.autoHeight;var e=q.page.ownerCt;if(e){var g=e.initialConfig.showType;if(!g||g!="inform"){e=null}}if(e&&(Ext.isEmpty(h)||h)){var b=j.getCount();if(b<2){b=2}var m=o+b*34;var n=e.ownerCt.el.dom.className;if(n.indexOf("sub_tab")>0){e=e.ownerCt}if(c&&c<m){m=c}e.setHeight(m);e.doLayout();e.ownerCt.doLayout()}},reconfigGrid:function(a){var b=this;var c=b.page;b.createCmAndStore(a);c.getBottomToolbar().bindStore(b.store);b.store.on("load",b.storeLoad,b);c.reconfigure(b.store,b.cm)},createPage:function(){var a=this;var d=null;var c=Jxstar.systemVar.page__grid__state||"0";var f=a.param.gridLocked;a.createCmAndStore(a.param.cols);var b={cls:a.pageType,border:false,loadMask:true,columnLines:true,store:a.store,cm:a.cm,sm:a.sm,stripeRows:true,enableHdMenu:(a.state!="0"),enableColumnMove:(a.state!="0"||c=="1"),clicksToEdit:1};if(a.param.plugins!=null){b.plugins=a.param.plugins}if(a.pageType.indexOf("notool")<0){if(!a.define.isCloud||a.pageType.indexOf("sub")<0||a.param.showTools){var h=new Ext.Toolbar();b.tbar=h}}if(a.state=="0"&&a.pageType.indexOf("notool")<0&&!a.param.hidePageTool&&(!a.define.showInForm||a.param.showTools)&&(!a.define.isCloud||!a.param.showTools)){var e=a.param.pageSize||Jxstar.pageSize;b.bbar=new Ext.PagingToolbar({deferHeight:true,pageSize:e,store:a.store,cls:"x-pagebar",plugins:(a.pageType!="combogrid")?new Ext.ux.JxPagerTool({pageSize:e}):null,displayInfo:(a.pageType!="combogrid"),displayMsg:jx.node.rows,emptyMsg:jx.node.datano})}var g=a.param.pageConfig;if(!Ext.isEmpty(g)){Ext.apply(b,g)}if(a.pageType.indexOf("edit")>=0||(a.pageType=="chkgrid"&&a.param.isedit=="1")){d=new Ext.grid.EditorGridPanel(b)}else{d=new Ext.grid.GridPanel(b)}if(c=="1"){JxExt.gridStateEvent(d)}if(f){d.locker=new GridLocker({grid:d})}if(d.isXType("editorgrid")){d.on("beforeedit",function(j){var i=j.record;var t=a.define.auditcol;var w=i.get(t);var v="0",u="2",q="6";if(a.define.status){v=a.define.status.audit0;u=a.define.status.audit2}var n=j.grid.getTopToolbar();if(!n){if(a.pageType.indexOf("sub")>=0&&a.define.isCloud){n=JxUtil.getCloudTool(j.grid);if(!n){return true}}else{return true}}var p=JxUtil.getButton(n,"save_eg_chk");if(w==u&&p){return true}if(w==null||w.length==0){w=v}if(w!=v&&w!=q){return false}if(a.right.edit=="0"){return false}var o=JxUtil.getButton(n,"save_eg");if(!o&&a.pageType.indexOf("sub")>=0){var l=j.grid.parentForm;if(l){o=JxUtil.getButton(l.getTopToolbar(),"save")}if(a.define.subChkEdit&&!o){o=JxUtil.getButton(l.getTopToolbar(),"save_chk")}}var m=Jxstar.systemVar.edit__audit__save||"0";if(m=="1"){if(o&&o.disabled){return false}}else{if(o==null||o.disabled){return false}}return true});d.on("keydown",function(l){if(l.getKey()==l.ENTER){var j=this;var m=JxUtil.getRowNum(j);var i=JxUtil.getEditCol(j);if(m<0){m=0}j.startEditing(m,i)}},d)}else{d.on("rowdblclick",function(i,l,j){if(a.pageType=="grid"||a.pageType.indexOf("chk")>=0){a.event.showForm()}else{if(a.pageType=="subgrid"){a.event.showSubForm()}else{if(a.pageType=="import"){a.event.imp()}else{if(a.pageType=="imptype"){a.event.impType()}}}}})}d.getSelectionModel().on("rowselect",function(i,l,j){d.selectKeyId=j.get(a.define.pkcol)});a.store.on("load",a.storeLoad,a);d.on("beforedestroy",function(i){a.sm=null;delete a.sm;a.cm=null;delete a.cm;a.store=null;delete a.store;a.noCheck=null;delete a.noCheck;i.pkName=null;delete i.pkName;i.fkName=null;delete i.fkName;i.fkValue=null;delete i.fkValue;i.pageType=null;delete i.pageType;i.isShow=null;delete i.isShow;i.selectKeyId=null;delete i.selectKeyId;i.jxstarParam=null;delete i.jxstarParam;i.gridNode.destroy();i.gridNode=null;delete i.gridNode;i.cmpTree=null;delete i.cmpTree;i.treeNodeAttr=null;delete i.treeNodeAttr;if(i.qryCt){Ext.destroy(i.qryCt,i.qryCt.el)}i.qryCt=null;delete i.qryCt;i=null;if(d.locker){d.locker.unlock()}return true});if(a.selectModel=="row"||a.noCheck){d.getSelectionModel().singleSelect=true}d.jxstarParam={};d.pkName=a.define.pkcol;d.fkName=a.define.fkcol;d.isShow=a.param.isshow;d.pageType=a.pageType;d.gridNode=a;a.event.setPage(d);a.page=d;if(a.state=="0"&&(a.param.hasQuery==null||a.param.hasQuery==true)){if((Jxstar.systemVar.useCase=="1"||a.param.showQryCase)&&!a.param.showNotQryCase&&!a.param.showTools){d.on("render",function(i){if(Ext.isEmpty(i.tbar)){return}i.qryCt=new Ext.Container({renderTo:i.tbar,cls:"tool-query x-small-editor",height:48})})}}return true},createTool:function(){var c="funid=queryevent&eventcode=query_loadtb&selpfunid="+this.parentNodeId;if(this.state=="1"){c+="&selfunid=sys_fun_base&selpagetype=desgrid"}else{c+="&selfunid="+this.nodeId+"&selpagetype="+this.pageType}var a=this;var b=function(y){if(a.page==null||y==null){return}var r=y.buttons;var A=y.right;if(A){a.right=A}var j=a.event;var f=a.page.getTopToolbar();var l=0;var o=[];for(var v=0,s=r.length;v<s;v++){var d=(a.state=="1")?"sys_fun_base":a.nodeId;JxLang.eventLang(d,r[v]);var u=r[v].showType;if(r[v].method.length>0){var x=j[r[v].method];if(x==null){continue}var B=r[v].args;if(r[v].method=="customEvent"&&(!B||B.length==0)){B=[r[v].eventCode]}r[v].scope=j;if(B!=null&&B.length>0){r[v].handler=x.createDelegate(j,B)}else{x=x.createInterceptor(function(h){return !(h.disabled)});r[v].handler=x}}var e=r[v].iconCls;if(u!="menu"&&e.indexOf("eb_")==0){var t=JxUtil.getRule("."+e+"::before");if(!t){r[v].iconCls="eb_empty"}}var q=r[v].eventIndex;if(q==null||q.length==0){q="0"}q=parseInt(parseInt(q)/100);if(q>l){if(v>0){if(o.length>0){o[o.length]="-"}else{f.add("-")}}l=q}if(u=="menu"){o[o.length]=r[v]}else{var m=r[v].eventCode;if(m.indexOf("create")>=0||m.indexOf("imp")>=0){r[v].cls="x-btn-success"}else{if(m.indexOf("save")>=0||m=="audit"){r[v].cls="x-btn-primary"}}f.add(r[v])}}var p=a.config.toolext;if(a.state=="0"&&p&&typeof p=="function"){p(a,f,o)}var w=o.length;if(w>0&&o[w-1]=="-"){o.splice(w-1,1)}if(o.length>1){var g=new Ext.menu.Menu({items:o});var z={eventCode:"ext_menu",text:jx.cloud.text13,iconCls:"eb_more",menu:g};f.add(z)}else{if(o.length==1){f.add(o[0])}}if(a.state=="0"&&(a.param.hasQuery==null||a.param.hasQuery==true)&&!a.param.showTools){f.add("->");if(Jxstar.systemVar.useCase=="1"){if(a.param.showNotQryCase){Jxstar.simpleQuery(a)}else{JxQuery.showCase(a)}}else{if(a.param.showQryCase){JxQuery.showCase(a)}else{Jxstar.simpleQuery(a)}}}else{if(a.param.showTools&&a.param.hasQuery==true){f.add("->");Jxstar.simpleQuery(a)}}if(a.param.showStat){JxGroup.showCase(a)}if(f.items.getCount()==0){f.hide();a.page.doLayout()}else{f.doLayout()}};Request.dataRequest(c,b)},extEvent:function(){var b=this;var a=this.config.eventcfg;if(a){Ext.apply(this.event,a)}},initPage:function(){var b=this;var a=this.config.initpage;if(typeof a=="function"){a(b)}},setState:function(a){this.state=a},destroy:function(){this.config=null;delete this.config;this.param=null;delete this.param;this.selectModel=null;delete this.selectModel;this.nodeId=null;delete this.nodeId;this.pageType=null;delete this.pageType;this.id=null;delete this.id;this.define=null;delete this.define;this.event.myDestroy();this.event=null;delete this.event;this.page=null;delete this.page;this.parentNodeId=null;delete this.parentNodeId;this.state=null;delete this.state;this.right=null;delete this.right}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Ext.ns("Jxstar");Jxstar.FormNode=function(b){this.config=b;this.param=b.param;this.nodeId=this.param.funid;this.pageType="form";this.define=Jxstar.findNode(this.nodeId);this.event=new Jxstar.FormEvent(this.define);this.page=null;this.parentNodeId="";this.state="0";this.right={edit:"1",print:"1",audit:"1",other:"1"};if(this.state=="0"){JxLang.formField(this.nodeId,this.param.items);if(this.define.isCloud){var a=this.define.subfunid;if(a.length>0){if(a.split(",").length>1){JxFormSub.formAddTab(b)}else{JxFormSub.formAddSub(b)}}}}};Jxstar.FormNode.prototype={showPage:function(b,a){if(b!=null){this.pageType=b}if(a!=null){this.parentNodeId=a}if(!this.createPage()){return}this.extEvent();this.createTool();this.initPage();return this.page},createPage:function(){var a=this,e=a.param;if(e==null||e.items==null||e.items.length==0){JxHint.alert(jx.node.nofields);return false}var g=new Ext.Toolbar();if(e.items[0]){var c=e.formWidth||(a.define.isCloud?"80%":800);if(typeof c=="string"){e.items[0].anchor=c}else{e.items[0].width=c}}var b={style:"margin-right:5px;",labelAlign:e.labelAlign||"right",labelWidth:e.labelWidth||120,border:false,autoScroll:true,frame:false,tbar:g,items:e.items};var f=a.param.pageConfig;if(!Ext.isEmpty(f)){Ext.apply(b,f)}var d=new Ext.form.FormPanel(b);d.on("afterrender",function(i){var h=i.getWidth();if(h<800){i.getComponent(0).setWidth(h-20)}JxUtil.focusFirst(i)});if(a.define.isFormTab){d.on("render",JxCloud.showTabTooler)}d.on("beforedestroy",function(h){var i=h.getForm();i.myGrid=null;delete i.myGrid;i.myRecord=null;delete i.myRecord;i.myStore=null;delete i.myStore;i.fkName=null;delete i.fkName;i.fkValue=null;delete i.fkValue;i.srcEvent=null;delete i.srcEvent;h.formNode.destroy();h.formNode=null;delete h.formNode;h=null;return true});d.formNode=a;a.event.setPage(d);a.page=d;return true},createTool:function(){var c="funid=queryevent&eventcode=query_loadtb&selpfunid="+this.parentNodeId;if(this.state=="1"){c+="&selfunid=sys_fun_base&selpagetype=desform"}else{c+="&selfunid="+this.nodeId+"&selpagetype="+this.pageType}var a=this;var b=function(z){if(a.page==null||z==null){return}var r=z.buttons;var A=z.right;if(A){a.right=A}var g=a.event;var e=a.page.getTopToolbar();var j=0;var o=[];for(var w=0,s=r.length;w<s;w++){JxLang.eventLang(a.nodeId,r[w]);if(r[w].pageType.indexOf("notitle")>=0){r[w].tooltip=r[w].text;r[w].text=""}var u=r[w].showType;if(r[w].method.length>0){var x=g[r[w].method];if(x==null){continue}var B=r[w].args;if(r[w].method=="customEvent"){B=[r[w].eventCode]}r[w].scope=g;if(B!=null&&B.length>0){r[w].handler=x.createDelegate(g,B)}else{x=x.createInterceptor(function(h){return !(h.disabled)});r[w].handler=x}}var d=r[w].iconCls;if(u!="menu"&&d.indexOf("eb_")==0){var t=JxUtil.getRule("."+d+"::before");if(!t){r[w].iconCls="eb_empty"}}var q=r[w].eventIndex;if(q==null||q.length==0){q="0"}q=parseInt(parseInt(q)/100);if(q>j&&e.items){var v=e.items.last();if(w>0&&v&&!v.isXType("tbseparator")){e.add("-")}j=q}if(u=="menu"){o[o.length]=r[w]}else{var m=r[w].eventCode;if(m.indexOf("create")>=0){r[w].cls="x-btn-success"}else{if(m.indexOf("save")>=0||m=="audit"){r[w].cls="x-btn-primary"}}e.add(r[w])}}var p=a.config.toolext;if(p&&typeof p=="function"){p(a,e,o)}if(o.length>1){var f=new Ext.menu.Menu({items:o});e.add({eventCode:"ext_menu",text:jx.cloud.text13,iconCls:"eb_more",menu:f})}else{if(o.length==1){e.add(o[0])}}if(a.define.isCloud&&a.pageType.indexOf("sub")<0){e.insert(0,{tooltip:jx.cloud.text26,iconCls:"fa-reply",handler:function(){var h=function(){var l=JxCloud.apps[a.nodeId];if(!l){return}var n=l.getLayout();n.setActiveItem(0);n.activeItem.doLayout();var i=l.getComponent(0).getComponent(0);if(i&&i.isXType("grid")){if(i.qryCt){i.qryCt.doLayout()}}};if(JxUtil.isModifyForm(a.page)){Ext.Msg.confirm(jx.base.hint,jx.cloud.text37,function(i){if(i=="yes"){h()}})}else{h()}}})}e.doLayout();if(a.define.isFormTab){var y=e.get(0).el.up("td.x-toolbar-left").child("table");y.up("div.x-tab-toolbar").setWidth(y.getWidth()+40)}};Request.dataRequest(c,b)},extEvent:function(){var b=this;var a=this.config.eventcfg;if(a){Ext.apply(this.event,a)}},initPage:function(){var a=this;a.page.getForm().fieldItems().each(function(d){var c=d.name;if(c!=null&&c.length>0){d.on("change",JxUtil.changeValue);d.on("specialkey",JxUtil.specialKey)}});JxFormSub.formShowSub(a);var b=a.config.initpage;if(typeof b=="function"){b(a)}},setState:function(a){this.state=a},destroy:function(){this.config=null;delete this.config;this.param=null;delete this.param;this.nodeId=null;delete this.nodeId;this.pageType=null;delete this.pageType;this.id=null;delete this.id;this.define=null;delete this.define;this.event.myDestroy();this.event=null;delete this.event;this.page=null;delete this.page;this.parentNodeId=null;delete this.parentNodeId;this.state=null;delete this.state;this.right=null;delete this.right}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxUtil={};(function(){var rules=null;Ext.apply(JxUtil,{isLogout:false,logout:function(isF5){var hdcall=function(){var params="funid=login&pagetype=login&eventcode=logout";Request.postRequest(params,function(){JxUtil.isLogout=true;var href=Jxstar.path;if(JxLang.curLang){href=Jxstar.path+"/index.jsp?currLang="+JxLang.curLang}if(Jxstar.logoutUrl){if(JxLang.curLang){href=Jxstar.logoutUrl+"&currLang="+JxLang.curLang}else{href=Jxstar.logoutUrl}}window.location.href=href})};if(isF5==true){return}Ext.Msg.confirm(jx.base.hint,jx.base.logoutok,function(btn){if(btn=="yes"){hdcall()}})},getRule:function(selector){if(rules==null){rules={};var ss=document.styleSheets;var len=ss.length;var str="";for(var i=0;i<len;i++){if(ss[i].href&&ss[i].href.indexOf("main.css")>=0){var css=ss[i].cssRules;for(var j=0;j<css.length;j++){var names=css[j].selectorText.toLowerCase().split(",");for(var k=0;k<names.length;k++){var n=names[k].trim();if(n.length>0){rules[n]=css[j]}str+=n+"; "}}}}}if(rules){return rules[selector.toLowerCase()]}},putRightNodes:function(datas){for(var i=0;i<datas.length;i++){var m=datas[i];if(m.leaf){Jxstar.rightNodes.push(m.id)}else{if(m.children){JxUtil.putRightNodes(m.children)}}}},strToNum:function(content){content=content.replace(/\"/g,"#o034");content=content.replace(/\'/g,"#o039");content=content.replace(/\r\n/g,"#o013#o010");content=content.replace(/\r/g,"#o013");content=content.replace(/\n/g,"#o010");content=content.replace(/\t/g,"#o009");content=content.replace(/\\/g,"#o092");content=content.replace(/&/g,"#o025");content=content.replace(/\+/g,"#o02B");content=content.replace(/%/g,"#o026");return content},numToStr:function(content){content=content.replace(/\#o034/g,'"');content=content.replace(/\#o039/g,"'");content=content.replace(/\#o013#o010/g,"\r\n");content=content.replace(/\#o010/g,"\n");content=content.replace(/\#o013/g,"\r");content=content.replace(/\#o009/g,"\t");content=content.replace(/\#o092/g,"\\");content=content.replace(/\#o025/g,"&");content=content.replace(/\#o02B/g,"+");content=content.replace(/\#o026/g,"%");return content},getId:function(){var t=(new Date()).getTime();t++;return"jx-"+t},calTreeLevel:function(treeId){if(!treeId||treeId.length==0||treeId.length<4){return 0}if(treeId.indexOf("-")>=0){treeId=treeId.split("-")[1]}return Math.floor(treeId.length/4)},eval:function(js){try{if(window.execScript){window.execScript(js)}else{window.eval(js)}}catch(e){console.error("JxUtil.eval "+js+"; error: "+e)}},showImpWin:function(params,hdcall){var queryForm=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",defaults:{anchor:"95%",allowBlank:false,msgTarget:"side"},items:[{xtype:"fileuploadfield",useType:"file",fieldLabel:jx.event.selfile,name:"import_file",buttonText:"",maxLength:200,buttonCfg:{iconCls:"upload_icon"}}]});var self=this;var win=new Ext.Window({title:"选择文件",layout:"fit",width:400,height:170,resizable:false,modal:true,closeAction:"close",items:[queryForm],buttons:[{text:jx.base.ok,handler:function(){var form=queryForm.getForm();if(!form.isValid()){return}var hd=function(data){win.close();if(hdcall){hdcall(data)}};Request.fileRequest(form,params,hd)}},{text:jx.base.cancel,handler:function(){win.close()}}]});win.show()},loadIM:function(ct){var showed=Jxstar.systemVar.sys__im__showed||"0";if(showed.length==0||showed=="0"){return}var el=ct.getComponent(0).getEl();var imicon=el.insertHtml("afterBegin",'<div id="div_imicon" class="x-imicon" title="企业微信"><i class="fa fa-weixin"></i><span class="badge badge-important pull-top"></span></div>');window.imicon=imicon;Ext.get(imicon).on("click",function(){JxUtil.showIM()});var params="funid=im_event&eventcode=im_login";Request.postRequest(params,function(data){var str=Ext.encode(data);localStorage.setItem("curruser_im",str)})},showIM:function(){window.open(Jxstar.path+"/cloud/im/index.html?_dc="+(new Date()).getTime())},showUser:function(){var userid=Jxstar.session.user_id;var define=Jxstar.findNode("sys_user");JxUtil.openFunPage(define,define.formpage,"个人设置",userid)},showTenants:function(){var ts=Jxstar.tenants,e=encodeURIComponent;if(!ts){return}var login=function(ten){var params="funid=login&pagetype=login&eventcode=logout";Request.postRequest(params,function(){var params="funid=login_event&eventcode=cloud_login&user_code="+Jxstar.session.user_code+"&user_pwd="+ts.myx+"&not_verify=1&tenant_id="+ten.tenant_id+"&tenant_name="+e(ten.tenant_name);Request.postRequest(params,function(data){win.close();Jxstar.viewport.destroy();Jxstar.session=data;Request.loadJS("/public/core/JxBody.js")},{errorcall:function(){window.location.href=Jxstar.path+"/index.jsp"}})})};var items=[],hi=80,v=ts.info;for(var i=0;i<v.length;i++){hi+=60;items[i]={xtype:"button",ten:v[i],text:v[i].tenant_name,width:250,height:40,margins:"20 20 0 20",handler:function(b){login(b.initialConfig.ten)}}}var win=new Ext.Window({title:"选择公司",width:300,height:hi,layout:"vbox",items:items});win.show()},onLineUser:function(){var hdcall=function(grid){Jxstar.loadInitData(grid)};var define=Jxstar.findNode("sys_user_login");Jxstar.showData({filename:define.gridpage,title:define.nodetitle,pagetype:"notool",width:600,height:350,callback:hdcall})},loadJxData:function(){Ext.fly("loading").dom.innerHTML=jx.util.loading;Ext.fly("loading").show();JxUtil.loadJS("/public/data/NodeDefine.js",true);JxUtil.loadJS("/public/data/RuleData.js",true);JxUtil.loadJS("/public/locale/combo-lang-"+JxLang.type+".js",true);Ext.fly("loading").hide()},loadJxGraph:function(){if(!window.mxClient){var fileName="mxclient-ff.jsgz";if(Ext.isIE){fileName="mxclient-ie.jsgz"}else{if(Ext.isChrome){fileName="mxclient-ch.jsgz"}}JxUtil.loadJS("/lib/graph/js/"+fileName);window.mxClient=mxClient}},loadJS:function(url,nocache){if(url.charAt(0)!="/"){url="/"+url}url=Jxstar.path+url;if(nocache===true){var dc="?dc="+(new Date()).getTime();url+=dc}var req=new XmlRequest("GET",url,false);req.send();var js=req.getText();try{if(window.execScript){window.execScript(js)}else{window.eval(js)}}catch(e){console.error("JxUtil.loadJS "+url+"; error: "+e)}},loadCss:function(url,nocache){if(url.charAt(0)!="/"){url="/"+url}url=Jxstar.path+url;if(nocache===true){var dc="?dc="+(new Date()).getTime();url+=dc}var element=document.createElement("link");element.setAttribute("rel","stylesheet");element.setAttribute("type","text/css");element.setAttribute("href",url);document.getElementsByTagName("head")[0].appendChild(element);return element},loadCharts:function(){if(typeof echarts=="undefined"){JxUtil.loadJS("/lib/echarts/echarts.min.js");JxUtil.loadJS("/lib/echarts/dark.js")}},isAdminUser:function(){var roleId=Jxstar.session.role_id;return(roleId.indexOf("admin")>=0)},firstRow:function(grid){if(!grid){return[]}var records=JxUtil.getSelectRows(grid);if(records.length>0){return records}var s=grid.getStore();var cnt=s.getCount();if(cnt==0){return[]}var sm=grid.getSelectionModel();if(sm.getSelections){sm.selectFirstRow()}else{sm.select(0,0)}return[s.getAt(0)]},showAuditFlag:function(fe){var auditcol=fe.define.auditcol;if(Ext.isEmpty(auditcol)){return}var record=fe.form.myRecord;if(Ext.isEmpty(record)){return}var getx=function(s){var vs=Jxstar.findComboData("audit");for(var i=0,n=vs.length;i<n;i++){if(vs[i][0]==s){return vs[i][1]}}return""};var fg=fe.form.getEl().child("div.x-fflag");var state=record.get(auditcol);var msg=getx(state);if(state=="0"||state=="1"||state=="6"||state=="7"){if(fg){fg.hide()}return}else{if(state=="3"){if(fg){fg.show();fg.removeClass("x-fflag-blue");fg.dom.innerHTML=msg}else{fe.form.getEl().insertHtml("afterBegin",'<div class="x-fflag">'+msg+"</div>")}}else{if(state=="2"||state=="4"||state=="5"){if(fg){fg.show();fg.addClass("x-fflag-blue");fg.dom.innerHTML=msg}else{fe.form.getEl().insertHtml("afterBegin",'<div class="x-fflag x-fflag-blue">'+msg+"</div>")}}}}},insertEmpty:function(combo){if(!combo){return}var st=combo.store;if(!st){return}var cnt=st.getCount();if(cnt==0){return}var record=new (st.reader.recordType)({value:"",text:jx.star.select});st.insert(0,record)},getColumnIndex:function(grid,colname){var isCheck=grid.getSelectionModel() instanceof Ext.grid.CheckboxSelectionModel;var mycols=grid.gridNode.param.cols;for(var i=0,n=mycols.length;i<n;i++){if(mycols[i].col.name==colname){return i+(isCheck?2:1)}}return -1},validateGrid:function(grid){var isReqCheck=true,myForm=null,nnfs=null;if(grid.isXType("editorgrid")==false){var f=JxUtil.getMyForm(grid);if(f){myForm=f.getForm()}else{f=JxUtil.getCloudForm(grid);if(f){myForm=f.getForm()}else{nnfs=grid.gridNode.param.notNullFields;if(!nnfs||nnfs.length==0){isReqCheck=false}}}}if(isReqCheck==false){return true}var cm=grid.getColumnModel();var records=JxUtil.getSelectRows(grid);var hint=function(record,name){var index=grid.getStore().indexOf(record);var label=cm.getColumnHeader(cm.findColumnIndex(name));var hint=String.format(jx.event.auditvalid,index+1,label);JxHint.alert(hint);return false};for(var i=0;i<records.length;i++){var record=records[i];var fields=record.fields.keys;for(var j=0;j<fields.length;j++){var name=fields[j];var value=record.data[name];if(value==null){value=""}if(nnfs&&nnfs.length>0){if(nnfs.indexOf(name+";")>=0&&value.length==0){return hint(record,name)}}var field=null;if(grid.isXType("editorgrid")){var colIndex=cm.findColumnIndex(name);var rowIndex=grid.getStore().indexOfId(record.id);var editor=cm.getCellEditor(colIndex,rowIndex);if(editor){field=editor.field}}else{if(myForm){field=myForm.findField(name)}}if(field!=null&&!field.validateValue(value)){return hint(record,name)}}}return true},checkSubGrid:function(fpage){var subps=fpage.subgrids;if(subps==null||subps.length==0){return true}for(var i=0;i<subps.length;i++){var subgrid=subps[i].getComponent(0);if(subgrid.isXType("grid")){var store=subgrid.getStore();var mrow=store.getModifiedRecords();if(mrow.length>0){JxHint.alert(subps[i].title+jx.util.subno);return false}}}return true},addAttachCombo:function(grid,combocode,index){index=index||0;grid.attachTypeCombo=function(){var typedata=Jxstar.findComboData(combocode);return{anchor:"60%",xtype:"combo",name:"attach_type_combo",fieldLabel:jx.util.doctype,store:new Ext.data.SimpleStore({fields:["value","text"],data:typedata}),emptyText:jx.star.select,mode:"local",triggerAction:"all",valueField:"value",displayField:"text",editable:false,value:typedata[index][0]}}},getMyForm:function(myGrid){var tabPanel=myGrid.findParentByType("tabpanel");if(tabPanel==null){return null}if(tabPanel.getComponent(1)==null){return null}var formPanel=tabPanel.getComponent(1).getComponent(0);if(formPanel==null||!formPanel.isXType("form")){return null}return formPanel},getCloudForm:function(myGrid){var funid=myGrid.gridNode.nodeId;var layout=JxCloud.apps[funid];if(!layout){return}var fpage=layout.getComponent(1);if(!fpage){return}var cform=fpage.getComponent(0);if(!cform||cform.isXType("form")==false){cform=fpage.getComponent(0).getComponent(0)}return cform},getMyGrid:function(myForm){var tabPanel=myForm.findParentByType("tabpanel");if(!tabPanel||tabPanel.isXType("tabpanel")==false){return}var grid=tabPanel.getComponent(0).getComponent(0);if(!grid||grid.isXType("grid")==false){return}return grid},getParentGrid:function(childCmp){if(!childCmp){return}var pg=childCmp.parentGrid;if(pg&&pg.isXType("grid")){return pg}var gn=childCmp.gridNode;if(gn&&gn.define.isCloud){return JxUtil.getParentForm(childCmp).myGrid}var tabPanel=childCmp.findParentByType("tabpanel");if(!tabPanel||tabPanel.isXType("tabpanel")==false){return}var grid=tabPanel.getComponent(0).getComponent(0);if(!grid||grid.isXType("grid")==false){return}return grid},getParentForm:function(subGrid,isCmp){var form=subGrid.findParentByType("form");if(Ext.isEmpty(form)){var tabPanel=subGrid.findParentByType("tabpanel");if(!tabPanel){return null}var pform=tabPanel.getComponent(1);if(!pform){return null}form=pform.getComponent(0);if(!form||form.isXType("form")==false){return null}}if(isCmp){return form}else{return form.getForm()}},getLayoutTree:function(childCmp){var tabPanel;if(childCmp.formNode){var define=childCmp.formNode.define;if(define.isCloud){tabPanel=JxCloud.apps[define.nodeid]}}if(!tabPanel){tabPanel=childCmp.findParentByType("tabpanel");if(!tabPanel||tabPanel.isXType("tabpanel")==false){return null}}var tree=tabPanel.ownerCt.ownerCt.getComponent(0).getComponent(0);if(!tree||tree.isXType("treepanel")==false){return null}return tree},treeAddCheck:function(tree){if(!tree){return}var tool=tree.getTopToolbar();var tools=tree.getTopToolbar().find("xtype","checkbox");if(tools.length>0){return}tool.insert(1,"->");tool.insert(2,{xtype:"checkbox",boxLabel:jx.util.curlevel});tool.doLayout()},viewSumData:function(grid){var bbar=grid.getBottomToolbar();if(!bbar){return}var sumdata=grid.getStore().reader.jsonData.data.sum;if(Ext.isEmpty(sumdata)){return}sumdata=sumdata[0];var cm=grid.getColumnModel();var sumText=jx.util.total;Ext.iterate(sumdata,function(key,value){var header=cm.getColumnById(key).header;sumText+=header+"："+value+" "});var sumItem=bbar.sumItem;if(Ext.isEmpty(sumItem)){var idx=bbar.items.indexOf(bbar.refresh);sumItem=new Ext.Toolbar.TextItem(sumText);bbar.insert(idx+1,new Ext.Toolbar.Separator());bbar.insert(idx+2,sumItem);bbar.sumItem=sumItem}else{sumItem.setText(sumText)}bbar.doLayout()},formWindow:function(config){var formcfg={layout:"form"};formcfg=Ext.apply(formcfg,config.formcfg||{});var winForm=new Ext.form.FormPanel(formcfg);var self=this;var wincfg={title:jx.base.inputtext,layout:"fit",width:config.width||400,height:config.height||160,resizable:false,modal:true,closeAction:"close",items:[winForm],buttons:[{text:jx.base.ok,handler:function(){if(config.okcall){config.okcall(winForm.getForm(),win)}else{win.close()}}},{text:jx.base.cancel,handler:function(){if(config.nocall){config.nocall(win)}else{win.close()}}}]};wincfg=Ext.apply(wincfg,config.wincfg||{});var win=new Ext.Window(wincfg);win.show()},setPass:function(userId,loginFn){var passForm=new Ext.form.FormPanel({layout:"form",labelAlign:"right",style:"padding:20px 10px 0 0 ;",border:false,frame:false,baseCls:"x-plain",items:[{xtype:"textfield",fieldLabel:jx.sys.oldpwd,name:"modfiy_pass__old_pass",inputType:"password",allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",anchor:"100%",maxLength:20},{xtype:"textfield",fieldLabel:jx.sys.newpwd,id:"modfiy_pass__new_pass",inputType:"password",allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",anchor:"100%",maxLength:20},{xtype:"textfield",fieldLabel:jx.sys.conpwd,id:"modfiy_pass__confirm_pass",inputType:"password",allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",anchor:"100%",maxLength:20}]});var win=new Ext.Window({title:jx.sys.modpwd,layout:"fit",width:350,height:260,resizable:false,modal:true,closeAction:"close",items:[passForm],buttons:[{text:jx.base.ok,handler:function(){if(!passForm.getForm().isValid()){JxHint.alert(jx.event.datavalid);return}var myform=passForm.getForm();var oldpass=myform.findField("modfiy_pass__old_pass").getValue();var newpass=myform.findField("modfiy_pass__new_pass").getValue();var confirmpass=myform.findField("modfiy_pass__confirm_pass").getValue();if(newpass!=confirmpass){JxHint.alert(jx.sys.twopwd);return}var params="funid=sys_user&oldpass="+oldpass+"&newpass="+newpass;params+="&keyid="+userId;params+="&pagetype=editgrid&eventcode=setpass";Request.postRequest(params,function(data,extd){win.close();if(loginFn){loginFn()}})}},{text:jx.base.cancel,handler:function(){win.close()}}]});win.show()},showCheckEdit:function(nodeId,dataId,form){var self=this;var hdCall=function(data){var editFields=data.editFields;if(editFields.length==0){return}var fields=editFields.split(";");for(var i=0;i<fields.length;i++){if(fields[i].length>0){var field=form.findField(fields[i].replace(".","__"));if(field){field.setReadOnly(false)}}}};var params="funid=wf_assign&pagetype=chkgrid&eventcode=queryfield";params+="&check_funid="+nodeId+"&keyid="+dataId;Request.dataRequest(params,hdCall)},showCheckField:function(nodeId,dataId,form,pos,isaudit){var self=this;var sets=function(cols,type){if(!cols||cols.length==0){return}var fields=cols.split(";");for(var i=0;i<fields.length;i++){var fn=fields[i].replace(".","__");if(fn.length==0){continue}var field=form.findField(fn);if(!field){continue}if(type=="0"){field.setReadOnly(false)}else{if(type=="1"){field.setReadOnly(true)}else{if(type=="2"){field.show()}else{field.hide()}}}}};var hdCall=function(data){if(!isaudit){sets(data.editFields,"0")}sets(data.onlyFields,"1");sets(data.showFields,"2");sets(data.hideFields,"3")};var params;if(pos=="0"){params="funid=wf_node_field&eventcode=startfield&wf_funid="+nodeId+"&data_id="+dataId}else{if(pos=="1"){params="funid=wf_node_field&eventcode=wffields&wf_funid="+nodeId+"&data_id="+dataId}else{params="funid=wf_node_field&eventcode=prefield&nodeid="+nodeId+"&processid="+dataId}}Request.dataRequest(params,hdCall)},showCheckEdit:function(nodeId,dataId,form,toolBar){var self=this;var hdCall=function(data){var editFields=data.editFields;if(editFields.length==0){return}var fields=editFields.split(";");for(var i=0;i<fields.length;i++){if(fields[i].length>0){var field=form.findField(fields[i].replace(".","__"));if(field){field.setReadOnly(false)}}}};var params="funid=wf_assign&pagetype=chkgrid&eventcode=queryfield";params+="&check_funid="+nodeId+"&keyid="+dataId;Request.dataRequest(params,hdCall)},showCheckData:function(nodeId,dataId,userId){var define=Jxstar.findNode(nodeId);if(define==null){JxHint.alert(String.format(jx.star.nopage,nodeId));return false}if(Ext.isEmpty(define.showform)){define.showform="form"}var pkcol=define.pkcol.replace("__",".");var pageParam={pageType:"check",whereSql:" exists (select * from wf_assign where run_state = ? and assign_userid = ? and fun_id = ? and data_id = "+pkcol+")",whereValue:"0;"+userId+";"+nodeId,whereType:"string;string;string",showType:define.showform,updateId:dataId};if(Ext.isEmpty(define.checkPage)){Jxstar.createNode(nodeId,pageParam)}else{var pageUrl=define.checkPage;var title=define.nodetitle+jx.base.check;JxUtil.openFunPage(define,pageUrl,title,dataId,null,"chkform")}},openFunPage:function(define,pageurl,title,dataid,hdcall,ptype){if(Ext.isString(define)){define=Jxstar.findNode(define);if(define==null){JxHint.alert(String.format(jx.star.nopage,nodeId));return}}var id="fun_"+define.nodeid+"_xx";Request.loadJS(pageurl,function(f){if(!ptype){ptype="form"}var page=f().showPage(ptype);var mainTab=Jxstar.sysMainTab;var funTab=mainTab.getComponent(id);if(funTab!=null){mainTab.remove(funTab,true);funTab=null}funTab=mainTab.add({id:id,label:title,border:false,layout:"fit",closable:true,iconCls:"function",items:[page]});mainTab.activate(funTab);var pkcol=define.pkcol.replace("__",".");var mycall=function(page){var options={where_sql:pkcol+" = ?",where_type:"string",where_value:dataid,callback:function(data){if(data.length>0){var r=page.formNode.event.newRecord(data[0]);page.getForm().myRecord=r;page.getForm().loadRecord(r);page.formNode.event.initForm()}}};Jxstar.queryData(define.nodeid,options)};if(!hdcall){hdcall=mycall}hdcall(page)})},showCheckHisData:function(nodeId,dataId,userId){var define=Jxstar.findNode(nodeId);if(define==null){JxHint.alert(String.format(jx.star.nopage,nodeId));return false}var pkcol=define.pkcol.replace("__",".");var pageParam={pageType:"chkqry",whereSql:pkcol+" = ?",whereValue:dataId,whereType:"string",showType:"form",updateId:dataId};if(Ext.isEmpty(define.checkPage)){Jxstar.createNode(nodeId,pageParam)}else{var pageUrl=define.checkPage;var title=define.nodetitle;JxUtil.openFunPage(define,pageUrl,title,dataId)}},showCheckWindow:function(appData,fileName){var hdCall=function(f){f.showWindow(appData)};Request.loadJS("/jxstar/studio/pub/"+fileName+".js",hdCall)},showFormData:function(funId,dataId){var define=Jxstar.findNode(funId);var pkcol=define.pkcol.replace("__",".");var hdcall=function(page){var options={where_sql:pkcol+" = ?",where_type:"string",where_value:dataId,callback:function(data){if(data.length==0){JxHint.alert(jx.util.nodata)}else{var r=page.formNode.event.newRecord(data[0]);page.getForm().myRecord=r;page.getForm().loadRecord(r);page.formNode.event.initForm()}}};Jxstar.queryData(funId,options)};Jxstar.showData({filename:define.formpage,pagetype:"form",title:define.nodetitle,callback:hdcall})},getButton:function(toolBar,eventCode){if(!toolBar){return}if(toolBar.isXType){return toolBar.find("eventCode",eventCode)[0]}else{return toolBar.query('button[eventcode="'+eventCode+'"]')[0]}},findFormItem:function(items,name){var item=null;var findv=function(items,name){if(item){return}for(var i=0;i<items.length;i++){if(items[i].items){findv(items[i].items,name)}else{if(items[i].name==name){item=items[i];return item}}}};findv(items,name);return item},getPageSize:function(grid){var pageSize=Jxstar.pageSize;var bbar=grid.getBottomToolbar();if(bbar&&bbar.isXType("paging")){pageSize=bbar.pageSize}else{var pbar=grid.pagebar;if(pbar){pageSize=pbar.pageSize}else{var tbar=grid.getTopToolbar();if(tbar){var pbar=tbar.findByType("paging")[0];if(pbar){pageSize=pbar.pageSize}else{pageSize=10000}}}}return pageSize},disCloudTool:function(subgrid,disable){var bar=JxUtil.getCloudTool(subgrid);if(!bar){return}if(bar.isXType){JxUtil.disableButton(bar,disable)}else{var btns=bar.query('button[righttype="edit"]');for(var i=0;i<btns.length;i++){btns[i].disabled=disable}}},getCloudTool:function(subgrid){var bar=subgrid.getTopToolbar();if(!bar){var ct=subgrid.ownerCt;bar=ct.header;if(!bar){bar=ct.tabtooler;if(!bar){return}}}return bar},getGroupData:function(code){var datas=Jxstar.findComboData(code);var data=[];for(var i=0;i<datas.length;i++){var label=datas[i][1];var val=datas[i][0];data.push({boxLabel:label,inputValue:val,name:"radio_"+code})}return data},getGroupText:function(value,code){if(!value||!code){return""}var datas=Jxstar.findComboData(code);var vs=value.split(",");var ts="";for(var i=0;i<vs.length;i++){for(var j=0;j<datas.length;j++){if(vs[i]==datas[j][0]){ts+=datas[j][1]+","}}}return ts.substring(0,ts.length-1)},disableButton:function(toolBar,disable){if(!toolBar){return}var btns=toolBar.find("rightType","edit");Ext.each(btns,function(btn){btn.setDisabled(disable)})},readOnlyForm:function(form,readOnly){if(readOnly==true){form.fieldItems().each(function(f){if(f.isXType("field")){if(f.isXType("checkbox",true)||f.isXType("radio",true)){f.setDisabled(true)}else{f.setReadOnly(true)}}})}else{form.fieldItems().each(function(f){var initReadOnly=f.initialConfig.readOnly;var initDisabled=f.initialConfig.disabled;if(f.isXType("field")){if(f.isXType("checkbox",true)||f.isXType("radio",true)||f.isXType("fileuploadfield",true)){if(!initDisabled){f.setDisabled(false)}}else{if(!initReadOnly){f.setReadOnly(false)}}}})}},isModifyForm:function(fpage){if(!fpage||!fpage.formNode){return false}if(fpage.getForm().isDirty()){return true}var gs=fpage.findByType("grid");if(gs&&gs.length>0){for(var i=0;i<gs.length;i++){var store=gs[i].getStore();if(gs[i].gridNode&&store){var mrow=store.getModifiedRecords();if(mrow&&mrow.length>0){return true}}}}return false},formatNumber:function(n){return function(v){if(n==null||isNaN(n)){n=2}return(v!==undefined&&v!==null&&v!=="")?parseFloat(parseFloat(v).toFixed(n)):""}},formatMoney:function(n){return function(v){if(n==null||isNaN(n)){n=2}var f="0,000";if(n>0){f+="."}for(var i=0;i<n;i++){f+="0"}v=(v!==undefined&&v!==null&&v!=="")?Ext.util.Format.number(v,f):"";if(v.indexOf(".")>=0){var c=0;for(var i=v.length-1;i>=0;i--){if(v.charAt(i)=="0"){c++}else{break}}if(n==c){c++}v=v.substr(0,v.length-c)}return v}},formatInt:function(){return function(v){return(v!==undefined&&v!==null&&v!=="")?parseInt(v):""}},gridToCSV:function(grid,includeHidden){var fileContent="";var cm=grid.getColumnModel();var groups="";var rows=cm.rows;if(rows&&rows.length>0){for(var n=0;n<rows.length;n++){var r=rows[n];for(var i=0;i<r.length;i++){var cs=r[i].colspan;if(i==0){cs=cs-1}groups+=r[i].header+",";if(cs>1){for(var j=0;j<cs-1;j++){groups+=","}}}if(groups.length>0){groups=groups.substr(0,groups.length-1);fileContent+=groups+"\n";groups=""}}}var title="";var colCount=cm.getColumnCount();for(var i=0;i<colCount;i++){if(cm.getDataIndex(i).length>0&&(includeHidden||!cm.isHidden(i))){title+=cm.getColumnHeader(i)+","}}if(title.length>0){title=title.substr(0,title.length-1)}var content="",row="",r;for(var i=0,it=grid.store.data.items,l=it.length;i<l;i++){r=it[i].data;var k=0;for(var j=0;j<colCount;j++){if((cm.getDataIndex(j).length>0)&&(includeHidden||!cm.isHidden(j))){var v=r[cm.getDataIndex(j)];v=Ext.isDate(v)?v.dateFormat("Y-m-d H:i:s"):v;k++;row+=v+","}}if(row.length>0){row=row.substr(0,row.length-1)}content+=row+"\n";row=""}fileContent+=title+"\n";fileContent+=content+"\n";return fileContent},newId:function(){return JxUtil.uuid(8,16)},getTmpKeyId:function(){return"tmp-"+JxUtil.uuid(20,16)},uuid:function(len,radix){var chars="0123456789abcdefghijklmnopqrstuvwxyz".split("");var uuid=[],i;radix=radix||chars.length;if(len){for(i=0;i<len;i++){uuid[i]=chars[0|Math.random()*radix]}}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]="-";uuid[14]="4";for(i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&3)|8:r]}}}return uuid.join("")},emptyRecord:function(store){var record=new (store.reader.recordType)({});var cols=record.fields.keys;for(var i=0;i<cols.length;i++){record.set(cols[i],"")}return record},htmlEncode:function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML},htmlDecode:function(html){var a=document.createElement("a");a.innerHTML=html;return a.textContent},specialKey:function(field,event){if(event.ctrlKey&&event.keyCode==event.F1){var ft=field.name.split("__");var showField=function(data){var html='<div style="background-color:#fff;font-size:13px;line-height:22px;padding:2px;width:100%;height:100%;overflow:auto;">'+JxUtil.htmlEncode(data.info)+"</div>";var win=new Ext.Window({title:jx.util.seefield,layout:"fit",width:450,height:250,resizable:true,modal:true,style:"",closeAction:"close",html:html,buttons:[{text:jx.base.ok,handler:function(){win.close()}}]});win.show()};var params="funid=dm_fieldcfg&table_name="+ft[0]+"&field_name="+ft[1];params+="&eventcode=queryfield";Request.postRequest(params,showField)}},changeValue:function(field,newValue,oldValue){if(field.isDirty()){field.addClass("x-grid3-dirty-cell")}else{field.removeClass("x-grid3-dirty-cell")}},clearDirty:function(form){form.fieldItems().each(function(f){var name=f.name;if(name!=null&&name.length>0){f.removeClass("x-grid3-dirty-cell");f.originalValue=f.getValue()}})},fieldValueTip:function(formPanel){var fields=formPanel.findByType("textfield");if(fields&&fields.length>0){Ext.each(fields,function(item){if(item.isXType("textarea")||item.isXType("datefield")||item.isXType("numberfield")){return}var v=item.getValue();var len=JxUtil.strlen(v);var width=item.getWidth();if(item.tip||((len*8>width)&&item.el)){if(!item.tip){item.tip=new Ext.ToolTip({target:item.el,html:v})}else{if(item.tip.body){item.tip.body.dom.innerHTML=v}else{item.tip.html=v}}}})}},getDirtyFields:function(form){var name,fields="";form.fieldItems().each(function(f){name=f.name;if(name!=null&&name.length>0&&f.isDirty()){fields+=name.replace("__",".")+";"}});if(fields.length>1){fields=fields.substr(0,fields.length-1)}return fields},getFormValues:function(form,dirtyOnly){var name,val,data="",e=encodeURIComponent;form.fieldItems().each(function(f){name=f.name;val=f.getValue();val=Ext.isDate(val)?val.dateFormat("Y-m-d H:i:s"):val;if(name!=null&&name.length>0&&(dirtyOnly!==true||f.isDirty())){data+="&"+e(name)+"="+e(val)}});return data},parseWhereValue:function(whereValue,tagRecord,isBig){if(whereValue==null||whereValue.length==0||tagRecord==null){return whereValue}var re=/\[[^\]]+\]/g;if(isBig){re=/\{[^\{]+\}/g}var fn=function(name,index,format,args){name=name.substr(1,name.length-2);name=name.replace(".","__");var v;if(tagRecord.get){v=tagRecord.get(name)}else{v=tagRecord[name]}return v||name};var value=whereValue.replace(re,fn);return value},getSelectRows:function(g){var records=[];var selModel=g.getSelectionModel();if(selModel.getSelections){records=selModel.getSelections()}else{var pos=selModel.getSelectedCell();if(pos==null){return records}var record=g.getStore().getAt(pos[0]);if(record){records=[record]}}return records},selected:function(records){if(records==null){JxHint.alert(jx.util.isnull);return false}if(records.length==0){JxHint.alert(jx.util.selectno);return false}return true},selectone:function(records){if(!this.selected(records)){return false}if(records.length>1){JxHint.alert(jx.util.selectone);return false}return true},checkResult:function(extData){if(!extData||extData.length==0){return}var cds=extData.checkMsg;for(var i=0,n=cds.length;i<n;i++){var data=cds[i];var faild=data.faildDesc;if(!data.result&&faild.length>0&&faild.indexOf("[")>-1){faild=faild.replace(/\[/g,"{");faild=faild.replace(/\]/g,"}");var tpl=new Ext.XTemplate(faild);data.faildDesc=tpl.apply(data.data)}}var tpl=new Ext.XTemplate('<div style="background-color:#fff;">','<table style="font-size:13px;width:100%;">','<tr style="font-weight:bold;background-color:#ccc;height:28px;"><td style="width:150px;">'+jx.util.checks+'</td><td style="width:40px;">'+jx.util.results+'</td><td style="width:190px;">'+jx.util.failp+"</td></tr>",'<tpl for="checkMsg">','<tr style="background-color:#eee;height:28px;">',"<td>{checkName}</td>",'<tpl if="result == false">','<td><span class="eb_audit_cancel">&nbsp;&nbsp;&nbsp;&nbsp;</span></td>',"</tpl>",'<tpl if="result == true">','<td><span class="eb_select">&nbsp;&nbsp;&nbsp;&nbsp;</span></td>',"</tpl>","<td>{faildDesc} {message}</td>","</tr>","</tpl>","</table>","</div>");var win=new Ext.Window({title:jx.util.checkis,layout:"fit",width:400,height:300,resizable:false,modal:true,autoScroll:true,closeAction:"close",tpl:tpl,data:extData});win.show()},tabAddKey:function(tab){var hd=function(tab){var mappings=[],cnt=tab.items.getCount();for(var i=0;i<cnt;i++){var fn=function(k,e){var index=k-49;tab.activate(index)};var key=49+i;mappings[i]={key:key,ctrl:true,alt:true,fn:fn}}tab.keymap=new Ext.KeyMap(tab.el,mappings);tab.keymap.enable()};JxUtil.delay(1000,function(){if(this.el){hd(this)}},tab)},isDisableBtn:function(page,eventCode){var tbar=page.getTopToolbar();if(tbar==null){return true}var btn=JxUtil.getButton(tbar,eventCode);if(btn==null){return true}return btn.disabled},focusFirst:function(page){if(page==null||!page.isXType("form")){return}var hd=function(){page.form.items.each(function(f){if(f.isFormField&&f.rendered&&f.name&&!f.isXType("hidden")){f.focus();return false}})};JxUtil.delay(500,hd)},focusFirstRow:function(page){if(page==null||!page.isXType("grid")){return}var row=JxUtil.getRowNum(page);page.getView().focusRow(row)},getRowNum:function(page){if(page==null||!page.isXType("grid")){return -1}var sm=page.getSelectionModel();if(sm.getSelectedCell){var pos=sm.getSelectedCell();if(pos){return pos[0]}else{return -1}}else{var s=page.getStore();var r=sm.getSelected();if(r){return s.indexOf(r)}else{return -1}}},getEditCol:function(page){if(page==null||!page.isXType("editorgrid")){return -1}var cm=page.getColumnModel();var cnt=cm.getColumnCount();for(var i=0;i<cnt;i++){if(cm.isCellEditable(i,0)){return i}}return -1},errorResponse:function(response){var msg,code=response.status;if(response.isTimeout){msg=jx.util.limittime}else{if(code>=200&&code<300){var result=Ext.decode(response.responseText);msg=result.message;if(msg.length==0){msg=response.statusText}}else{if(response.responseText!=null&&response.responseText.length>0){var msg=response.responseText;try{var result=Ext.decode(response.responseText);msg=result.message}catch(e){}JxHint.alert(msg);return}else{msg=response.statusText}}}if(msg.indexOf("communication")>-1){msg=jx.util.netfail;var show=Jxstar.systemVar.sys__show__neterror||"0";if(show=="1"){alert(msg)}return}else{alert(msg)}if(msg.indexOf(jx.index.login)>=0){JxUtil.isLogout=true;window.location.href=Jxstar.logoutUrl||Jxstar.path}},delay:function(time,fn,scope,args){(new Ext.util.DelayedTask()).delay(time,fn,scope,args)},removeChild:function(parent){if(!parent){return}try{var childs=parent.childNodes||[];for(var i=childs.length-1;i>=0;i--){var has=childs[i].hasChildNodes();if(has){JxUtil.removeChild(childs[i])}else{if(childs[i]){parent.removeChild(childs[i]);childs[i]=null}}}if(parent){parent.parentNode.removeChild(parent)}parent=null}catch(e){}},isphone:function(value){if(value==null||value.length!=11){return false}var p=/^1[3,4,5,7,8]\d{9}$/;return p.test(value)?true:false},isemail:function(value){if(value==null||value.length<5){return false}var p=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return(p.test(value))?true:false},strlen:function(value){if(value==null||value.length<1){return 0}var len=0;for(var i=0;i<value.length;i++){if(value.charCodeAt(i)<299){len++}else{len+=2}}return len},numBigMoney:function(num){var strOutput="";var strUnit="仟佰拾亿仟佰拾万仟佰拾元角分";num+="00";var intPos=num.indexOf(".");if(intPos>=0){num=num.substring(0,intPos)+num.substr(intPos+1,2)}strUnit=strUnit.substr(strUnit.length-num.length);for(var i=0;i<num.length;i++){strOutput+="零壹贰叁肆伍陆柒捌玖".substr(num.substr(i,1),1)+strUnit.substr(i,1)}return strOutput.replace(/零角零分$/,"整").replace(/零[仟佰拾]/g,"零").replace(/零{2,}/g,"零").replace(/零([亿|万])/g,"$1").replace(/零+元/,"元").replace(/亿零{0,3}万/,"亿").replace(/^元/,"零元")},fixPNG:function(myIMG){if(!Ext.isIE6){return}var imgID=(myIMG.id)?"id='"+myIMG.id+"' ":"";var imgTitle=(myIMG.title)?"title='"+myIMG.title+"' ":"title='"+myIMG.alt+"' ";var newHTML="<span "+imgID+imgTitle+' style="width:'+myIMG.width+"px; height:"+myIMG.height+"px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+myIMG.src+"', sizingMethod='scale');\"></span>";myIMG.outerHTML=newHTML},renderDate:function(value,format){if(Ext.isString(value)){value=value.replace("T"," ");if(value.length==19){value=Date.parseDate(value,"Y-m-d H:i:s")}else{if(value.length==10){value=Date.parseDate(value,"Y-m-d")}}}return value?Ext.util.Format.date(value,format):""},getDateFormat:function(renderer){var ren=renderer.toString(),form="Y-m-d";if(ren.indexOf("'Y-m-d'")>=0||ren.indexOf('"Y-m-d"')>=0){form="Y-m-d"}else{if(ren.indexOf("'Y-m'")>=0||ren.indexOf('"Y-m"')>=0){form="Y-m"}else{if(ren.indexOf("'Y'")>=0||ren.indexOf('"Y"')>=0){form="Y"}}}return form},shortTime:function(ts,isbr){if(!ts||ts.length<14){return ts}if(ts.indexOf("-")>-1){var re=/[-: ]/g;ts=ts.replace(re,"")}var cur=JxUtil.getTimeStamp();if(cur.substr(0,8)==ts.substr(0,8)){return"今天"+(isbr?"<br>":" ")+ts.substr(8,2)+":"+ts.substr(10,2)}else{return ts.substr(4,2)+"-"+ts.substr(6,2)+(isbr?"<br>":" ")+ts.substr(8,2)+":"+ts.substr(10,2)}},shortDate:function(ts){if(!ts||ts.length<14){return ts}if(ts.indexOf("-")>-1){var re=/[-: ]/g;ts=ts.replace(re,"")}var cur=JxUtil.getTimeStamp();if(cur.substr(0,8)==ts.substr(0,8)){return ts.substr(8,2)+":"+ts.substr(10,2)}else{return ts.substr(4,2)+"-"+ts.substr(6,2)}},getTimeStamp:function(){var d=new Date();return d.format("YmdHis")},getCurYear:function(inc){var d=new Date();var y=parseInt(d.format("Y"));if(inc!=null){y=y+inc}return y},getTodayTime:function(){var d=new Date();return d.format("Y-m-d H:i:s")},getToday:function(inc){var d=new Date();if(inc!=null){d=d.add(Date.DAY,inc)}return d.format("Y-m-d")},getMonth:function(inc){var d=new Date();if(inc!=null){d=d.add(Date.MONTH,inc)}return d.format("Y-m")},getNextMonth:function(smonth,num){if(smonth==null){return""}smonth=smonth.split(" ")[0];var sd=smonth.split("-");if(sd.length==2){smonth=smonth+"-01"}else{if(sd.length==1){smonth=smonth+"-01-01"}}var dt=Date.parseDate(smonth,"Y-m-d");dt=dt.add(Date.MONTH,num);return dt.format("Y-m")},getNextDate:function(sdate,num){if(sdate==null){return""}sdate=sdate.split(" ")[0];var sd=sdate.split("-");if(sd.length==2){sdate=sdate+"-01"}else{if(sd.length==1){sdate=sdate+"-01-01"}}var dt=Date.parseDate(sdate,"Y-m-d");dt=dt.add(Date.DAY,num);return dt.format("Y-m-d")},getWeekDates:function(){var d=new Date();var w=d.getDay();var sd=this.getNextDate(this.getToday(),-w);var ed=this.getNextDate(this.getToday(),7-w);return[sd,ed]},getPreWeekDates:function(){var d=new Date();var w=d.getDay();var sd=this.getNextDate(this.getToday(),-w-7);var ed=this.getNextDate(this.getToday(),-w);return[sd,ed]},getMonthDates:function(){var smonth=this.getMonth();var sd=smonth+"-01";var ed=this.getNextMonth(smonth,1)+"-01";return[sd,ed]},getPreMonthDates:function(){var smonth=this.getNextMonth(this.getMonth(),-1);var sd=smonth+"-01";var ed=this.getNextMonth(smonth,1)+"-01";return[sd,ed]},toFixed:function(v,f){with(Math){return round(v*pow(10,f))/pow(10,f)}},multiply:function(rec,a,b,c){var va=rec.get(a);var vb=rec.get(b);var vc=(parseFloat(va)*100)*(parseFloat(vb)*100);vc=vc/10000;if(isNaN(vc)){vc=0}else{vc=JxUtil.toFixed(vc,2)}rec.set(c,vc)},viewNavIcon:function(parentNode,moduleLevel){if(!moduleLevel||moduleLevel<1){moduleLevel=1}var hdCall=function(data){if(data!=null){data=data.root}if(data==null||data.length==0){return}for(var i=0,n=data.length;i<n;i++){var moduleId=data[i].wfnav_graph__module_id;if(moduleId.length==0||moduleId.length!=moduleLevel*4){continue}var oneNode=parentNode.findChild("id",moduleId);if(Ext.isEmpty(oneNode)){continue}var graphId=data[i].wfnav_graph__graph_id;var graphTitle=data[i].wfnav_graph__graph_name;if(graphId.length==0){continue}var anchor=oneNode.getUI().getAnchor();var cls="wfnav-icon";if(Ext.isChrome){cls+=" wfnav-icon-chrome"}var wfnav=Ext.fly(anchor).next(".wfnav-icon");if(wfnav){wfnav.remove()}var chg="onmouseover=\"this.style.marginRight='3px';\" onmouseout=\"this.style.marginRight='4px';\"";var navIcon=Ext.fly(anchor).insertHtml("afterEnd","<span "+chg+' class="'+cls+'" graphid="'+graphId+'" title="'+graphTitle+'" graphtitle="'+graphTitle+'"></span>',true);navIcon.on("click",function(e,t){e.stopEvent();JxWfGraph.showGraphFun(t.getAttribute("graphid"),null,false,t.getAttribute("graphtitle"))})}};var where_sql=encodeURIComponent("auditing = 1");var params="eventcode=query_data&funid=queryevent&pagetype=grid&query_funid=wfnav_graph&where_sql="+where_sql;Request.dataRequest(params,hdCall)},showLinkWin:function(type,linkFunid,where_sql,where_value,where_type){if(type=="grid"){var hdcall=function(grid){JxUtil.delay(500,function(){Jxstar.loadData(grid,{where_sql:where_sql,where_value:where_value,where_type:where_type})})};var define=Jxstar.findNode(linkFunid);Jxstar.showData({filename:define.gridpage,title:define.nodetitle,pagetype:"grid",nodedefine:define,callback:hdcall})}else{var hdcall=function(page){var options={where_sql:where_sql,where_type:where_type,where_value:where_value,callback:function(data){if(data.length==0){page.formNode.event.create()}else{var r=page.formNode.event.newRecord(data[0]);page.getForm().myRecord=r;page.getForm().loadRecord(r)}}};Jxstar.queryData(linkFunid,options)};var define=Jxstar.findNode(linkFunid);Jxstar.showData({filename:define.formpage,title:define.nodetitle,callback:hdcall})}}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxAttach={};(function(){Ext.apply(JxAttach,{addAttachCol:function(c,a){var b={col:{header:'<div class="hd_attach" title="附件标志">&#160;</div>',width:22,name:"attachcol",xtype:"actioncolumn",menuDisabled:true,align:"center",iconCls:"myhidden",renderer:function(){return'<div unselectable="on" class="x-grid3-cell-inner">&nbsp;</div>'}}};if(!a){a=0}c.insert(a,b)},getAttachColNum:function(d){var b=d.getSelectionModel() instanceof Ext.grid.CheckboxSelectionModel;var a=d.gridNode.param.cols;for(var c=0,e=a.length;c<e;c++){if(a[c].col.name=="attachcol"){return c+(b?2:1)}}return -1},officeAppName:function(a){if(a.indexOf("word")>=0){return"Word.Document"}else{if(a.indexOf("excel")>=0||a.indexOf("spreadsheetml.sheet")>=0){return"Excel.Sheet"}}return""},previewOffice:function(l,i,h){var m="objAttach_"+l;var a="tabAttach_"+l;var j="divAttach_"+l;var d=Jxstar.sysMainTab;var c=d.getComponent(a);if(c){d.activate(c);return}var g='<div id="'+j+'" class="login_loading"><img src="resources/images/jxstar32.gif" width="32" height="32"style="margin-right:8px;float:left;vertical-align:bottom;"/><span id="loading-msg">正在加载'+i+"...</span></div>";var b=Jxstar.path+"/fileAction.do?funid=sys_attach&pagetype=editgrid&eventcode=down&nousercheck=1&dataType=byte&keyid="+l;var f=g+'<OBJECT classid="clsid:00460182-9e5e-11d5-b7c8-b8269041dd57" id="'+m+'" style="left:0px; top:0px; width:10px; height:10px" viewastext codebase=lib/dso/dsoframer.ocx#version=2,2,0,8><PARAM NAME="_ExtentX" VALUE="6350"><PARAM NAME="_ExtentX" VALUE="6350"><PARAM NAME="_ExtentY" VALUE="6350"><PARAM NAME="BorderColor" VALUE="-2147483632"><PARAM NAME="BackColor" VALUE="-2147483643"><PARAM NAME="ForeColor" VALUE="-2147483640"><PARAM NAME="TitlebarColor" VALUE="-2147483635"><PARAM NAME="TitlebarTextColor" VALUE="-2147483634"><PARAM NAME="BorderStyle" VALUE="0"><PARAM NAME="Titlebar" VALUE="0"><PARAM NAME="Toolbars" VALUE="0"><PARAM NAME="Menubar" VALUE="0"></OBJECT>';var c=d.add({id:a,pagetype:"formpic",label:i,border:false,layout:"fit",closable:true,iconCls:"function",html:f});d.activate(c);var e=Ext.getDom(m);e.Open(b,true,h);Ext.fly(j).hide();Ext.fly(e).setStyle({left:0,top:0,width:"100%",height:"100%"})},previewPDF:function(c,f){if(!JxAttach.isPdf(f)){JxHint.alert("只有PDF文档才能在线阅读！");return}var a="tabAttachPDF_"+c;var e=Jxstar.sysMainTab;var d=e.getComponent(a);if(d){e.activate(d);return}var b='<iframe frameborder="no" style="display:none;border-width:0;width:100%;height:100%;" ></iframe><div class="nav_msg_notip"><img src="resources/images/jxstar32.gif" width="32" height="32"style="margin-right:8px;float:left;vertical-align:bottom;"/><span>正在加载文件...</span></div>';var d=e.add({id:a,pagetype:"formpic",label:f,border:false,layout:"fit",closable:true,iconCls:"function",html:b});e.activate(d);JxAttach.loadDoc(c,f,d)},loadDoc:function(a,i,c){var d=function(e){c.getEl().child("div").hide();var j=c.getEl().child("iframe");j.dom.src=e;j.show();c.show();c.bwrap.show()};var g="/fileAction.do?funid=sys_attach&keyid="+a+"&eventcode=down";g+="&notdown=1&user_id="+Jxstar.session.user_id;g+="&dataType=byte&_dc="+(new Date()).getTime();var b=Jxstar.path+g;var h=Jxstar.systemVar.sys__attach__pdfview||"";if(h.length>0){var f=encodeURIComponent;b=h+"?file="+f(Jxstar.allpath+g)}d(b)},imgZoomTool:function(g){var j,l,e=0,b=0;var h=[];for(var d=20;d<=200;d+=20){h[h.length]=[d,d]}h[h.length]=["all","全屏"];var a=[];for(var d=0;d<360;d+=30){a[a.length]=[d,d]}var c=new Ext.Toolbar({items:[{xtype:"tbtext",text:"缩放比例："},{xtype:"combo",width:80,editable:false,store:new Ext.data.SimpleStore({fields:["value","text"],data:h}),mode:"local",triggerAction:"all",valueField:"value",displayField:"text",value:100,listeners:{select:function(o){if(!j||e==0){return}var m=o.getValue(),i,n;if(m=="all"){i=l.getWidth();n=l.getHeight()}else{i=parseInt(e)*parseInt(m)/100;n=parseInt(b)*parseInt(m)/100}j.resizeTo(i,n)}}},{xtype:"tbtext",text:" %"},{xtype:"tbtext",text:"旋转角度："},{xtype:"combo",width:80,editable:false,store:new Ext.data.SimpleStore({fields:["value","text"],data:a}),mode:"local",triggerAction:"all",valueField:"value",displayField:"text",value:0,listeners:{select:function(m){var i=m.getValue();if(Ext.isIE){i=Math.round(i/90);l.dom.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+i+")"}else{l.dom.style.transform="rotate("+i+"deg)"}}}}]});var f=function(){l=g.getEl();j=new Ext.Resizable(l.child("img"),{wrap:true,pinned:true,minWidth:200,minHeight:100,preserveRatio:true,dynamic:true,handles:"all",draggable:true});e=j.getEl().getWidth();b=j.getEl().getHeight()};JxUtil.delay(1000,f);return c},previewImage:function(j,i,h){var a="tabAttachIMG_"+j;var f=Jxstar.sysMainTab;var c=f.getComponent(a);if(c){f.remove(a,true)}var b=Jxstar.path+"/fileAction.do?funid=sys_attach&pagetype=editgrid&eventcode=down&nousercheck=1&dataType=byte&keyid="+j;if(h&&h.length>0){b=h}var g='<img src="'+b+'">';var e=new Ext.BoxComponent({border:false,html:g});var d=this.imgZoomTool(e);var c=f.add({id:a,pagetype:"formpic",label:i,border:false,layout:"fit",closable:true,iconCls:"function",tbar:d,items:[e]});f.activate(c)},showImage:function(c,g){var a=Jxstar.path+"/fileAction.do?funid=sys_attach&pagetype=editgrid&eventcode=down&nousercheck=1&dataType=byte&keyid="+c;var b='<img src="'+a+'">';var d=new Ext.BoxComponent({border:false,html:b});var f=this.imgZoomTool(d);var e=new Ext.Window({title:"浏览-"+g,layout:"fit",width:805,height:550,constrainHeader:true,resizable:true,border:false,modal:true,closeAction:"close",autoScroll:true,tbar:f,items:[d]});e.show()},previewMenu:function(c){var b,d;var a=c.content_type;if(a=="application/pdf"){b=function(g){var f=g.initialConfig.data;var e=f.attach_id;var h=f.attach_name;JxAttach.previewPDF(e,h)}}if(a.indexOf("image")==0){b=function(g){var f=g.initialConfig.data;var e=f.attach_id;var h=f.attach_name;JxAttach.previewImage(e,h)}}if(b){d={items:[{text:"在线浏览",data:c,handler:b}]}}return d},isDocs:function(c){var b="";var a=c.lastIndexOf(".");if(a>=0){b=c.substr(a+1)}if(b=="pdf"||b=="doc"||b=="docx"||b=="xls"||b=="xlsx"||b=="ppt"||b=="pptx"){return true}return false},isPdf:function(c){var b="";var a=c.lastIndexOf(".");if(a>=0){b=c.substr(a+1)}return(b=="pdf")},showWinDoc:function(l,h,b,m){var p=l.getColumnModel();var i=p.getColumnId(b);if(i.indexOf("__attach_name")<0&&i.indexOf("__attach_path")<0){return}var q=m.getTarget();if(q.tagName.toLowerCase()!="a"){return}var d=l.getStore().getAt(h);var o=d.get("sys_attach__attach_id");var d=l.getStore().getAt(h);var o=d.get("sys_attach__attach_id");var c=d.get("sys_attach__attach_name");var j=d.get("sys_attach__content_type");var f=function(e){var g="funid=sys_attach&keyid="+e+"&pagetype=editgrid&eventcode=down";Request.attachDown(g)};var n=function(r,g,e){if(e.indexOf("image")>=0){JxAttach.previewImage(r,g)}else{if(JxAttach.isDocs(g)){JxAttach.previewPDF(r,g)}}};if((j.indexOf("image")>=0||JxAttach.isPdf(c))){var a=new Ext.menu.Menu({items:[{text:"下载",data:o,handler:function(){f(o)}},{text:"在线浏览",data:o,handler:function(){n(o,c,j)}}]});a.show(q)}else{f(o)}},viewAttachFlag:function(a){if(a==null){return}var o=JxAttach.getAttachColNum(a);if(!(o>=0||a.isShowAttach==true)){return}if(o<0){o=0}var m=a.getStore();var c=m.getCount();if(c==0){return}var h=a.gridNode.define;if(h.tablename=="sys_dept"||h.tablename=="sys_user"){return}var l=h.pkcol;var b="";for(var f=0;f<c;f++){var g=m.getAt(f);b+=g.get(l)+","}b=b.substr(0,b.length-1);var j=function(y){if(y.length==0){return}var r=[],q=[];var D=-1;for(var z=0;z<y.length;z++){var u=parseInt(y[z].row_num);var w=y[z].data_id;var E=y[z].attach_id;var x=y[z].attach_name;var B=y[z].content_type;var t=y[z].is_relat;if(D!=u){q=[]}var A={id:E,text:x,handler:function(){var i="funid=sys_attach&keyid="+this.id+"&pagetype=editgrid&eventcode=down";Request.attachDown(i)}};if(t=="1"){A.style={color:"red"}}var s=JxAttach.previewMenu(y[z]);if(s){A.menu=s}q[q.length]=A;if(D!=u){D=u;var v=a.getView().getCell(u,o);Ext.fly(v.firstChild).addClass("flag_attach");var C=Ext.get(v);C.myitems=q;C.on("click",function(){var i=new Ext.menu.Menu({items:[this.myitems],width:200});i.on("hide",function(F){F.myitems=null;F.destroy()});i.show(this)})}}};var n=a.isQueryRelat||"0";var e=Jxstar.systemVar.sys__attach__relat||"0";if(e!="1"){n="0"}var d="funid=queryevent&pagetype=grid&eventcode=query_attach";d+="&tablename="+h.tablename+"&keyids="+b+"&is_queryrelat="+n;var p=a.queryAttachType;if(p){d+="&attach_type="+p}Request.dataRequest(d,j)},checkGrid:function(a){var e=JxUtil.getSelectRows(a);if(!JxUtil.selected(e)){return}var o=a.findParentByType("tabpanel");if(o==null){return}var d=o.getComponent(1);if(d==null){return}var c=d.getComponent(0);if(c==null||c.isXType("form")==false){return}var m=c.findByType("fileuploadfield");if(m==null||m.length==0){return}for(var g=0;g<e.length;g++){var l=e[g];for(var h=0;h<m.length;h++){var n=m[h];if(n.allowBlank==false){var b=l.get(n.name);if(b==null||b.length==0){JxHint.alert(String.format(jx.util.itematt,n.fieldLabel));return false}}}}},checkAttach:function(c){var a=c.findByType("fileuploadfield");if(a==null||a.length==0){return true}for(var b=0;b<a.length;b++){var d=a[b];if(d.allowBlank==false){var e=d.getValue();if(e==null||e.length==0){JxHint.alert(String.format(jx.util.itematt,d.fieldLabel));return false}}}return true},beforeChange:function(b){if(b.disabled){return}var g=JxAttach.attachParam(b,"");if(g==null){return}var e=g.form;var c=e.get(g.define.pkcol);if(c==null||c.length==0){JxHint.alert(jx.event.nosave);return false}var d="0",f="6";if(g.define.status){d=g.define.status.audit0}var a=d;if(g.define.auditcol.length>0){a=e.get(g.define.auditcol)}if(a!=d&&a!=f){}},showAttach:function(b){if(b==null||b.parentNode==null){return}var a=Ext.getCmp(b.parentNode.id);if(a==null){return}var c=JxAttach.attachParam(a,"fdown");if(c==null){return}Request.attachDown(c.params)},deleteAttach:function(b){if(b==null||b.parentNode==null){return}var a=Ext.getCmp(b.parentNode.id);if(a==null){return}if(a.fileInput.dom.disabled){return}var c=function(){var h=JxAttach.attachParam(a,"fdelete");if(h==null){return}var e="0",g="6";if(h.define.status){e=h.define.status.audit0}var d=e;if(h.define.auditcol.length>0){d=h.form.get(h.define.auditcol)}if(d!=e&&d!=g){}var f=function(){a.setValue("");if(!Ext.isEmpty(h.form.myRecord)){h.form.myRecord.set(a.name,"");h.form.myRecord.commit()}};Request.postRequest(h.params,f)};Ext.Msg.confirm(jx.base.hint,jx.event.delyes,function(d){if(d=="yes"){c()}})},saveAttach:function(a){if(a.disabled){return}var f=JxAttach.attachParam(a,"fcreate");if(f==null){return}var c=f.form;var b=c.get(f.define.pkcol);if(b==null||b.length==0){JxHint.alert(jx.event.nosave);return false}var d=function(){if(!Ext.isEmpty(c.myRecord)){c.myRecord.set(a.name,a.getValue());c.myRecord.commit()}};var e=f.params+"&attach_name="+encodeURIComponent(a.getValue());Request.fileRequest(c,e,d,a)},attachParam:function(f,h){var e=f.findParentByType("form");if(Ext.isEmpty(e)){JxHint.alert(jx.util.formnat);return}var a=e.getForm();var g=e.formNode.define;var b=g.nodeid;var i=g.tablename;var d=a.get(g.pkcol);if(Ext.isEmpty(d)){JxHint.alert(jx.event.nosave);return}var j=f.name.split("__")[1];var c="funid=sys_attach&pagetype=editgrid&eventcode="+h;c+="&attach_field="+j+"&dataid="+d;c+="&table_name="+i+"&datafunid="+b;return{form:a,params:c,define:g}}})})();var ImageShower=function(a){this.config=a};ImageShower.prototype={lookup:{},show:function(){this.initTemplates();this.store=new Ext.data.JsonStore({url:this.config.url,root:"data",fields:["name","url","title"],listeners:{load:{fn:function(){this.view.select(0)},scope:this,single:true}}});this.store.load();var g=function(i){i.shortName=Ext.util.Format.ellipsis(i.title,15);i.sizeString="34";i.dateString=new Date().format("m/d/Y g:i a");this.lookup[i.name]=i;return i};this.view=new Ext.DataView({store:this.store,tpl:this.thumbTemplate,singleSelect:true,autoHeight:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:"No images to display",prepareData:g.createDelegate(this),listeners:{selectionchange:{fn:this.showDetails,scope:this,buffer:100},loadexception:{fn:this.onLoadException,scope:this},beforeselect:{fn:function(i){return i.store.getRange().length>0}}}});var e=function(m){var j=[];for(var l=20;l<=200;l+=20){j[j.length]=[l,l]}j[j.length]=["all","全屏"];var n=new Ext.Toolbar({items:[{xtype:"tbtext",text:"缩放比例："},{xtype:"combo",width:80,editable:false,name:"zoomvalue",store:new Ext.data.SimpleStore({fields:["value","text"],data:j}),mode:"local",triggerAction:"all",valueField:"value",displayField:"text",value:100,listeners:{select:function(q){var r=m.getComponent(0).getEl();var t=r.resiz;if(!t||t.oldw==0){return}var o=q.getValue(),i,p;if(o=="all"){i=r.getWidth();p=r.getHeight()}else{i=parseInt(t.oldw)*parseInt(o)/100;p=parseInt(t.oldh)*parseInt(o)/100}t.resizeTo(i,p)}}},{xtype:"tbtext",text:" %"}]});return n};var f=this.config.parentCtl;var h=e(f);var c="images-view";var b=f.getComponent(c);if(b){var d=b.getComponent(0);d.removeAll(true);d.add(this.view)}else{var a={id:c,pagetype:"formpic",layout:"border",border:false,closable:true,iconCls:"tab_form",items:[{id:"img-chooser-view",region:"west",split:true,width:160,minWidth:160,maxWidth:300,border:false,autoScroll:true,items:this.view},{id:"img-detail-panel",border:false,region:"center",autoScroll:true,tbar:h}]};b=f.add(a);f.doLayout()}return b},initTemplates:function(){this.thumbTemplate=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{name}">','<div class="thumb"><img src="{url}" title="{title}"></div>',"<span>{shortName}</span></div>","</tpl>",'<div class="x-clear"></div>');this.thumbTemplate.compile();this.detailsTemplate=new Ext.XTemplate('<div class="details">','<tpl for=".">','<img src="{url}"> ',"</tpl>","</div>");this.detailsTemplate.compile()},showDetails:function(){var c=this.view.getSelectedNodes();var a=Ext.getCmp("img-detail-panel");var d=a.body;if(c&&c.length>0){c=c[0];var b=this.lookup[c.id];if(b.url.indexOf("is_highimage")<0){b.url=b.url+"&is_highimage=1"}d.hide();this.detailsTemplate.overwrite(d,b);d.slideIn("l",{stopFx:true,duration:0.2});a.getTopToolbar().get(1).setValue(100);JxUtil.delay(500,function(){var e=d.child("img");var f=new Ext.Resizable(e,{wrap:true,pinned:true,minWidth:200,minHeight:100,preserveRatio:true,dynamic:true,handles:"all",draggable:true});f.oldw=f.getEl().getWidth();f.oldh=f.getEl().getHeight();d.resiz=f})}else{d.update("")}},onLoadException:function(a,b){this.view.getEl().update('<div style="padding:10px;">Error loading images.</div>')}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxDefault={};(function(){Ext.apply(JxDefault,{getToday:function(){return new Date()},getCurMonth:function(b){var c=new Date();var a=c.format("Y-m");c=Date.parseDate(a+"-01","Y-m-d");if(b!=null){c=c.add(Date.MONTH,b)}return c},getUserId:function(){return Jxstar.session.user_id},getUserCode:function(){return Jxstar.session.user_code},getUserName:function(){return Jxstar.session.user_name},getUserNameLang:function(){var b=JxLang.type;var a=Jxstar.session["user_name_"+b];if(!a||a.length==0){a=this.getUserName()}return a},getDeptId:function(){return Jxstar.session.dept_id},getDeptCode:function(){return Jxstar.session.dept_code},getDeptName:function(){return Jxstar.session.dept_name},getDeptNameLang:function(){var b=JxLang.type;var a=Jxstar.session["dept_name_"+b];if(!a||a.length==0){a=this.getDeptName()}return a},getOrgId:function(){return Jxstar.session.orgid},getOrgCode:function(){return Jxstar.session.orgcode},getOrgName:function(){return Jxstar.session.orgname},getRoleId:function(){return Jxstar.session.role_id},getTenantId:function(){return Jxstar.session.tenant_id}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxLists=function(a){a=a||{};if(a.isSelect==null){a.isSelect=true}Ext.apply(this,a)};Ext.apply(JxLists.prototype,{render:function(){var b=this;var d=new Ext.data.ArrayStore({data:b.leftData||[],fields:["value","text"]});var c=new Ext.data.ArrayStore({data:b.rightData||[],fields:["value","text"]});var g,e,h;g=new Ext.ListView({region:"west",width:b.leftWidth||180,store:d,style:"background-color:#fff;",disableHeaders:true,multiSelect:true,columns:[{header:b.leftHeader||jx.group.datafield,dataIndex:"text"}],listeners:{dblclick:function(j,m,o,n){if(!b.isSelect){return false}var l=j.getStore();var i=l.getAt(m);e.getStore().add(i);l.removeAt(m)}}});e=new Ext.ListView({region:"east",width:b.rightWidth||180,store:c,style:"background-color:#fff;",disableHeaders:true,multiSelect:true,columns:[{header:b.rightHeader||jx.base.selfield,dataIndex:"text"}],listeners:{dblclick:function(j,m,o,n){if(!b.isSelect){return false}var l=j.getStore();var i=l.getAt(m);g.getStore().add(i);l.removeAt(m)}}});var a="./lib/ext/ux/images/";h=this.lsCenter||new Ext.Panel({baseCls:"x-plain",style:"border-right:1px solid #ddd; border-left:1px solid #ddd;",region:"center",border:false,layout:{type:"vbox",pack:"center",align:"center"},defaults:{margins:"0 0 10 0",cls:"x-btn-primary"},items:[{xtype:"button",tooltip:"选择全部字段",iconCls:"fa-angle-double-right",handler:function(){var j=g.getStore();var i=j.getRange(0,j.getCount());e.getStore().add(i);j.removeAll()}},{xtype:"button",tooltip:"右移选择的字段",iconCls:"fa-angle-right",handler:function(){var j=g.getSelectedRecords();e.getStore().add(j);for(var l=0;l<j.length;l++){g.getStore().remove(j[l])}}},{xtype:"button",tooltip:"左移选择的字段",iconCls:"fa-angle-left",handler:function(){var j=e.getSelectedRecords();g.getStore().add(j);for(var l=0;l<j.length;l++){e.getStore().remove(j[l])}}},{xtype:"button",tooltip:"取消全部字段",iconCls:"fa-angle-double-left",handler:function(){var j=e.getStore();var i=j.getRange(0,j.getCount());g.getStore().add(i);j.removeAll()}}]});this.lsLeft=g;this.lsRight=e;this.lsCenter=h;var f=new Ext.Panel({layout:"border",border:false,items:[g,h,e]});return f},getSelectStore:function(){if(!this.isSelect){return null}return this.lsRight.getStore()},getSelectData:function(){if(!this.isSelect){return""}var b=this.lsRight.getStore();if(b.getCount()==0){return""}var a="";for(var c=0,e=b.getCount();c<e;c++){var d=b.getAt(c).get("value");a+=d.replace("__",".")+","}a=a.substr(0,a.length-1);return a}});
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxGroup={};(function(){Ext.apply(JxGroup,{initStas:[["0","--"+jx.group.statc+"--"],["1","--"+jx.query.custom]],funId:"",charFields:[],numFields:[],charLists:null,numLists:null,selStatId:"",statGrid:null,statCombo:null,showCaseInQuery:function(a,g){var b=this;var e=g.fbar;b.initStas=[["0","--"+jx.group.statc+"--"]];var c=b.initStas;var d=JxUtil.newId()+"_sta";var f=Jxstar.createCombo(d,c,130);e.add(f);f.on("beforeselect",function(i,h){var l=h.get("value");var j=i.getValue();if(l!=j&&l=="1"){b.caseWin(a)}else{if(l!=j&&l!="0"){b.exeStat(a,l)}}});f.on("select",function(i,h){i.setValue("0")});b.loadStaCase(a,f)},showCase:function(b){var a=this,c=b.page;var g=c.getBottomToolbar();var d=a.initStas;var e=JxUtil.newId()+"_sta";var f=Jxstar.createCombo(e,d,130);if(g){g.add(f)}c.doLayout();f.on("beforeselect",function(i,h){var l=h.get("value");var j=i.getValue();if(l!=j&&l=="1"){a.caseWin(b)}else{if(l!=j&&l!="0"){a.exeStat(b,l)}}});f.on("select",function(i,h){i.setValue("0")});a.loadStaCase(b,f)},init:function(s){this.funId=s.nodeId;this.charFields=[];this.numFields=[];var t=[],l=s.param.cols;var q=0,o=0;for(var e=0,a=l.length;e<a;e++){var r=l[e].col,j=l[e].field;if(r==null||j==null){continue}var p=j.name,g=p.length;if(r&&j&&(p.substring(g-2)!="id")){var f=r.header;if(f.charAt(0)=="*"){f=f.substr(1)}var d=[j.name,f];var m=j.type;if(m=="int"||m=="float"){this.numFields[q++]=d}else{this.charFields[o++]=d}}}this.numFields[q]=["recordnum",jx.group.recnum]},charFieldCt:function(){var a=this;a.charLists=new JxLists({leftData:a.charFields,leftHeader:jx.group.scols,rightHeader:jx.group.secol});return a.charLists.render()},numFieldCt:function(){var a=this;a.numLists=new JxLists({leftData:a.numFields,leftHeader:jx.group.stcol,rightHeader:jx.group.stcols});return a.numLists.render()},saveCase:function(){var b=this;b.selStatId="";var f=b.charLists.getSelectStore();if(f.getCount()==0){JxHint.alert(jx.group.nofield);return}var c=b.numLists.getSelectStore();if(c.getCount()==0){JxHint.alert(jx.group.nofield);return}var e=function(q,o){var m=encodeURIComponent;var n="",l="",p="",j="";f.each(function(s){n+=s.get("value")+",";l+=s.get("text")+","});n=n.substr(0,n.length-1);l=l.substr(0,l.length-1);c.each(function(s){p+=s.get("value")+",";j+=s.get("text")+","});p=p.substr(0,p.length-1);j=j.substr(0,j.length-1);var r=function(t){b.statGrid.selectKeyId=t.keyid;var s=b.statGrid.getStore();s.reload()};var i="funid=sys_stat&statfunid="+b.funid+"&pagetype=grid&eventcode=savecase";i+="&keyid="+b.selStatId+"&statname="+m(q)+"&chars="+m(n)+"&is_share="+o;i+="&chartitles="+m(l)+"&nums="+p+"&numtitles="+m(j);Request.dataRequest(i,r)};var a=JxUtil.isAdminUser();var g={bodyStyle:"padding:20px 0 0 20px;",items:[{xtype:"textfield",fieldLabel:jx.group.casename,name:"stat_name",value:jx.group.statc,allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",maxLength:50},{xtype:"checkbox",hidden:!a,fieldLabel:jx.query.share,name:"is_share"}]};var d={width:400,height:200};var h=function(j,l){var m=j.get("stat_name");if(m.length==0){JxHint.alert(jx.group.usename);return false}var i=j.get("is_share");e(m,i);l.close()};JxUtil.formWindow({formcfg:g,wincfg:d,okcall:h})},exeStat:function(a,b){if(!b){b=this.selStatId}if(Ext.isEmpty(b)){JxHint.alert(jx.group.casenos);return}if(!window.JxGroupPage){JxUtil.loadJS("/public/layout/ux/group_page.js")}var c=JxGroupPage.createPage(b,a);var d=new Ext.Window({title:jx.group.statc,layout:"fit",width:900,height:600,constrainHeader:true,resizable:true,modal:true,closeAction:"close",defaults:{margins:"5 2 5 2"},items:[c]});d.show()},loadStaCase:function(g,b){var h=this;var e=g.nodeId;h.statCombo=b;b.setValue("0");var f=function(m){var l=m.root;var j=[];j=j.concat(h.initStas);Ext.each(l,function(n){j[j.length]=[n.sys_stat__stat_id,n.sys_stat__stat_name]});b.getStore().loadData(j)};var i="stat_type = '0' and fun_id = ? and (is_share = ? or user_id = ?)";var d=e+";1;"+JxDefault.getUserId();var a="string;string;string";var c="eventcode=query_data&funid=queryevent&pagetype=grid";c+="&query_funid=sys_stat&where_sql="+i+"&where_value="+d;c+="&where_type="+a;Request.dataRequest(c,f)},caseWin:function(c){var b=this;b.funid=c.nodeId;b.init(c);var f=b.charFieldCt();var a=b.numFieldCt();var e=[{text:"保存统计",iconCls:"eb_save",handler:b.saveCase.createDelegate(b),cls:"x-btn-white"},"->",{text:jx.group.stat,iconCls:"eb_chart",handler:b.exeStat.createDelegate(b,[c])}];var d=new Ext.Panel({layout:"border",items:[{xtype:"container",region:"north",layout:"fit",height:300,items:[f]},{xtype:"container",region:"center",layout:"fit",style:"border-top:1px solid #f2f2f2;",items:[a]}],buttonCls:"",buttonAlign:"left",buttons:e});var h=new Ext.Window({title:jx.group.statcc,layout:"border",width:600,height:600,constrainHeader:true,resizable:false,modal:true,closeAction:"close",items:[{xtype:"container",region:"west",layout:"fit",width:160,split:true,margins:"2 0 2 2"},{xtype:"container",region:"center",layout:"fit",margins:"2 2 2 0",items:[d]}]});var g=function(j){b.statGrid=j;j.on("rowclick",function(o,q,p){var l=o.getStore().getAt(q);if(l==null){return false}var m=l.get("sys_stat__stat_id");b.clickCase(m)});j.getStore().on("load",function(l){if(j.selectKeyId==null||j.selectKeyId.length==0){j.getSelectionModel().selectFirstRow();j.fireEvent("rowclick",j,0)}});j.gridNode.event.on("afterdelete",function(){b.createCase();j.selectKeyId=""});var i={where_sql:"fun_id = ? and (is_share = '1' or user_id = ?)",where_value:b.funid+";"+JxDefault.getUserId(),where_type:"string;string"};Jxstar.loadData(j,i)};Jxstar.createPage("sys_stat","gridpage",h.getComponent(0),{pageType:"notool",showCall:g});h.on("destroy",function(){b.loadStaCase(c,b.statCombo);if(b.statGrid!=null){b.statGrid.destroy()}b.funId="";b.charFields=null;b.numFields=null;b.charLists=null;b.numLists=null;b.selStatId="";b.statGrid=null});h.show();return h},createCase:function(){var e=this;var b=e.charLists,a=e.numLists;e.selStatId="";var d=b.lsRight.getStore();var c=d.getRange(0,d.getCount());b.lsLeft.getStore().add(c);d.removeAll();d=a.lsRight.getStore();c=d.getRange(0,d.getCount());a.lsLeft.getStore().add(c);d.removeAll()},clickCase:function(c){var b=this;b.createCase();b.selStatId=c;var a=function(j){var h=j.chars;var l=j.nums;var f=b.charLists,e=b.numLists;for(var g=0,m=h.length;g<m;g++){b.leftToRight(h[g].colcode,f.lsLeft,f.lsRight)}for(var g=0,m=l.length;g<m;g++){b.leftToRight(l[g].colcode,e.lsLeft,e.lsRight)}};var d="funid=sys_stat&pagetype=grid&eventcode=selcase&keyid="+c;Request.dataRequest(d,a)},leftToRight:function(e,f,d){var a=f.getStore(),b=d.getStore();var c=a.find("value",e);if(c>-1){var g=a.getAt(c);b.add(g);a.removeAt(c)}}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Ext.ns("Jxstar");Jxstar.JxSum=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this,a);Jxstar.JxSum.superclass.constructor.call(this)},init:function(b){this.grid=b;this.grid.jxsum=this;var a=this.view=b.getView();a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,q){var w=this.grid.getStore();var h=this.grid.gridNode;var m=h.param.average_fields;q=q||this.view.getColumnData();var r=this.grid.getColumnModel().config,e=[],s,b={},a,u=q.length-1;for(var l=0,n=q.length;l<n;l++){s=q[l];a=r[l];b.id=s.id;b.style=s.style;b.css=(l==0)?"x-grid3-cell-first ":(l==u?"x-grid3-cell-last ":"");b.value=d.data[s.name];b.value=Ext.data.Types.FLOAT.convert(b.value);if(b.value==undefined||b.value===""){if(l==0){b.value="<i class='fa eb_sum'></i>"}else{b.value="&#160;"}}else{if(!isNaN(b.value)&&a.renderer){var v=b.value;b.value=(a.renderer)(b.value);if(m&&m.length>0){for(var g=0;g<m.length;g++){if(s.name==m[g]){var f=w.getTotalCount();if(f==0){b.value="&#160;"}else{b.value="平均: "+(a.renderer)(v/f)}break}}}}}e[e.length]=this.cellTpl.apply(b)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},isGrouped:function(){return true},doWidth:function(d,b,c){if(!this.isGrouped()){return}var a=1,e=0,f;var g=this.view.mainBody.dom.childNodes;rlen=g.length;for(;e<a;++e){f=g[rlen-1];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.width=b}},doAllWidths:function(f,c){if(!this.isGrouped()){return}var e=1,b=0,a,l,h,d=f.length;var g=this.view.mainBody.dom.childNodes;rlen=g.length;for(;b<e;b++){l=g[rlen-1];l.style.width=c;l.firstChild.style.width=c;h=l.firstChild.rows[0].childNodes;for(a=0;a<d;a++){h[a].style.width=f[a]}}},doHidden:function(c,f,b){if(!this.isGrouped()){return}var a=1,d=0,e,h=f?"none":"";var g=this.view.mainBody.dom.childNodes;rlen=g.length;for(;d<a;d++){e=g[rlen-1];if(e.style){e.style.width=b;e.firstChild.style.width=b;e.firstChild.rows[0].childNodes[c].style.display=h}}},refreshSummary:function(a){},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=Ext.getDom(d);if(!f){return false}var b=[];this.grid.getStore().each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData(),a=this.renderSummary({data:data},c),e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){},doRemove:function(d,a,b,c){},refresh:function(c){var a=this.grid.getView().mainBody;if(!a){return}var b=this.renderSummary(c);a.select(".x-grid3-summary-row").remove();a.insertHtml("beforeEnd",b)}});
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxExport={};(function(){Ext.apply(JxExport,{funId:"",charFields:[],charLists:null,statGrid:null,showWindow:function(r){var s=this;s.funid=r.nodeId;s.charFields=[];var t=r.page.getColumnModel();var m=t.config;for(var f=0,p=0,d=m.length;f<d;f++){var e=m[f],q=e.dataIndex;if(q&&q.length>0){var j=e.header;if(j.charAt(0)=="*"){j=j.substr(1)}this.charFields[p++]=[q,j]}}var g=s.charFieldCt();var o=[{text:"保存方案",iconCls:"eb_save",handler:s.saveCase.createDelegate(s),cls:"x-btn-white"},"->",{text:jx.base.ok,handler:function(){var c=s.charLists.getSelectData();if(c.length==0){JxHint.alert(jx.base.nofield);return false}JxExport.executeExp(r,c);l.close()}}];var a=new Ext.Panel({layout:"border",items:[{xtype:"container",region:"center",layout:"fit",style:"border-top:1px solid #f2f2f2;",items:[g]}],buttonCls:"",buttonAlign:"left",buttons:o});var l=new Ext.Window({title:jx.base.seltitle,layout:"border",width:600,height:500,resizable:false,modal:true,closeAction:"close",items:[{xtype:"container",region:"west",layout:"fit",width:160,split:true,margins:"2 0 2 2"},{xtype:"container",region:"center",layout:"fit",margins:"2 2 2 0",items:[a]}]});var b=function(h){s.statGrid=h;h.on("rowclick",function(v,x,w){var i=v.getStore().getAt(x);if(i==null){return false}var u=i.get("sys_stat__stat_id");s.clickCase(u)});h.getStore().on("load",function(i){if(h.selectKeyId==null||h.selectKeyId.length==0){h.getSelectionModel().selectFirstRow();h.fireEvent("rowclick",h,0)}});h.gridNode.event.on("afterdelete",function(){s.createCase();h.selectKeyId=""});var c={where_sql:"fun_id = ? and (is_share = '1' or user_id = ?)",where_value:s.funid+";"+JxDefault.getUserId(),where_type:"string;string"};Jxstar.loadData(h,c)};Jxstar.createPage("sys_export","gridpage",l.getComponent(0),{pageType:"notool",showCall:b});l.on("destroy",function(){if(s.statGrid!=null){s.statGrid.destroy()}s.funId="";s.charFields=null;s.numFields=null;s.charLists=null;s.numLists=null;s.statGrid=null});l.show()},createCase:function(){var d=this;var a=d.charLists;var c=a.lsRight.getStore();var b=c.getRange(0,c.getCount());a.lsLeft.getStore().add(b);c.removeAll()},clickCase:function(c){var b=this;b.createCase();var a=function(h){var g=h.chars;var j=h.nums;var e=b.charLists;for(var f=0,l=g.length;f<l;f++){b.leftToRight(g[f].colcode,e.lsLeft,e.lsRight)}};var d="funid=sys_export&pagetype=grid&eventcode=selcase&keyid="+c;Request.dataRequest(d,a)},charFieldCt:function(){var a=this;a.charLists=new JxLists({leftData:a.charFields,leftHeader:"可选导出字段",rightHeader:"已选导出字段"});return a.charLists.render()},leftToRight:function(e,f,d){var a=f.getStore(),b=d.getStore();var c=a.findBy(function(h){return(h.get("value")==e)});if(c>-1){var g=a.getAt(c);b.add(g);a.removeAt(c)}},saveCase:function(){var b=this;var e=b.charLists.getSelectStore();if(e.getCount()==0){JxHint.alert("没有选择字段");return}var d=function(p,n){var l=encodeURIComponent;var m="",j="",o="",i="";e.each(function(s){m+=s.get("value")+",";j+=s.get("text")+","});m=m.substr(0,m.length-1);j=j.substr(0,j.length-1);var q=function(s){b.statGrid.selectKeyId=s.keyid;var r=b.statGrid.getStore();r.reload()};var h="funid=sys_export&statfunid="+b.funid+"&pagetype=grid&eventcode=savecase";h+="&keyid=&statname="+l(p)+"&chars="+l(m)+"&is_share="+n;h+="&chartitles="+l(j)+"&nums="+o+"&numtitles="+l(i)+"&stat_type= 1";Request.dataRequest(h,q)};var a=JxUtil.isAdminUser();var f={bodyStyle:"padding:20px 0 0 20px;",items:[{xtype:"textfield",fieldLabel:"方案名称",name:"stat_name",value:"方案1",allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",maxLength:50},{xtype:"checkbox",hidden:!a,fieldLabel:jx.query.share,name:"is_share"}]};var c={width:400,height:200};var g=function(i,j){var l=i.get("stat_name");if(l.length==0){JxHint.alert("必须填写方案名称");return false}var h=i.get("is_share");d(l,h);j.close()};JxUtil.formWindow({formcfg:f,wincfg:c,okcall:g})},executeExp:function(c,a){var b=c.page.getStore();var d=b.lastOptions.params||{};var e=c.nodeId;var f="funid=sysevent&query_funid="+e;f+="&pagetype=grid&eventcode=expxls&dataType=xls";f+="&selfield="+a+"&zerotonull=0";if(b.sortInfo&&b.remoteSort){f+="&sort="+b.sortInfo.field+"&dir="+b.sortInfo.direction}Request.expFile(f,d)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPrint={};(function(){Ext.apply(JxPrint,{hasReport:false,showWindow:function(c){var b=this;var e=c.nodeId;var d=function(j){var l=[];if(j==null||j.length==0){b.hasReport=false;l[0]={baseCls:"x-plain",border:false,html:'<font color="red">'+jx.print.noreport+"</font>"}}else{b.hasReport=true;for(var g=0,m=j.length;g<m;g++){var h={boxLabel:j[g].report_name,xtype:"radio",name:"reportId",inputValue:j[g].report_id,checked:false};if(g==0){h.checked=true}l[g]=h}}b.createWindow(e,l,c)};var f="funid=rpt_list&pagetype=grid&eventcode=listdata&selfunid="+e;var a=Jxstar.systemVar.sys__report__dept||"0";if(a=="1"&&(JxDefault.getRoleId()!="administrator")){f+="&deptid="+JxDefault.getDeptId()}else{f+="&deptid="}Request.dataRequest(f,d)},createWindow:function(e,d,g){var f=[{boxLabel:jx.print.outxls,name:"printType",inputValue:"xls",checked:true},{boxLabel:jx.print.outhtm,name:"printType",inputValue:"html"}];var b=Jxstar.systemVar.sys__report__isplug||"0";if(b=="1"){f[f.length]={boxLabel:"输出WEB",name:"printType",inputValue:"web"}}var i=Jxstar.systemVar.sys__attach__pdfprint||"0";if(i=="1"){f[f.length]={boxLabel:"输出PDF",name:"printType",inputValue:"pdf"}}var a=new Ext.form.FormPanel({style:"padding-top:10px;",border:false,frame:false,baseCls:"x-plain",items:[{baseCls:"xf-panel",title:jx.print.seltemp,autoHeight:true,hideLabels:true,style:"margin-left:10px;",items:d},{baseCls:"xf-panel",title:jx.print.outtype,autoHeight:true,defaultType:"radio",hideLabels:true,style:"margin-left:10px;",items:f},{baseCls:"xf-panel",title:jx.print.outrang,autoHeight:true,defaultType:"radio",hideLabels:true,style:"margin-left:10px;",items:[{boxLabel:jx.print.outrec,name:"printScope",inputValue:"select",checked:true},{boxLabel:jx.print.outall,name:"printScope",inputValue:"query"}]}]});var h=this;var c=new Ext.Window({title:jx.print.ptitle,width:300,height:480,autoScroll:true,resizable:false,modal:true,closeAction:"close",items:[a],buttons:[{text:jx.base.ok,disabled:(!h.hasReport),handler:function(){JxPrint.printReport(e,a.getForm(),g);c.close()}},{text:jx.base.cancel,handler:function(){c.close()}}]});c.show()},printReport:function(f,c,a){var b=c.findField("reportId").getGroupValue();var e=c.findField("printType").getGroupValue();var d=c.findField("printScope").getGroupValue();this.exePrint(a,f,b,e,d,"0")},exePrint:function(v,s,h,g,j,m){h=h||"";g=g||"xls";j=j||"select";m=m||"0";var i="";var a="";var q="";var d="0";if(j=="select"){i=this.selectWhere(v);if(i.length==0){JxHint.alert(jx.print.selectno);return false}d="1"}else{if(j=="query"){var o=this.queryWhere(v);i=o[0];a=o[1];q=o[2];d=o[3]}else{return false}}var u={reportId:h,printType:g,printScope:j,printMode:m};if(v.event.fireEvent("beforeprint",v.event,u)==false){return false}var p=encodeURIComponent;var r="funid="+s+"&reportId="+h+"&printType="+((g=="html"||g=="web")?"html":g)+"&printMode="+m+"&queryType="+d;var b="&whereSql="+p(i)+"&whereValue="+p(a)+"&whereType="+q;if(h.length==0){r+="&isDefault=1"}r+="&user_id="+Jxstar.session.user_id;if(typeof v.event.dataPrintParam=="function"){var t=v.event.dataPrintParam(u);if(t&&t.length>0){if(t.charAt(0)!="&"){t="&"+t}r+=t}}var l=Jxstar.path+"/reportAction.do?"+r;if("xls"==g){var f={whereSql:i,whereValue:a,whereType:q};this.postExpReport(l,f)}else{if("html"==g){var c=Jxstar.path+"/report/html/htmlprint.jsp";window.tmp_print_title="打印窗口";window.tmp_print_params=r+b;window.open(c)}else{if("web"==g){var c=l+b;this.LODOP_WEB(c)}else{if("pdf"==g){var n=Jxstar.systemVar.sys__attach__pdfurl||"";if(n.length==0){n=Jxstar.path}else{r+="&nocheck=1"}n+="/reportAction.do?"+r;var f={whereSql:i,whereValue:a,whereType:q};this.postExpReport(n,f,g)}}}}v.event.fireEvent("afterprint",v.event,u)},postExpReport:function(b,e,d){var c=Ext.get("frmExpReport");if(!c){c=Ext.DomHelper.append(Ext.getBody(),{tag:"form",method:"post",id:"frmExpReport",name:"frmExpReport",target:(d=="pdf"?"_blank":"frmhidden"),cls:"x-hidden",cn:[{tag:"input",name:"exp_text",id:"exp_text",type:"hidden"},{tag:"input",name:"whereSql",id:"whereSql",type:"hidden"},{tag:"input",name:"whereValue",id:"whereValue",type:"hidden"},{tag:"input",name:"whereType",id:"whereType",type:"hidden"}]},true)}var a=e||{};c.child("#whereSql").set({value:a.whereSql||""});c.child("#whereValue").set({value:a.whereValue||""});c.child("#whereType").set({value:a.whereType||""});c.dom.action=b;c.dom.submit()},queryWhere:function(a){var c=[4];var b=a.page.getStore().lastOptions.params||{};c[0]=b.where_sql||"";c[1]=b.where_value||"";c[2]=b.where_type||"";c[3]=b.query_type||"0";return c},selectWhere:function(d){var f=d.page;var c="";var b=d.define.pkcol;if(d.pageType.indexOf("form")>-1){var g=f.getForm().findField(b).getValue();if(g!=null&&g.length>0){c="'"+g+"'"}}else{var a=f.getSelectionModel().getSelections();if(a.length>0){for(var e=0,h=a.length;e<h;e++){c+="'"+a[e].get(b)+"',"}c=c.substring(0,c.length-1)}}if(c.length>0){c=b.replace("__",".")+" in ("+c+")"}return c},LODOP_IFRAME:null,LODOP_WEB:function(b){var c=this;if(typeof getLodop=="undefined"){JxUtil.loadJS("/report/html/LodopFuncs.js",true)}LODOP=getLodop();if(!LODOP){alert("没有安装打印插件，安装完成后需要重新登录系统，插件才能生效！");return}var a=c.LODOP_IFRAME;if(!a){a=c.LODOP_IFRAME=document.createElement("iframe");a.setAttribute("width",0);a.setAttribute("height",0);a.setAttribute("frameborder",0);document.documentElement.appendChild(a)}a.style.display="";var d=new Ext.LoadMask(Ext.getBody());d.show();a.src=b;if(JxExt.isIE){a.onreadystatechange=function(){if(this.readyState=="complete"){d.hide();d=null;c.LODOP_PREVIEW()}}}else{a.onload=function(){c.LODOP_PREVIEW();d.hide();d=null}}},LODOP_PREVIEW:function(){var g=this;LODOP.PRINT_INIT("WEB打印预览");var b=g.LODOP_IFRAME;var d=b.contentWindow.document;var l=d.getElementsByTagName("HEAD");var a;if(l&&l.length>0){var a=l[0].getElementsByTagName("STYLE");if(a&&a.length>0){a=a[0]}}var m=d.body.getElementsByTagName("TABLE");if(!m||m.length==0){alert("没有找到页面TABLE对象！");return}else{var j=m[0].clientWidth;var e=m[0].clientHeight;var f="<table border='0' width='100%' >";for(var c=0;c<m.length;c++){if(a){m[c].appendChild(a.cloneNode(true))}f=f+"<tr><td>";f=f+m[c].outerHTML;f=f+"</td></tr>"}f=f+"</table>";LODOP.ADD_PRINT_TABLE(0,0,j,e,f)}b.style.display="none";LODOP.SET_SHOW_MODE("HIDE_PAPER_BOARD",true);LODOP.PREVIEW()}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxHint={};(function(){var a;Ext.apply(JxHint,{hint:function(c){if(!a){a=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}a.alignTo(document,"t-t",[-20,0]);var b=Ext.DomHelper.append(a,{html:'<div class="msg-hint">'+c+"</div>"},true);b.slideIn("t").pause(2).ghost("t",{remove:true})},alert:function(b){Ext.Msg.alert(jx.base.hint,b)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxSelect={};(function(){Ext.apply(JxSelect,{createSelectWin:function(c,e,i){if(e.readOnly||e.disabled){return}JxLang.langSelectConfig(c);var g=false;if(c.isMoreSelect=="1"){g=true;c.pageType="selgrid"}var h=this;var b=c.nodeId;var d=Jxstar.findNode(b);if(d==null){JxHint.alert(String.format(jx.star.nopage,b));return}var f=function(p){var o=p(d,{pageType:c.pageType});if(typeof o.showPage=="function"){o=o.showPage(c.pageType)}var l=[o],n="fit",j=750,m=500;if(g){j=800;m=560;n="border";l=[{region:"south",xtype:"box",style:"border-top:1px solid #F0AD4E; background-color:#FFF;",height:68,id:"xsel_more_data",html:"<ul></ul>"},{region:"center",xtype:"container",layout:"fit",items:[o]}];JxSelect.selectMoreData={}}var q=new Ext.Window({title:jx.base.select+d.nodetitle,layout:n,width:j,height:m,border:false,modal:true,closeAction:"close",items:l});q.show();JxUtil.delay(500,function(){var t=o;if(!t.isXType("grid")){t=t.getComponent(1);if(t==null){JxHint.alert(jx.star.nogrid);return false}else{t=t.getComponent(0)}}var s=c.whereValue;s=h.parseWhereValue(s,e,i);if(t.isShow=="1"){Jxstar.loadData(t,{where_sql:c.whereSql,where_value:s,where_type:c.whereType})}else{t.jxstarParam.old_wsql=c.whereSql||"";t.jxstarParam.old_wtype=c.whereType||"";t.jxstarParam.old_wvalue=c.whereValue||""}t.on("rowdblclick",function(x,C,z){var v=JxUtil.getSelectRows(x);if(g){v=JxSelect.getMoreData()}if(v==null||v.length==0){var w=x.getStore();v=[];v[0]=JxUtil.emptyRecord(w)}else{if(!g){v=[v[0]]}}var y=e.getValue();var A=e.ownerCt;if(A&&A.initialConfig.name&&A.initialConfig.name.indexOf("_qv")>0){h.setControlData(v,e,c.sourceField,c.targetField)}else{var B=h.selectTagRecord(e,i);h.setSelectData(v,B,c.isSame,c.sourceField,c.targetField);if(i.indexOf("_editgrid")>0){h.fireAfterEdit(e,B,c)}}q.close();e.fireEvent("change",e,e.getValue(),y)});if(g){var u=t.getSelectionModel();var r=JxSelect.getMoreField(c.sourceField);u.on("rowselect",function(w,v,x){JxSelect.selRowData(r,d.pkcol,x)});u.on("rowdeselect",function(w,v,x){JxSelect.delMoreData(r,d.pkcol,x)})}})};var a=c.layoutPage;if(a==null||a.length==0){a=d.gridpage}if(a==null||a.length==0){JxHint.alert(String.format(jx.star.nopage,b));return}Request.loadJS(a,f)},selectMoreData:{},getMoreField:function(b){if(b.length==0){alert("找不到标签字段，不能添加！");return null}var a=b.split(";");if(a[0].length==0){alert("找不到标签字段，不能添加！");return null}return a[0].replace(".","__")},selRowData:function(d,g,b){if(!b){return}var h=b.get(g);if(!h){alert("找不到主键，不能添加！");return}var f=Ext.get("xsel_more_data").child("ul");var a=f.first("#"+h);if(a){}else{var c=f.insertHtml("beforeEnd",'<li class="x-seldata" id="'+h+'">'+b.get(d)+"</li>",true);var e=c.insertHtml("beforeEnd",'<span class="top-fun-img"><i class="fa eb_remco bigger-110"></i></span>',true);e.on("click",function(){JxSelect.delMoreData(d,g,b)});JxSelect.selectMoreData[h]=b}},delMoreData:function(c,e,b){var f=b.get(e);if(!f){alert("找不到主键，不能移除！");return}var d=Ext.get("xsel_more_data").child("ul");var a=d.first("#"+f);if(a){a.remove()}JxSelect.selectMoreData[f]=null;delete JxSelect.selectMoreData[f]},getMoreData:function(){var a=[],b=JxSelect.selectMoreData;for(k in b){a.push(b[k])}return a},createComboGrid:function(e,b,j){JxLang.langSelectConfig(e);var i=this;var d=e.nodeId;var h=b.parentField;b.on("beforeshow",function(){if(h.readOnly){return false}});var f=Jxstar.findNode(d);if(f==null){JxHint.alert(String.format(jx.star.nopage,d));return}var c=function(m){var l=e.whereValue;l=i.parseWhereValue(l,h,j);Jxstar.loadData(m,{where_sql:e.whereSql,where_value:l,where_type:e.whereType})};var g=function(m){var l=m(f,{pageType:e.pageType});if(typeof l.showPage=="function"){l=l.showPage(e.pageType)}l.height=328;b.add(l);b.doLayout();c(l);b.on("show",function(){c(l)});b.on("destroy",function(){e=null;j=null;c=null});l.on("rowclick",function(q,p,s){if(!b.isVisible()){return false}var n=JxUtil.getSelectRows(q);if(n==null||n.length==0){var o=q.getStore();n=[];n[0]=JxUtil.emptyRecord(o)}else{n=[n[0]]}var r=h.ownerCt;if(r&&r.initialConfig.name&&r.initialConfig.name.indexOf("_qv")>0){i.setControlData(n,h,e.sourceField,e.targetField)}else{var t=i.selectTagRecord(h,j);i.setSelectData(n,t,e.isSame,e.sourceField,e.targetField);if(j.indexOf("_editgrid")>0){i.fireAfterEdit(h,t,e)}}b.hide()})};var a=f.gridpage;if(a==null||a.length==0){JxHint.alert(String.format(jx.star.nopage,d));return}Request.loadJS(a,g)},fireAfterEdit:function(g,h,a){var f=g.el.findParentNode("div.x-grid-panel");var b=Ext.getCmp(f.id);if(b){var d=a.fieldName.replace(".","__");var c={grid:b,record:h,field:d,originalValue:g.getValue(),value:h.get(d)};b.fireEvent("afteredit",c)}},parseWhereValue:function(d,f,i){var h=this;if(d!=null&&d.indexOf("{")>=0){var a=function(j){if(!j){return null}var n=JxUtil.getParentForm(j);var o=null;if(n){o=n.myRecord}if(!o){var m=JxUtil.getParentGrid(j);if(m){var l=JxUtil.getSelectRows(m);if(l&&l.length>0){o=l[0]}}}return o};if(i.indexOf("grid")>=0){var e=f.el.findParentNode("div.x-grid-panel");var g=Ext.getCmp(e.id);var c=a(g);if(c){d=JxUtil.parseWhereValue(d,c,true)}}if(i.indexOf("form")>=0){var b=f.ownerCt;if(b.isXType("form")==false){b=b.findParentByType("form")}var g=b.getForm().myGrid;var c=a(g);if(c){d=JxUtil.parseWhereValue(d,c,true)}}}if(d!=null&&d.indexOf("[")>=0){var c=h.selectTagRecord(f,i);d=JxUtil.parseWhereValue(d,c)}return d},selectTagRecord:function(g,b){var h;if(b.indexOf("grid")>=0){var f=g.el.findParentNode("div.x-grid-panel");var c=Ext.getCmp(f.id);if(c){var e=c.lastEdit;if(e){h=c.getStore().getAt(e.row)}else{var a=JxUtil.getSelectRows(c);if(a&&a.length>0){h=a[0]}}}}else{var d=g.ownerCt;if(d.isXType("form")==false){d=d.findParentByType("form")}if(d){h=d.getForm()}}if(Ext.isEmpty(h)){JxHint.alert(jx.star.notag)}return h},setControlData:function(m,j,a,p){var s=this;var r=j.ownerCt;if(r.isXType("toolbar")){var q=a.split(";");var o=p.split(";");if(q[0].length==0||o[0].length==0){JxHint.alert(jx.star.noselfield);return false}var e=q[0].split(".")[0];for(var g=0,d=q.length;g<d;g++){if(q[g].length==0||o[g]==null||o[g].length==0){continue}var l=q[g].split(".");if(l.length>1){f=l[0]+"__"+l[1];e=l[0]}else{f=e+"__"+q[g]}var b=s.getValue(m,f);var c=o[g].replace(".","__");var h=r.find("name",c);if(h==null||h.length==0){continue}h[0].setValue(b)}}else{var f=a.split(";")[0].replace(".","__");if(f==null||f.length==0){JxHint.alert(jx.star.nosrc);return false}var b=s.getValue(m,f);j.setValue(b)}},setSelectData:function(e,m,p,t,n){var l=this;var q,a;var d=m.data;if(d==null){d=m.getFieldValues()}if(p=="1"){for(q in e[0].data){var c=q.split("__")[1];for(a in d){var h=a.split("__")[1];if(c.indexOf("auditing")<0&&c==h){m.set(a,l.getValue(e,q))}}}}if(t!=null&&t.length>0){var s=t.split(";");var g=n.split(";");var r=s[0].split(".")[0];var b=g[0].split(".")[0];for(var o=0;o<s.length;o++){if(s[o].length==0||g[o]==null||g[o].length==0){continue}var f=s[o].split(".");if(f.length>1){q=f[0]+"__"+f[1];r=f[0]}else{q=r+"__"+s[o]}var j=g[o].split(".");if(j.length>1){a=j[0]+"__"+j[1];b=j[0]}else{if(g[o].indexOf("__")>0){a=g[o]}else{a=b+"__"+g[o]}}m.set(a,l.getValue(e,q))}}},initCombo:function(h,f,d,a){var c=this;f.pageSize=10;f.minListWidth=350;f.typeAhead=false;f.minChars=0;f.itemSelector="div.search-item";f.queryParam="where_value";f.loadingText="正在查询...";f.listEmptyText="没有找到数据...";f.isAll=f.isAll||a||(Jxstar.systemVar.edit__combo__all=="1");var e=f.getName();var b=function(B){var y=B.selcfg;if(!y||!B.fields){JxHint.alert(String.format(jx.star.selnot,e));return}var i=y.nodeId;var p=y.queryField||"",A=y.sourceField||"";if(p.length==0&&A.length==0){JxHint.alert(String.format(jx.star.selsrc,e));return}var s=c.comboWhere(y);var x=encodeURIComponent;var n=Jxstar.path+"/commonAction.do?eventcode=query_data&funid=queryevent&pagetype=grid";n+="&query_funid="+i+"&where_sql="+x(s.where_sql)+"&where_type="+s.where_type+"&user_id="+Jxstar.session.user_id;var o=new Ext.data.Store({proxy:new Ext.data.HttpProxy({method:"POST",url:n}),reader:new Ext.data.JsonReader({root:"data.root",totalProperty:"data.total"},B.fields)});f.store=o;var t={},v=0;Ext.each(B.fields,function(j){if(j.type=="date"){v++;t[j.name]=j}});var u=B.design,z=0,q=[],w=0;Ext.each(u,function(j){if(!j.h){z+=j.w;if(v>0&&t[j.n]){var D=t[j.n].dateFormat;q[w++]='<td style="width:'+j.w+'px;">{[values.'+j.n+" ? values."+j.n+'.format("'+D+'") : ""]}</td>'}else{q[w++]='<td style="width:'+j.w+'px;">{'+j.n+"}</td>"}}});var C=new Ext.XTemplate('<tpl for="."><div class="search-item" style="width:'+z+'px;border-bottom:1px dotted #a3bae9;">','<table border=0 style="width:100%;font-size:13px;"><tr>',q.join(""),"</tr></table>","</div></tpl>");f.tpl=C;f.on("beforequery",function(F){var E=F.combo;var D=E.isAll;var j=y.likeType;var J="",H="";for(var G=0;G<s.plen;G++){H=D?"%;":(((j=="left")?"":"%")+F.query+"%;");J+=H}s.where_value=c.parseWhereValue(y.whereValue,E,d);var I=s.where_value;if(J.length>0){J=J.substr(0,J.length-1);if(I&&I.length>0){J=I+";"+J}}else{J=I}F.query=J});var m=function(D,E,j){var F=D.ownerCt;if(F&&F.initialConfig.name&&F.initialConfig.name.indexOf("_qv")>0){c.setControlData([E],D,y.sourceField,y.targetField)}else{var G=c.selectTagRecord(D,d);c.setSelectData([E],G,y.isSame,y.sourceField,y.targetField);if(d.indexOf("grid")>=0){D.setValue(G.get(D.getName()));if(j){c.fireAfterEdit(D,G,y)}}}};f.on("select",function(j,D,E){m(j,D);j.selValue=j.getValue()});f.on("focus",function(j){j.selValue=j.getValue()});var r=y.isReadonly;f.on("blur",function(j){if(d.indexOf("form")>=0){var E=j.getValue();if(E.length==0||(j.selValue&&j.selValue!=E)){var D=JxUtil.emptyRecord(o);m(j,D)}if(r=="0"){j.setValue(E)}}});if(d.indexOf("grid")>=0){var l=f.gridEditor;if(l){l.on("complete",function(D,F,G){if(Ext.isEmpty(F)&&Ext.isEmpty(G)){return}var E=D.field;if(F.length==0||(F!=G&&F!=E.selValue)){var j=JxUtil.emptyRecord(o);m(E,j,true)}if(r=="0"){D.setValue(F)}})}}if(f.list){f.view.tpl=f.tpl;f.bindStore(o,false)}};var g="funid=queryevent&selfunid="+h;g+="&colcode="+e.replace("__",".")+"&pagetype=grid&eventcode=query_selctl";Request.dataRequest(g,b)},getValue:function(a,g){var d=(a.length>1);if(d){var f="";for(var c=0,h=a.length;c<h;c++){f+=a[c].get(g)+";"}return f}else{var f=a[0].get(g);if(f==null){var e=g.split("__");if(e.length>1&&e[1].length>0){var b=e[1];if(b.charAt(0)=="["&&b.charAt(b.length-1)=="]"){f=b.substring(1,b.length-1)}}}return f}},comboWhere:function(a){var l=a.whereSql;var c=a.whereValue;var m=a.whereType;var b=a.queryField,h=0;if(b&&b.length>0){var f=b.split(";"),e="",j="";for(var d=0;d<f.length;d++){if(f[d].length>0){e+=f[d]+" like ? or ";j+="string;";h++}}if(e.length>0){if(l.length>0){l="("+l+") and "}if(m.length>0){m=m+";"}l+="("+e.substr(0,e.length-4)+")";m+=j.substr(0,j.length-1)}}else{var g=a.sourceField;if(g&&g.length>0){b=g.split(";")[0];if(b.length>0){if(l.length>0){l="("+l+") and "}l=l+b+" like ?";if(m.length>0){m=m+";"}m=m+"string";h=1}}}return{where_sql:l,where_value:c,where_type:m,plen:h}},createCheckTree:function(f,c,r){JxLang.langSelectConfig(f);var p=this;var d=f.nodeId;var j=c.parentField;var o=f.isMoreSelect||"0";var b=f.sourceField;var i=Jxstar.findNode(d);if(i==null){JxHint.alert(String.format(jx.star.nopage,d));return}if(b.length==0){JxHint.alert("必须有来源字段定义！");return}c.on("destroy",function(){f=null;r=null});var a=function(s,e){var t={};var x=s.attributes;var v=e.split(";");var z=v[0].split(".")[0];for(var u=0;u<v.length;u++){if(v[u].length==0){continue}var w=v[u].split(".");if(w.length==1){t[z+"__"+w]=x[w]}else{var y=v[u].replace(".","__");t[y]=x[w[1]]}}return new Ext.data.Record(t)};var n=function(B){if(!c.isVisible()){return false}var D=[];if(o=="1"){var e=q.getChecked(),x,A;Ext.each(e,function(G){if(!x){x=a(G,b)}else{A=a(G,b);Ext.iterate(x.data,function(H,I){x.data[H]+=";"+A.data[H]})}});if(x){D[0]=x}}else{var u=q.getSelectionModel().getSelectedNode();if(u){D[0]=a(u,b)}}if(B=="0"){var w={};var z=b.split(";");var F=z[0].split(".")[0];for(var v=0;v<z.length;v++){if(z[v].length==0){continue}var y=z[v].split(".");if(y.length==1){w[F+"__"+y]=""}else{var C=z[v].replace(".","__");w[C]=""}}D[0]=new Ext.data.Record(w)}else{if(D==null||D.length==0){JxHint.alert("没有选择记录！");return}}var E=j.ownerCt;if(E&&E.initialConfig.name&&E.initialConfig.name.indexOf("_qv")>0){p.setControlData(D,j,f.sourceField,f.targetField)}else{var t=p.selectTagRecord(j,r);p.setSelectData(D,t,f.isSame,f.sourceField,f.targetField)}c.hide();var s="",e=q.getChecked();Ext.each(e,function(G){if(s.length>0){s+=", "}s+=G.text})};var m=Jxstar.path+"/commonAction.do?eventcode=query_tree&funid=queryevent&add_grid=1";m+="&add_check="+o;m+="&tree_funid="+i.nodeid+"&user_id="+Jxstar.session.user_id;var g=f.whereValue;g=p.parseWhereValue(g,j,r);var l=encodeURIComponent;m+="&where_sql="+f.whereSql+"&where_value="+l(g)+"&where_type="+f.whereType;var h=new Ext.Toolbar({items:[{iconCls:"eb_select",text:"选择",handler:function(){n()}},{iconCls:"eb_clear",text:"清除",handler:function(){n("0")}},{iconCls:"eb_refresh",text:"刷新",handler:function(){q.getLoader().load(q.getRootNode())}}]});var q=new Ext.tree.TreePanel({tbar:h,border:false,height:295,autoScroll:true,rootVisible:false,lines:false,useArrows:false,loader:new Ext.tree.TreeLoader({dataUrl:m}),root:new Ext.tree.AsyncTreeNode({id:"10",iconCls:"tree_root_ext",text:"刷新"})});if(o!="1"){q.on("dblclick",function(e){n()})}c.add(q);c.doLayout()}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxFormSub={};(function(){Ext.apply(JxFormSub,{formAddTab:function(f){var o=f.param;if(o.showFormSub){return}else{o.showFormSub=true}var l=Jxstar.findNode(o.funid);if(l.showFormSub===false){return}var b={xtype:"tabpanel",cls:"sub_tab",activeTab:0,deferredRender:false,border:false,anchor:"100%",height:300,items:[],listeners:{tabchange:function(j,n){var i=n.getComponent(0);if(i&&i.fkValue){Jxstar.loadSubData(i,i.fkValue)}},beforetabchange:function(i,j,n){if(l.isCloud&&j.tabtooler&&n.tabtooler){j.tabtooler.show();n.tabtooler.hide()}}}};var d=l.subfunid;if(Ext.isEmpty(d)){return}var c=l.notTabFunId||"";if(c.length>0){d=c}var g=0;var a=d.split(",");for(var h=0,e=a.length;h<e;h++){var p=a[h];if(p.length==0){continue}var m=Jxstar.findNode(p);m.showInForm=true;if(l.isCloud){m.isCloud=true}b.items[g++]={title:m.nodetitle,showType:"inform",data:p,layout:"fit",hideCollapseTool:true}}if(g>0){Ext.apply(b,o.subConfig);o.items[o.items.length]=b}},formAddSub:function(d){var p=d.param;if(p.showFormSub){return}else{p.showFormSub=true}var g=Jxstar.findNode(p.funid);if(g.showFormSub===false){return}var j=g.subfunid;if(j==null||j.length==0){return}var b=g.notTabFunId||"";if(b.length>0){j=b}var q=g.subExpand||false;var m=p.items;var h=j.split(",");for(var e=0,c=h.length;e<c;e++){var r=h[e];if(r.length==0){continue}var f=Jxstar.findNode(r);var o=f.nodetitle;f.showInForm=true;var l=(e>0);if(q){l=false}var a={title:o,showType:"inform",baseCls:"xs-panel",data:r,cls:"sub_panel",border:false,layout:"fit",hideCollapseTool:true,collapsible:true,collapsed:l,anchor:"100%",height:200};if(g.isCloud){f.isCloud=true;a.iconCls="x-tool-toggle"}Ext.apply(a,p.subConfig);m[m.length]=a}},formShowSub:function(b){this.formShowFile(b);var g=b.event;var l=b.page;var p=b.param;var j=b.define;var f=false;var o=null;var q=l.find("cls","sub_panel");if(Ext.isEmpty(q)){var m=l.find("cls","sub_tab");if(!Ext.isEmpty(m)){o=m[0];q=m[0].items.getRange();if(!Ext.isEmpty(q)){f=true}}}if(j.isCloud&&l.ownerCt){var d=l.ownerCt.ownerCt;if(d&&d.initialConfig.cls=="form-tab"){var e=d.getComponent(1).find("cls","sub_panel");if(Ext.isEmpty(q)){q=e}else{q.push(e)}}}if(Ext.isEmpty(q)){return}l.subgrids=q;for(var h=0,c=q.length;h<c;h++){var a={pageType:"subgrid",parentNodeId:b.nodeId};if(j.isCloud){a.showCall=function(i){JxCloud.addTools(i)}}Jxstar.createPage(q[h].data,"gridpage",q[h],a)}g.on("initother",function(r){if(q==null||q.length==0){return}var v=r.define;var n=r.form;var i=v.pkcol;var u=n.get(i);var t=function(){for(var A=0,x=q.length;A<x;A++){var B=q[A];var G=B.getComponent(0);G.parentForm=l;if(u==null||u.length==0){G.getStore().removeAll();G.fkValue="";var y=G.pagebar;if(y){y.fireEvent("change",y,{total:0})}}else{var I=G.getStore();var C=I.getModifiedRecords();if(C.length>0){I.commitChanges()}else{G.enable();G.fkValue=u;if(f){if(o&&(o.getActiveTab()==B)){Jxstar.loadSubData(G,u)}}else{Jxstar.loadSubData(G,u)}}}if(p.subResizable&&B.el&&(B.outRe==null)){var H=new Ext.Resizable(B.el,{minHeight:180,minWidth:600,listeners:{resize:function(L,J,K){L.innerCmp.setWidth(J);L.innerCmp.setHeight(K)}}});H.innerCmp=B;B.outRe=H;B.on("destroy",function(J){J.outRe.destroy(true);J.outRe=null;delete J.outRe})}if(v.auditcol.length>0){var F="0",E="2",D="6";if(v.status){F=v.status.audit0;E=v.status.audit2}var w=n.get(v.auditcol);if(w==null||w.length==0){w=F}var z=(w!=F&&w!=D);JxUtil.delay(500,function(L){if(L.disabled===true){z=true}var M;if(v.isCloud){JxUtil.disCloudTool(L,z);M=JxUtil.getCloudTool(L)}else{M=L.getTopToolbar();JxUtil.disableButton(M,z)}var K=L.gridNode.define;var N=K.subChkEdit||false;if(b.pageType.indexOf("chk")>=0&&N&&w==E){var J=JxUtil.getButton(M,"save_eg");if(J){if(J.enable){J.enable()}else{J.disabled=false}}else{J=JxUtil.getButton(l.getTopToolbar(),"save_chk");if(J.enable){J.enable()}else{J.disabled=false}}}},this,[G])}}};var s=q[0].getComponent(0);if(s){t()}else{JxUtil.delay(500,t)}});this.initother(g)},initother:function(a){if(a.isreg){return}a.on("beforecreate",function(b){a.fireEvent("initother",a)});a.on("aftercreate",function(b){a.fireEvent("initother",a)});a.on("afteraudit",function(b){a.fireEvent("initother",a)});a.on("aftercustom",function(b){a.fireEvent("initother",a)});a.isreg=true},formAddFile:function(d){var e=d.param;var g=Jxstar.findNode(e.funid);var c="form_file_"+JxUtil.newId();var b='<iframe frameborder="no" style="display:none;border-width:0;width:100%;height:100%;" ></iframe>';var f=d.param.attach_type||"";var a={id:c,showType:"inform",baseCls:"xs-panel",iconCls:"x-tool-toggle",attach_type:f,cls:"sub_file",border:false,layout:"fit",hideCollapseTool:true,collapsible:true,collapsed:false,anchor:"100%",height:55,items:[{xtype:"container",html:b}]};e.form_fileid=c;e.items[e.items.length]=a},formShowFile:function(c){var a=c.param.form_fileid;if(!a){return}var b=c.event;b.on("initother",function(g){var l=g.define;var h=g.form;var o=l.editCheckFile||false;var i=h.get(l.pkcol);if(!i||i.length==0){i=h.tmpKeyId}var p="0";if(l.status){p=l.status.audit0}var f=h.get(l.auditcol);if(f==null||f.length==0){f=p}var j=(f!=p&&f!="6");if(f=="2"&&o){j=false}var m=Ext.getCmp(a);var d=m.initialConfig.attach_type||"";var e=Jxstar.path+"/jxstar/other/upload/formfile.jsp?winid="+a+"&attach_type="+d+"&dataid="+i+"&datafunid="+l.nodeid+"&disable="+j+"&tablename="+l.tablename+"&user_id="+Jxstar.session.user_id;if(!m.getEl()){return}var n=m.getEl().child("iframe");n.dom.src=e+"&_dc="+(new Date()).getTime();n.show()});this.initother(b)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxSearch={};(function(){Ext.apply(JxSearch,{funid:"",gridHis:null,gridDet:null,storeDet:null,queryWindow:function(c,d){var b=this;b.funid=d.nodeId;b.gridHis=b.historyGrid(c);b.gridDet=b.conditionGrid(d);var a=new Ext.Container({layout:"border",items:[{xtype:"container",region:"west",layout:"fit",split:true,width:155,items:[b.gridHis]},{xtype:"container",region:"center",layout:"fit",items:[b.gridDet]}]});var e=d.page.qryCondData;if(!e){JxUtil.delay(200,function(){var f=b.gridHis.getStore().getCount();if(f>0){b.gridHis.getSelectionModel().selectRow(0);b.gridHis.fireEvent("rowclick",b.gridHis,0)}})}d.condGrid=b.gridDet;a.on("beforedestroy",function(){d.condGrid=null;delete d.condGrid});return a},historyGrid:function(n){var m=this;var d=new Ext.data.ArrayStore({fields:[{name:"query_id"},{name:"query_name"},{name:"is_share"},{name:"user_id"}]});var e=[];for(var f=0,g=n.root.length;f<g;f++){var l=[];l[0]=n.root[f].query_id;l[1]=n.root[f].query_name;l[2]=n.root[f].is_share;l[3]=n.root[f].user_id;e[f]=l}d.loadData(e);var j=function(){var o=JxUtil.getSelectRows(m.gridHis);if(!JxUtil.selectone(o)){return false}var i=o[0].get("user_id");if(i.length>0&&i!=JxDefault.getUserId()){JxHint.alert(jx.query.deluser);return false}var p=function(){var q=o[0].get("query_id");var r="funid=sysevent&pagetype=grid&eventcode=cond_delete";r+="&query_id="+q;Request.postRequest(r,function(){d.remove(o[0]);var s=d.getCount();if(s>0){m.gridHis.getSelectionModel().selectRow(0);m.gridHis.fireEvent("rowclick",m.gridHis,0)}else{m.storeDet.removeAll();m.gridDet.fkValue=""}})};Ext.Msg.confirm(jx.base.hint,jx.event.delyes,function(q){if(q=="yes"){p()}})};var a=function(){var i=this;var p="funid=sysevent&pagetype=grid&eventcode=cond_case";d.each(function(q){p+="&query_name="+q.get("query_name")+"&is_share="+q.get("is_share")+"&query_id="+q.get("query_id")});var o=function(){d.commitChanges()};Request.postRequest(p,o)};var b=new Ext.Toolbar({deferHeight:true,items:[{text:jx.cloud.text18,handler:function(){}}]});var c=new Ext.grid.RowSelectionModel();var h=new Ext.grid.EditorGridPanel({store:d,columns:[{header:jx.query.casex,width:154,dataIndex:"query_name",editable:true,editor:new Ext.form.TextField({maxLength:50,allowBlank:false}),renderer:function(r,o,i,s,q,p){return r+'<span class="x-btn-rowin"><i class="ace-icon fa fa-edit"></i><i class="ace-icon fa eb_delete"></i></span>'}},{header:jx.query.pub,width:50,dataIndex:"is_share",editable:true,editor:new Ext.form.Checkbox(),hidden:true,renderer:function(i){return i=="1"?jx.base.yes:jx.base.no}},{header:"query_id",hidden:true,dataIndex:"query_id"},{header:"user_id",hidden:true,dataIndex:"user_id"}],sm:c,frame:false,border:false,enableColumnMove:false,enableHdMenu:false,stripeRows:false,viewConfig:{headersDisabled:true,markDirty:false}});h.on("rowclick",function(q,t,r){var i=q.getStore().getAt(t);if(i==null){return false}var p=i.get("query_id");var o=function(v){m.storeDet.removeAll();var y=[];for(var w=0,u=v.root.length;w<u;w++){var x=[];x[0]=v.root[w].left_brack;x[1]=v.root[w].colcode.replace(".","__");x[2]=v.root[w].condtype;x[3]=v.root[w].cond_value;x[4]=v.root[w].right_brack;x[5]=v.root[w].andor;x[6]=v.root[w].coltype;x[7]=v.root[w].col_no;y[w]=x}m.storeDet.loadData(y);m.gridDet.getView().refresh();m.gridDet.fkValue=p};var s="funid=queryevent&eventcode=cond_qrydet";s+="&query_id="+p;Request.dataRequest(s,o)});h.on("rowclick",function(p,r,q){if(!q){return}var o=q.getTarget();var i=o.tagName.toUpperCase();if(i=="I"){if(o.className.indexOf("eb_delete")>-1){j()}if(o.className.indexOf("fa-edit")>-1){p.startEditing(r,0)}}});h.on("afteredit",function(i){a()});return h},saveQuery:function(c,e){if(c.editor){c.editor.stopEditing()}var d=c.storeDet.getCount();if(d==0){JxHint.alert(jx.query.condempty);return false}var g=c.gridDet.fkValue;if(g!=null&&g.length>0&&!e){c.saveQueryFn(g);return}var b=JxUtil.isAdminUser();var a=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:120,border:false,frame:false,items:[{xtype:"textfield",fieldLabel:jx.query.casename,name:"query_name",allowBlank:false,labelSeparator:"*",anchor:"95%",labelStyle:"color:#0077FF;",maxLength:50},{xtype:"checkbox",hidden:!b,fieldLabel:jx.query.share,name:"is_share"}]});var f=new Ext.Window({title:jx.query.savetitle,layout:"fit",width:400,height:220,resizable:false,modal:true,closeAction:"close",bodyStyle:"padding-top:20px;",items:[a],buttons:[{text:jx.base.ok,handler:function(){var j=a.getForm();var i=j.findField("is_share").getValue();var h=j.findField("query_name").getValue();if(h.length==0){JxHint.alert(jx.query.noname);return false}var l="&is_share="+i;l+="&query_name="+encodeURIComponent(h);c.saveQueryFn("",l,f)}},{text:jx.base.cancel,handler:function(){f.close()}}]});f.show();JxUtil.delay(200,function(){a.get(0).focus(true)})},saveQueryFn:function(d,f,b){var a=this;var e="funid=sysevent&selfunid="+a.funid;e+="&pagetype=grid&eventcode=cond_save&query_id="+d;a.storeDet.each(function(g){e+="&"+Ext.urlEncode(g.data)});if(f){e+=f}var c=function(h){if(d.length==0){h.user_id=JxDefault.getUserId();var g=new (a.gridHis.getStore().reader.recordType)(h);a.gridHis.getStore().insert(0,g)}a.gridHis.getSelectionModel().selectRow(0);a.gridHis.fireEvent("rowclick",a.gridHis,0);if(b){b.close()}};Request.postRequest(e,c)},conditionGrid:function(K){var x=this;var B=new Ext.data.ArrayStore({fields:[{name:"left_brack"},{name:"colcode"},{name:"condtype"},{name:"cond_value"},{name:"right_brack"},{name:"andor"},{name:"coltype"},{name:"col_no"}]});B.on("load",function(c){JxUtil.delay(100,function(){if(c.getCount()>0){e.startEditing(0,true);p(v,true);x.gridDet.getSelectionModel().selectRow(0)}else{y()}})});x.storeDet=B;var u=function(L){x.storeDet.removeAll();var h=[];for(var n=0,c=L.length;n<c;n++){var M=[];M[0]=L[n].left_brack;M[1]=L[n].colcode.replace(".","__");M[2]=L[n].condtype;M[3]=L[n].cond_value;M[4]=L[n].right_brack;M[5]=L[n].andor;M[6]=L[n].coltype;M[7]=L[n].col_no;h[n]=M}x.storeDet.loadData(h)};var a=K.page.qryCondData||[];u(a);var e=new Ext.ux.grid.RowEditor({name:JxUtil.newId()+"_qv",saveText:jx.base.ok,cancelText:jx.base.cancel,monitorValid:false,clicksToEdit:1,ajustWidth:-50});x.editor=e;var G=new Ext.grid.RowSelectionModel();var q=K.id+"_hqf";var w=K.page.getColumnModel();var b=[],r=w.config;for(var C=0,I=0,z=r.length;C<z;C++){var g=r[C],o=g.dataIndex;if(o==null||o.length==0){continue}if(g.colindex>=10000){continue}var F=o.length;if(o.substring(F-2)!="id"||!g.hidden){var E=g.header;if(!Ext.isNumber(E)){if(E.charAt(0)=="*"){E=E.substr(1)}b[I++]=[o,E]}}}var v=Jxstar.createCombo(q,b,100);var A=K.id+"_hqc";var d=ComboData.condtype;var l=Jxstar.createCombo(A,d);var J=K.id+"_hqa";var j=[["and",jx.query.and],["or",jx.query.or]];var s=Jxstar.createCombo(J,j);var p=function(Y,X){var c,R="string";var Q=K.param.cols;for(var U=0,T=Q.length;U<T;U++){var aa=Q[U].col,Z=Q[U].field;if(Z&&Z.name==Y.getValue()){R=Z.type;if(!aa.hasOwnProperty("editor")){if(R=="string"){c=new Ext.form.TextField({allowBlank:false})}else{if(R=="date"){var V=JxUtil.getDateFormat(aa.renderer);c=new Ext.form.DateField({format:V,allowBlank:false})}else{c=new Ext.form.NumberField({allowBlank:false,maxLength:12})}}}else{var S=aa.editor;var W=false;if(S.isXType("combo")&&S.mode=="local"){W=true}Ext.apply(S.initialConfig,{allowBlank:true,editable:!W,cls:""});c=new S.constructor(S.initialConfig)}break}}if(c==null){c=new Ext.form.TextField({allowBlank:false})}if(X){var P=e.rowIndex;var M=B.getAt(P);var L="";if(M!=null){L=M.get("cond_value")}if(c.isXType("datefield")){L=Ext.isDate(L)?L.dateFormat("Y-m-d"):L;if(L.length>0){L=L.split(" ")[0]}L=Date.parseDate(L,"Y-m-d")}c.setValue(L)}var h=3;var N=e.getComponent(h);var O=N.getXType();if(!(N.getXType()==c.getXType()&&(O=="textfield"||O=="datefield"))){e.remove(e.getComponent(h),true);e.insert(h,c);e.verifyLayout()}else{N.setValue(c.getValue());c.destroy();c=N}c.selectOnFocus=true;x.setCondDefault(l,R,c.getXType());if(e.record){e.record.set("coltype",R);e.record.set("colcode",Y.getValue());e.record.set("condtype",l.getValue());e.record.set("cond_value",c.getValue())}};v.on("select",function(c){p(c,false)});l.on("select",function(c){if(e.record){e.record.set("condtype",c.getValue())}});var m=new Ext.grid.ColumnModel([{id:"left_brack",header:"（",width:30,hidden:true,dataIndex:"left_brack",editor:new Ext.form.TextField()},{id:"colcode",header:jx.query.colcode,width:160,dataIndex:"colcode",editor:v,renderer:function(h){for(var c=0;c<b.length;c++){if(b[c][0]==h){return b[c][1]}}}},{id:"condtype",header:jx.query.cond,width:130,dataIndex:"condtype",editor:l,renderer:function(h){for(var c=0;c<d.length;c++){if(d[c][0]==h){return d[c][1]}}}},{id:"cond_value",header:jx.query.value,width:190,dataIndex:"cond_value",editor:new Ext.form.TextField(),renderer:function(c){var c=Ext.isDate(c)?c.format("Y-m-d"):c;if(c.length>0&&c.indexOf(" 00:00:00")>=0){c=c.split(" ")[0]}return c}},{id:"right_brack",header:"）",width:30,hidden:true,dataIndex:"right_brack",editor:new Ext.form.TextField()},{id:"andor",header:jx.query.andor,width:50,hidden:true,dataIndex:"andor",editor:s,renderer:function(h){for(var c=0;c<j.length;c++){if(j[c][0]==h){return j[c][1]}}}},{xtype:"actioncolumn",width:50,items:[{icon:"resources/images/icons/fam/clear.gif",tooltip:"删除",handler:function(h,i,c){B.removeAt(i)}}]},{id:"col_no",header:jx.query.colno,width:40,hidden:true,dataIndex:"col_no",editor:new Ext.form.TextField()},{id:"coltype",dataIndex:"coltype",hidden:true},{id:"colname",dataIndex:"colname",hidden:true}]);var y=function(){var i=new (B.reader.recordType)({left_brack:"",colcode:b[0][0],condtype:"",cond_value:"",right_brack:"",andor:j[0][0],coltype:"string",col_no:"0"});var h=B.getCount();B.insert(h,i);f.getView().refresh();f.getSelectionModel().selectRow(h);e.startEditing(h);p(v,false)};var H=function(){e.stopEditing();var h=f.getSelectionModel().getSelections();if(h==null||h.length==0){JxHint.alert(jx.query.delcond);return false}for(var c=0,n;n=h[c];c++){B.remove(n)}};var t=function(){e.stopEditing();if(B.getCount()==0){JxHint.alert(jx.query.nocond);return false}B.singleSort("colcode");var h=[],L=0;for(var n=0;n<B.getCount();n++){var c=B.getAt(n);var N=c.get("cond_value");if(Ext.isEmpty(N)){continue}h[L]=Ext.apply({},c.data);L++}var M=x.getQuery(B);if(M==null){return false}B.commitChanges();Jxstar.myQuery(K.page,M,"1");K.page.qryCondData=h;var P=K.page.getTopToolbar();if(P){P.getComponent("qidx").setVisible(true)}var O=f.findParentByType("window");if(O){O.close()}};var D=[{text:jx.cloud.text16,handler:y,iconCls:"eb_add",cls:"x-btn-white"},"->",{text:jx.cloud.text17,cls:"x-btn-white",handler:function(){x.saveQuery(x,true)}},{text:jx.base.query,iconCls:"eb_qry",handler:t}];var f=new Ext.grid.GridPanel({store:B,cm:m,sm:G,plugins:[e],frame:false,border:false,enableHdMenu:false,enableColumnMove:false,stripeRows:false,columnLines:false,viewConfig:{headersDisabled:true,markDirty:false},buttonCls:"",buttonAlign:"left",buttons:D});f.on("rowclick",function(c,h){p(v,true)});return f},getQuery:function(f){if(f==null||f.getCount()==0){return null}var e=new Array("","","");var b=false;var p="",q="";for(var r=0,o=f.getCount();r<o;r++){var w=null,m=null;if(f.getAt){w=f.getAt(r).data;if(r<o-1){m=f.getAt(r+1).data}}else{w=f.itemAt(r);if(r<o-1){m=f.itemAt(r+1)}}var c=w.cond_value;if(Ext.isEmpty(c)){continue}var t=w.left_brack;var h=w.colcode.replace("__",".");var d=w.condtype;var j=w.right_brack;var v=w.andor;if(!v||v.length==0){v="and"}var l=w.coltype;if(m&&l=="string"){var u=m.colcode.replace("__",".");if(u==h){v="or";if(b===false){h="("+h;b=true}}else{if(b===true){v=") "+v;b=false}}}else{if(b===true){v=") "+v;b=false}}p+=t.trim();q+=j.trim();if(c=="~null~"){if(d=="<>"){e[0]+=h+" is not null "+v+" "}else{e[0]+=h+" is null "+v+" "}continue}c=Ext.isDate(c)?c.dateFormat("Y-m-d"):c;var a=this.getQueryValue(c,d,l);if(d=="="&&l=="date"){e[0]+=t;e[0]+="("+h+" >= ? and "+h+" < ? )";e[0]+=j;e[0]+=" "+v+" ";var g=JxUtil.getNextDate(a[0],1);e[1]+=a[0]+";"+g+";";e[2]+=l+";"+l+";"}else{e[0]+=t;e[0]+=h+this.getCondType(d)+"?";e[0]+=j;e[0]+=" "+v+" ";e[1]+=a[0]+";";e[2]+=a[1]+";"}}if(p.length!=q.length){JxHint.alert(jx.query.brackets);return null}if(e[0].length>0){var s=e[0].length-v.length-1;if(v.charAt(0)==")"){s+=2}e[0]="("+e[0].substr(0,s)+")"}if(e[1].length>0){e[1]=e[1].substr(0,e[1].length-1)}if(e[2].length>0){e[2]=e[2].substr(0,e[2].length-1)}return e},getWhere:function(a,c,e,g){var d=new Array("","","");if(Ext.isEmpty(e)){return d}if(e=="~null~"){if(c=="<>"){d[0]=a+" is not null"}else{d[0]=a+" is null"}return d}e=Ext.isDate(e)?e.dateFormat("Y-m-d"):e;var b=this.getQueryValue(e,c,g);if(c=="="&&g=="date"){d[0]+="("+a+" >= ? and "+a+" < ? )";var f=JxUtil.getNextDate(b[0],1);d[1]+=b[0]+";"+f;d[2]+=g+";"+g}else{d[0]+=a+this.getCondType(c)+"?";d[1]+=b[0];d[2]+=b[1]}return d},getCondType:function(b){var a="like";if(b==""){return a}switch(b){case"=":a=" = ";break;case">":a=" > ";break;case"<":a=" < ";break;case">=":a=" >= ";break;case"<=":a=" <= ";break;case"<>":a=" <> ";break;case"llike":a=" like ";break;case"rlike":a=" like ";break;case"nlike":a=" not like ";break;case"like":a=" like ";break}return a},getQueryValue:function(c,b,d){var a=new Array();switch(d){case"string":if(b=="llike"){a[0]=c+"%"}else{if(b=="rlike"){a[0]="%"+c}else{if(b=="like"||b=="nlike"){a[0]="%"+c+"%"}else{a[0]=c}}}a[1]="string";break;case"int":a[0]=c;a[1]="int";break;case"date":if(c.indexOf(" ")<0&&(b=="<=")){c+=" 23:59:59"}a[0]=c;a[1]="date";break;case"float":a[0]=c;a[1]="double";break;default:a[0]=c;a[1]=d;break}return a},setCondDefault:function(g,h,a){var c=g.getValue();var e=g.store;var f=e.reader.recordType;e.removeAll();var b=ComboData.condtype;if(h=="string"){if(a=="combo"){e.insert(0,new f({value:b[0][0],text:b[0][1]}));g.setValue("=")}else{e.insert(0,new f({value:b[0][0],text:b[0][1]}));e.insert(1,new f({value:b[1][0],text:b[1][1]}));e.insert(2,new f({value:b[6][0],text:b[6][1]}));e.insert(3,new f({value:b[7][0],text:b[7][1]}));e.insert(4,new f({value:b[8][0],text:b[8][1]}));var d=b[0][0]+","+b[1][0]+","+b[6][0]+","+b[7][0]+","+b[8][0]+",";if(c.length>0&&d.indexOf(c+",")>=0){g.setValue(c)}else{g.setValue("like")}}}else{e.insert(0,new f({value:b[0][0],text:b[0][1]}));e.insert(1,new f({value:b[1][0],text:b[1][1]}));e.insert(2,new f({value:b[2][0],text:b[2][1]}));e.insert(3,new f({value:b[3][0],text:b[3][1]}));e.insert(4,new f({value:b[4][0],text:b[4][1]}));e.insert(5,new f({value:b[5][0],text:b[5][1]}));var d=b[0][0]+","+b[1][0]+","+b[2][0]+","+b[3][0]+","+b[4][0]+","+b[5][0]+",";if(c.length>0&&d.indexOf(c+",")>=0){g.setValue(c)}else{g.setValue("=")}}}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxQuery={};(function(){Ext.apply(JxQuery,{initQrys:[["0","--"+jx.query.casex+"--"],["1","--"+jx.query.custom]],showCase:function(c){if(Jxstar.systemVar.page__query__two=="1"){JxQuery.renderToolQry(c);return}var b=this,d=c.page;var g=d.getBottomToolbar();if(!g){g=d.getTopToolbar()}if(!g){return}g.add("-");var a=b.initQrys;var e=JxUtil.newId()+"_qry";var f=Jxstar.createCombo(e,a,130);g.add(f);f.on("beforeselect",function(j,h){var n=h.get("value");var m=j.getValue();if(n!=m&&n=="0"){b.renderToolQry(c)}else{if(n!=m&&n=="1"){b.openToolQry(c,j)}else{if(n!=m){var i=function(o){b.renderToolQry(c,o.qrycond)};var l="funid=sys_query&queryid="+n+"&pagetype=grid&eventcode=selcase";Request.dataRequest(l,i)}}}});b.loadQryCase(c,f)},openToolQry:function(a,c){var b=this.queryWindow(a);b.on("destroy",function(){JxQuery.loadQryCase(a,c)})},loadQryCase:function(b,c){var a=function(g){var f=g.qrycase,h=JxQuery.initQrys;var e=[h[0],h[1]];Ext.each(f,function(i){e[e.length]=[i.value,i.text]});c.getStore().loadData(e);if(g.qryid.length>0){if(f.length>0){c.setValue(g.qryid)}JxQuery.renderToolQry(b,g.qrycond)}else{c.setValue("0");JxQuery.renderToolQry(b)}};var d="funid=sys_query&qryfunid="+b.nodeId+"&pagetype=grid&eventcode=reloadcase";Request.dataRequest(d,a)},renderToolQry:function(a,c){var b=a.page;var d=function(){if(Ext.isEmpty(b.qryCt)){JxHint.alert(jx.query.nov);return}b.qryCt.removeAll(true);var f=[],e=1;if(c){if(c.length>0){f=JxQuery.showQryTool(a,c);e=f.length}}else{f=JxQuery.hcfg();Jxstar.addBaseQry(a,f);if(Jxstar.systemVar.page__query__two=="1"){f.add({xtype:"button",iconCls:"eb_qryh",tooltip:jx.star.hqry,handler:function(){Jxstar.showQuery(a)}})}else{if(a.define.isarch=="1"){f.add(JxQuery.archCfg)}}}b.qryCt.add(f);b.qryCt.setHeight(38*e+10);b.qryCt.doLayout();b.setHeight(b.ownerCt.getHeight());b.ownerCt.doLayout()};if(b.bwrap==null){b.on("render",d)}else{d()}},hcfg:function(a){var b={name:JxUtil.newId()+"_qv",xtype:"container",layout:"hbox",border:false,height:38,layoutConfig:{padding:"1",align:"middle"},defaults:{margins:"0 0 0 5"},items:a||[]};if(a){return b}else{b.style="padding-top:3px";return new Ext.Container(b)}},archCfg:{xtype:"checkbox",boxLabel:jx.query.hasarc,style:"margin-left:5px;",width:100,name:"xx_isarch",checked:false},showQryTool:function(o,l){if(l==null||l.length==0){return[]}var t=0,h=[];for(var f=0,c=l.length;f<c;f++){var p=l[f].row_no;if(Ext.isEmpty(p)){p="1"}if(t==parseInt(p)){var v=h[t-1];v[v.length]=l[f]}else{t=parseInt(p);h[t-1]=[l[f]]}}var g=[];var u=this,a=o.page;var q=o.param.cols;for(var f=0,c=h.length;f<c;f++){var s=h[f];var b=[];for(var e=0,d=s.length;e<d;e++){var r=s[e];r.colcode=r.colcode.replace(".","__");b=u.addQryField(r,q,b)}if(f==c-1){b[b.length]={xtype:"button",iconCls:"eb_qry",tooltip:jx.star.qry,handler:u.exeQry,data:a};if(o.define.isarch=="1"){b[b.length]=u.archCfg}}g[g.length]=u.hcfg(b)}return g},addQryField:function(e,d,f){var h=this;var b,a,g;for(var o=0,u=0,l=d.length;o<l;o++){var w=d[o].col,v=d[o].field;if(w==null||v==null){continue}if(v.name==e.colcode){g=v.type;if(!w.hasOwnProperty("editor")){if(g=="string"){a={xtype:"textfield"}}else{if(g=="date"){var q=JxUtil.getDateFormat(w.renderer);a={xtype:"datefield",format:q}}else{a={xtype:"numberfield",maxLength:12}}}}else{var j=w.editor;var r=false;if(j.isXType("combo")&&j.mode=="local"){r=true}var s=Ext.apply({},j.initialConfig);a=Ext.apply(s,{allowBlank:true,editable:!r,cls:"",xtype:j.getXType()});if(r){a.iscombo=r;a.value="";a.listeners=Ext.apply(a.listeners||{},{specialkey:function(c,i){if(i.getKey()==i.DELETE||i.getKey()==i.BACKSPACE){c.setValue("")}if(i.getKey()==i.ENTER){h.exeQry(c)}}});JxUtil.insertEmpty(a)}}var m=e.colname;if(Ext.isEmpty(m)||JxLang.type!=JxLang.BASE){m=w.header}m+=": ";var t=Jxstar.systemVar.sys__qry__date||"0";if(t=="0"&&g=="date"){e.colname=m;h.dateCfgs(f,e)}else{var p=f.length;f[p]={xtype:"label",text:m,cls:"x-query-label"};a.data=e;a.width=130;a.name=e.colcode;if(!a.iscombo){a.listeners=Ext.apply(a.listeners||{},{specialkey:function(c,i){if(i.getKey()==i.ENTER){h.exeQry(c)}}})}f[p+1]=a}break}}return f},exeQry:function(c){var f=c.ownerCt;var a=f.ownerCt;if(c.isXType("field")){c=a.findByType("button")[0]}var i=a.find("name","xx_isarch")[0];var e="0";if(i&&i.getValue()=="1"){e="1"}var h=c.initialConfig.data;var d=JxQuery.getQryField(a);var g=JxSearch.getQuery(d);Jxstar.myQuery(h,g,e)},getQryField:function(a){var b=new Ext.util.MixedCollection();a.items.each(function(c){c.items.each(function(g){if(g.isXType("field")&&g.getName()!="xx_isarch"){var e=g.getValue();var h=g.data;if(h&&Ext.isEmpty(e)==false){h.cond_value=e;b.add(h)}}})});return b},dateCfgs:function(m,j){var n=this;var p=m.length;var i=j.colcode;m[p++]={xtype:"tbtext",text:j.colname};var g=JxUtil.getToday();g=Date.parseDate(g,"Y-m-d");var b=JxUtil.getToday(-1);b=Date.parseDate(b,"Y-m-d");var h=JxUtil.getWeekDates();var r=Date.parseDate(h[0],"Y-m-d");var q=Date.parseDate(h[1],"Y-m-d");var u=JxUtil.getMonthDates();var e=Date.parseDate(u[0],"Y-m-d");var d=Date.parseDate(u[1],"Y-m-d");var t=Ext.applyIf({condtype:">="},j);if(t.right_brack.length>0){t.right_brack=""}var f=Ext.applyIf({condtype:"<"},j);if(t.left_brack.length>0){f.left_brack=""}var l={specialkey:function(v,w){if(w.getKey()==w.ENTER){n.exeQry(v)}}};var a=new Ext.form.DateField({xtype:"datefield",width:130,name:i,format:"Y-m-d",value:g,data:t,listeners:l});var c=new Ext.form.DateField({xtype:"datefield",width:130,name:i,format:"Y-m-d",value:g.add(Date.DAY,1),data:f,listeners:l});var s=function(v){if(v.checked){var w=v.inputValue;if(w=="today"){a.setValue(g);c.setValue(g.add(Date.DAY,1))}else{if(w=="yestoday"){a.setValue(b);c.setValue(b.add(Date.DAY,1))}else{if(w=="toweek"){a.setValue(r);c.setValue(q)}else{if(w=="tomonth"){a.setValue(e);c.setValue(d)}}}}}};var o=[{xtype:"radio",boxLabel:jx.query.today,name:"dateRange",inputValue:"today",checked:true,listeners:{check:s}},{xtype:"radio",boxLabel:jx.query.yestoday,name:"dateRange",inputValue:"yestoday",listeners:{check:s}},{xtype:"radio",boxLabel:jx.query.tweek,name:"dateRange",inputValue:"toweek",listeners:{check:s}},{xtype:"radio",boxLabel:jx.query.tmonth,name:"dateRange",inputValue:"tomonth",listeners:{check:s}}];m[p++]=o[0];m[p++]=o[1];m[p++]=o[2];m[p++]=o[3];m[p++]=a;m[p++]={xtype:"tbtext",text:"~"};m[p++]=c},queryWindow:function(b){var a=this;a.funid=b.nodeId;var d=new Ext.Window({title:jx.query.casec,layout:"border",width:800,height:450,constrainHeader:true,resizable:false,modal:true,closeAction:"close",items:[{xtype:"container",region:"west",layout:"fit",width:250,split:true,margins:"2 0 2 2"},{xtype:"container",region:"center",layout:"fit",margins:"2 2 2 0"}]});Jxstar.createPage("sys_query","gridpage",d.getComponent(0));var c={pageType:"subeditgrid",parentNodeId:"sys_query"};Jxstar.createPage("sys_qrydet","gridpage",d.getComponent(1),c);JxUtil.delay(1000,function(){var f=d.getComponent(0).getComponent(0);var g=d.getComponent(1).getComponent(0);f.on("rowclick",function(j,m,l){var h=j.getStore().getAt(m);if(h==null){return false}var i=h.get("sys_query__query_id");Jxstar.loadSubData(g,i)});f.getStore().on("load",function(h){if(f.selectKeyId==null||f.selectKeyId.length==0){f.getSelectionModel().selectFirstRow();f.fireEvent("rowclick",f,0)}});var e={where_sql:"fun_id = ? and (is_share = '1' or user_id = ?)",where_value:a.funid+";"+JxDefault.getUserId(),where_type:"string;string"};Jxstar.loadData(f,e);f.qryFunId=a.funid;g.qryFunId=a.funid});d.show();return d}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxSender={};Ext.apply(JxSender,{grid:null,portlet:null,send:function(c){var a=this;if(c){if(c.isXType&&c.isXType("grid")){a.grid=c}else{a.portlet=c}}var b=a.createId();a.createPage("sys_msg",b)},edit:function(c,a){var b=this;b.grid=a;b.createPage("sys_msg",c)},createId:function(){var a=Math.round(Math.random()*100);return"jx"+a+((new Date()).getTime()-(new Date(2013,0,1)).getTime())},createPage:function(f,j){var i=this;var c=new Ext.form.FormPanel({layout:"fit",region:"center",border:false,items:[{xtype:"imghtmleditor",name:"oa_news__news_cont",allowBlank:false,anchor:"100%",maxLength:20000},{xtype:"hidden",name:"oa_news__news_id",value:j}]});var d=Jxstar.findNode("sys_msg");c.formNode={define:d};var g=new Ext.Panel({border:false,layout:"border",items:[{pagetype:"subgrid",region:"west",layout:"fit",width:160,split:true,border:false},c]});var b={pageType:"subgrid",parentNodeId:f};var h=d.subfunid;var a=g.getComponent(0);Jxstar.createPage(h,"gridpage",a,b);JxUtil.delay(1000,function(){var l=a.getComponent(0);Jxstar.loadSubData(l,j)});var e=new Ext.Window({title:jx.plet.text1,layout:"fit",width:750,height:450,modal:true,border:false,closeAction:"close",items:[g],buttons:[{text:jx.plet.text2,handler:function(){var l=a.getComponent(0);var o=l.getStore().getCount();if(o==0){JxHint.alert(jx.util.sendnm);return}var n=c.getForm().get("oa_news__news_cont");n=encodeURIComponent(n);if(n.length==0){JxHint.alert(jx.util.sendnms);return}var p="funid="+f+"&keyid="+j+"&pagetype=form&eventcode=send&news_cont="+n;var m=function(q){e.success=true;e.close();if(i.grid){i.grid.getStore().reload()}if(i.portlet){i.portlet.refresh()}};Request.postRequest(p,m)}},{text:jx.plet.text3,handler:function(){var m=c.getForm().get("oa_news__news_cont");m=encodeURIComponent(m);if(m.length==0){JxHint.alert(jx.util.sendnss);return}var n="funid="+f+"&keyid="+j+"&pagetype=form&eventcode=fsave&news_cont="+m;var l=function(o){e.success=true;e.close();if(i.grid){i.grid.getStore().reload()}if(i.portlet){i.portlet.refresh()}};Request.postRequest(n,l)}},{text:jx.plet.text4,handler:function(){e.close()}}]});e.show();e.on("close",function(){if(!e.success){i.deltmp(f,j)}});return e},htmlToText:function(a){if(!a){return""}a=a.replace(/<(\/\s*)?((\w+:)?\w+)(\w+(\s*=\s*((["'])(\\["'tbnr]|[^\7])*?\7|\w+)|.{0})|\s)*?(\/\s*)?>/ig,"");a=a.replace(/？/g,"");return a},deltmp:function(a,b){var c="funid="+a+"&keyid="+b;c+="&pagetype=form&eventcode=deltmp";Request.postRequest(c)},readBoard:function(a,f){var b=this;if(f){if(f.isXType&&f.isXType("grid")){b.grid=f}else{if(f.tagName.toLowerCase()=="p"){f.querySelector(".new-badge").classList.add("hide-badge")}else{b.portlet=f}}}var c=function(m){var p=JxDefault.getUserId();var g=m.cont.edit_userid;var q=b.contHtml(m.cont);var l=m.reply;if(l.length>0){q+='<div class="x-reply-body"><div class="title">'+jx.cloud.text19+"</div>"}for(var o=0,h=l.length;o<h;o++){q+=b.replyHtml(o+1,l[o],g)}if(l.length>0){q+="</div>"}var s=new Ext.Container({html:q,autoScroll:true});var j=Jxstar.sysMainTab;var r=j.add({label:jx.plet.text8,border:false,layout:"fit",closable:true,iconCls:"function",items:[s]});j.activate(r);new Ext.form.TextArea({renderTo:s.el.query(".x-news-reply .content")[0],id:"oa_reply__reply_cont",maxLength:500,height:100,width:"100%"});new Ext.Button({renderTo:s.el.query(".x-news-reply .button")[0],cls:"x-btn-primary",iconCls:"eb_reply",text:jx.plet.text5,handler:function(){b.saveReply(a,r)}});b.addDelete(s)};var d=function(g){if(Ext.isEmpty(g)){JxHint.alert(jx.plet.notboard)}else{c(g)}};var e="funid=oa_reply&eventcode=fqury&pagetype=form&isReply=0&newsId="+a;Request.dataRequest(e,d)},contHtml:function(a){var b=new Ext.Template('<div flag="0" itemid="{news_id}" class="x-news-body">','<div class="title">{news_title}</div>','<div class="subtitle">',"<span>"+jx.plet.text9+"{edit_user}&nbsp;&nbsp;{edit_date}</span>","</div>",'<div class="x-news-content">{news_cont}</div>','<div class="x-news-reply">','<div class="retitle">'+jx.cloud.text20+"</div>",'<div class="content"></div>','<div class="button"></div>',"</div>","</div>");return b.apply(a)},replyHtml:function(e,d,a){var g="";var c=JxDefault.getUserId();var b=d.edit_userid;if(a==c||c==b){g='&nbsp;&nbsp;<a class="delete" itemid="{reply_id}" parentid="{data_id}">'+jx.plet.text15+"</a>"}var f=new Ext.Template('<div flag="1" itemid="{reply_id}">','<div class="subtitle">','<span><a class="x-ashow">{edit_user}</a>&nbsp;&nbsp;{edit_date}'+g+"</span>","</div>",'<div class="content">{reply_cont}</div>',"</div>");d.index=e;return f.apply(d)},saveReply:function(a,h){var g=this;var d=g.createId();var j=Ext.getCmp("oa_reply__reply_cont");var f=encodeURIComponent(j.getValue());var c="funid=oa_reply&keyid="+d+"&pagetype=form&reply_cont="+f;var e=h._tablename;if(!Ext.isEmpty(e)){var b=h._dataid;c+="&eventcode=bsave&tablename="+e+"&dataid="+b}else{c+="&eventcode=fsave&news_id="+a}var i=function(l){j.setValue("");g.refreshCont(a,h)};Request.postRequest(c,i)},viewCont:function(c,j){var h=this;if(Ext.isEmpty(c)){JxHint.alert(jx.plet.notboard)}else{var b=c.reply;var g=j.getComponent(0);var f=g.el.first(".x-reply-body");if(f){if(b.length==0){f.remove();f.removeAllListeners();return}else{f.removeAllListeners();f.select("div").remove()}}else{if(b.length==0){return}f=g.el.insertHtml("beforeEnd",'<div class="x-reply-body"><div class="title">'+jx.cloud.text19+"</div></div>",true)}var e='<div class="title">'+jx.cloud.text19+"</div>";for(var d=0,a=b.length;d<a;d++){e+=h.replyHtml(d+1,b[d],c.cont.edit_userid)}f.update(e);h.addDelete(g)}},refreshCont:function(b,d){var e=this;var f="funid=oa_reply&pagetype=form";var c=d._tablename;if(!Ext.isEmpty(c)){var a=d._dataid;f+="&eventcode=bquery&tablename="+c+"&dataid="+a}else{f+="&eventcode=fqury&isReply=1&newsId="+b}Request.dataRequest(f,function(g){e.viewCont(g,d)})},notshow:function(b,a){var c=this;var d=function(f){Jxstar.funMainTab.closeTab(a.id,Jxstar.funMainTab);if(c.portlet){c.portlet.refresh()}};var e="funid=sys_msg&eventcode=notshow&pagetype=grid&newsId="+b;Request.dataRequest(e,d)},addDelete:function(b){var a=this;var d=function(e,f){var h="funid=oa_reply&replyId="+e+"&pagetype=form&eventcode=fdelete";var g=function(i){a.refreshCont(f,b.ownerCt)};Request.postRequest(h,g)};var c=b.el.select("a.delete");c.on("click",function(j,f){var g=Ext.get(f);var h=g.getAttribute("itemid");var i=g.getAttribute("parentid");d(h,i)})},queryMsg:function(){var a=Jxstar.session.user_id;var f="(edit_userid = ? or exists (select * from oa_news_obj where oa_news_obj.news_id = oa_news.news_id and oa_news.state = ? and obj_type = ? and obj_id = ?))";var b="string;string;string;string";var d=a+";1;1;"+a;var c="sys_msg";var g=Jxstar.findNode(c);Jxstar.rightNodes.push(c);var e={whereSql:f,whereType:b,whereValue:d};Jxstar.createNode(c,e)},queryBoard:function(a){var d=Jxstar.session.user_id;var i=(Jxstar.systemVar.dbType=="sqlserver")?"dbo.":"";var j=i+"f_isnews(news_id, ?) = ? and oa_news.state = ?";var b="string;string;string";var f=d+";1;1";if(a&&a.length>0){var h="'"+a.replace(",","','")+"'";j+=" and cont_type in ("+h+")"}var g="oa_news";var e=Jxstar.findNode(g);Jxstar.rightNodes.push(g);var c={whereSql:j,whereType:b,whereValue:f};Jxstar.createNode(g,c)},_newsId:"",_emptyHtml:'<div style="height:40px;padding:8px;"><div style="background-color:#d0dfd0;padding:5px;font-size:13px;">'+jx.plet.text13+"</div></div>",addMsgReply:function(b){var c=b.param;var e=Jxstar.findNode(c.funid);var a=c.items;var d={title:jx.plet.text14,baseCls:"xs-panel",data:"msg_reply",cls:"sub_panel sub_msg",border:false,layout:"fit",collapsible:true,autoScroll:false,autoHeight:true,collapsed:false,anchor:"100%",height:230};Ext.apply(d,c.subConfig);a[a.length]=d},showMsgReply:function(a){var l=this;var j=a.page;var g=a.define;var e=a.event;var m=j.find("cls","sub_panel sub_msg");if(Ext.isEmpty(m)){return}var i=m[0];var d=[{iconCls:"eb_reply",text:jx.plet.text5,handler:function(){l.replyBoard(l._newsId,i)}}];var c=new Ext.Toolbar({deferHeight:true,items:d});var j=new Ext.Panel({bbar:c,html:l._emptyHtml,autoScroll:false,autoHeight:true,border:false});i.add(j);JxUtil.delay(2000,function(){if(i.header){i.header.setStyle("cursor","pointer");i.header.on("click",function(){if(this.collapsed){this.expand(true)}else{this.collapse(true)}},i)}});var b=e.form;var h=g.pkcol;var f=g.tablename;e.on("initother",function(o){var n=b.get(h);i._dataid=n;i._tablename=f;var p="funid=oa_reply&eventcode=bquery&pagetype=form&tablename="+f+"&dataid="+n;Request.dataRequest(p,function(q){l._newsId=q.newsid;if(l._newsId.length==0){l._newsId=l.createId()}l.viewCont(q,i)})})}});JxMainTab=function(a){this.tabct=null;this.tabwidth=115;this.funct=null;this.homeid="";this.currtab=null;this.addEvents("beforeactive","afteractive","beforeclose","afterclose");Ext.apply(this,a);JxMainTab.superclass.constructor.call(this,a)};(function(){Ext.extend(JxMainTab,Ext.util.Observable,{initHome:function(){var c=this;var d=c.homeid;var b=c.getTab(d);c.flagTab(b);c.currtab.on("click",function(){c.activeTab(d)});var a=c.tabct.next("span");a.on("mousedown",function(){c.showTabMenu(a)})},showHome:function(){this.activeTab(this.homeid)},activeTab:function(d,c){var b=this;if(b.fireEvent("beforeactive",b,d,c)==false){return}var a=b.getTab(d);if(a){b.flagTab(a)}else{a=b.createTab(d,c);b.flagTab(a)}b.fireEvent("afteractive",b,d,c)},onCloseTab:function(b,h){var a=false;var e=h.funct.getComponent(b);if(Ext.isEmpty(e)){h.closeTab(b,h);return}var f=e.findByType("form");if(f&&f.length>0){for(var d=0;d<f.length;d++){if(f[d].formNode&&f[d].getForm().isDirty()){a=true;break}}}if(!a){var c=e.findByType("grid");if(c&&c.length>0){for(var d=0;d<c.length;d++){var j=c[d].getStore();if(c[d].gridNode&&j){var g=j.getModifiedRecords();if(g&&g.length>0){a=true;break}}}}}if(a){Ext.Msg.confirm(jx.base.hint,jx.cloud.text37,function(i){if(i=="yes"){h.closeTab(b,h)}})}else{h.closeTab(b,h)}},closeTab:function(g,d){var c=d.getTab(g);if(!c){return}if(d.fireEvent("beforeactive",d,g)==false){return}var b=c.next("li");if(!b){b=c.prev("li")}c.remove();d.funct.remove(g,true);if(b){d.flagTab(b)}var a=d.tabct.select("li{display=none}:first",true).elements;if(a.length>0){var f=a[0].getAttribute("title");var e=a[0].getAttribute("itemid");a[0].remove();d.createTab(e,f)}d.fireEvent("afteractive",d,g)},createTab:function(a,i){var e=this;var h="fa-funicon",c=Jxstar.findNode(a.substring(4));if(c&&c.iconcls){h=c.iconcls}var d='<li class="top-fun-text x-unselectable" title="'+i+'" itemid="'+a+'"><div unselectable="on"><span><i class="fa '+h+'"></i>'+i+'</span><span class="top-fun-img"><i class="fa eb_remco bigger-110"></i></span></div></li>';var b=e.tabct.insertHtml("beforeEnd",d,true);b.setVisibilityMode(Ext.Element.DISPLAY);b.on("click",function(l,j){e.activeTab(a)});var f=b.child("span[class^=top]");f.on("click",function(l,j){e.onCloseTab(a,e);l.stopEvent()});var g=e.tabct.up("div[class=top_sysbtn]");if(e.tabct.getWidth()>g.getWidth()-25){e.hideTab()}return b},getTab:function(a){return this.tabct.child("li[itemid="+a+"]")},flagTab:function(a){var b=this;if(b.currtab){b.currtab.removeClass("top-fun-curr")}a.addClass("top-fun-curr");var c=a.getAttribute("itemid");b.funct.getLayout().setActiveItem(c);b.currtab=a},getTabNum:function(){return this.tabct.select("li{display!=none}").getCount()-1},hideTab:function(){this.tabct.select("li{display!=none}:nth(2)").hide()},showTab:function(d){var b=this;var a=b.getTab(d);var c=a.getAttribute("title");a.remove();b.activeTab(d,c)},showTabMenu:function(b){var d=Ext.get("main_fun_menu");if(d){d.hide();return}var g=this;var f=[];f[0]={text:jx.bus.text56,handler:function(){var m=g.funct.items;for(var n=m.length-1;n>0;n--){var l=m.get(n);g.funct.remove(l,true);var o=g.getTab(l.id);if(o){o.remove()}}g.showHome()}};f[1]={text:jx.bus.text57,handler:function(){var p=g.funct.getLayout().activeItem;var m=g.funct.items;for(var n=m.length-1;n>0;n--){var l=m.get(n);if(l.id==p.id){continue}g.funct.remove(l,true);var o=g.getTab(l.id);if(o){o.remove()}}}};var h=g.tabct.select("li{display=none}",true).elements;for(var e=0;e<h.length;e++){if(e==0){f[2]="-"}var c=h[e];var a=c.getAttribute("itemid");var j=c.getAttribute("title");f[e+2]={text:j,itemId:a,handler:function(i){var l=i.getItemId();g.showTab(l)}}}d=new Ext.menu.Menu({id:"main_fun_menu",items:f});d.showAt([b.getX(),b.getY()+20]);d.on("hide",function(i){i.destroy()})}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt={};(function(){Ext.apply(JxPortalExt,{IS_TEMPLET:true,funId:"plet_templet",XINC:10,YINC:10,contentTypes:{},getTools:function(){var a=this;var b=[{id:"refresh",handler:function(h,d,c){var g=c.initialConfig.typecode;var f=a.contentTypes[g];if(f==null){JxHint.alert(String.format(jx.port.noport,g));return false}f.refresh(c)}},{id:"close",handler:function(f,d,c){c.ownerCt.remove(c,true)}}];return b},showOnePortal:function(d,a){var b=this;var c=function(m){d.runstate="1";d.settype="1";d.templetid=m.templet_id;var g=b.createPortal(m.items,"1");d.add(g);d.doLayout();var i=g.items.length;for(var h=0;h<i;h++){var f=g.items.get(h);var n=f.initialConfig.typecode;var l=b.contentTypes[n];if(l==null){continue}l.showPortlet(f)}};var e="funid="+b.funId+"&pagetype=editgrid&eventcode=readone&templetid="+a;Request.dataRequest(e,c)},createPortals:function(c){var a=this;Ext.TaskMgr.stopAll();var b=function(m){if(Ext.isEmpty(m)){JxHint.alert(jx.util.pletnsp);return}a.parsePortal(m,c);var f=c.portals.length;for(var h=0;h<f;h++){var o=c.portals[h];var e=o.items.length;for(var g=0;g<e;g++){var p=o.items.get(g);var l=p.initialConfig.typecode;var n=a.contentTypes[l];if(n==null){continue}n.showPortlet(p)}}};var d="funid="+a.funId+"&pagetype=editgrid&eventcode=readtemp";Request.dataRequest(d,b)},parsePortal:function(j,f){var g=this;var b=parseInt(j.portalnum);if(!f.portals){f.portals=[]}if(b>1){var e=[b];for(var d=0;d<b;d++){var c=j.portals[d];var h=g.createPortal(c.items,"1");e[d]={runstate:"1",settype:"1",templetid:c.templet_id,title:c.templet_name,autoScroll:true,layout:"fit",iconCls:"function",items:h};f.portals[d]=h}var a=new Ext.TabPanel({id:"sys_portal_tab",region:"center",closeAction:"close",activeTab:0,deferredRender:false,items:e});a.on("tabchange",function(l,i){g.addMenu(i)});f.add(a);f.doLayout()}else{var c=j.portals[0];f.runstate="1";f.settype="1";f.templetid=c.templet_id;var h=g.createPortal(c.items,"1");f.portals[0]=h;f.add(h);f.doLayout()}},newCell:function(d,a){var c=this;var b=c.getTools();var e=JxLang.otherText("portaltitle","plet__"+d.id,d.title);return{x:parseInt(d.x||c.XINC),y:parseInt(d.y||c.YINC),width:parseInt(d.width||250),height:parseInt(d.height||180),frame:false,border:false,collapsible:false,baseCls:"xpt-panel",cls:"x-portlet shadow",title:e,iconCls:d.iconCls,layout:"fit",autoScroll:true,tools:(a=="1")?[b[0]]:[b[1]],collapsed:(d.collapse=="1"),pletid:d.id,typecode:d.typecode,objectid:d.objectid}},createPortal:function(d,c){var e=this;var b=[];var f=0;Ext.each(d,function(g){b[b.length]=e.newCell(g,c);if(c=="0"&&!g.x){b[f].x=parseInt(b[f].x)+20*f;b[f].y=parseInt(b[f].y)+30*f;f++}});var a=new Ext.Panel({layout:"absolute",autoScroll:true,border:false,cls:"x-portal-bg",items:b});JxUtil.delay(100,function(){var g=a.ownerCt;if(e.IS_TEMPLET||c=="0"){e.addMenu(g)}if(c!="1"){a.items.each(function(h){e.draggable(h)})}});return a},addMenu:function(e){if(e.hasMenu||!e.el){return}var d=this;var c=e.settype||"1";var a=e.runstate;var b=[];if(c=="1"){if(a=="1"){if(d.IS_TEMPLET){b[0]={text:jx.cloud.text21,handler:function(){d.readTemp("custtemp",e.templetid,"1")}}}}else{b[0]={text:jx.cloud.text22,handler:function(){d.saveTemp(e)}};b[1]={text:jx.cloud.text23,handler:function(){d.defTemp(e)}};b[2]={text:jx.cloud.text24,handler:function(){d.addTemp(e)}};b[3]={text:jx.cloud.text25,handler:function(){d.updateTemp(e)}}}}else{b[0]={text:jx.cloud.text22,handler:function(){d.saveTemp(e)}};b[1]={text:jx.cloud.text24,handler:function(){d.addTemp(e)}};b[2]={text:jx.cloud.text25,handler:function(){d.updateTemp(e)}}}e.el.on("contextmenu",function(g,f,i){var h=new Ext.menu.Menu({items:b});h.showAt(g.getXY())});e.hasMenu=true},addTemp:function(e){var b=this;var a=e.items.get(0);var d=function(g){var h={};g.items.each(function(i){h[i.pletid]="1"});return h};var c=function(j){if(Ext.isEmpty(j)){return}var h=[];var i=d(a),g={};var l=0;Ext.each(j,function(m){if(!i[m.id]){h[h.length]=b.newCell(m,"0");g[m.id]="1";if(!m.x){h[l].x=parseInt(h[l].x)+20*l;h[l].y=parseInt(h[l].y)+30*l;l++}}});a.add(h);a.doLayout();a.items.each(function(m){var n=m.initialConfig.pletid;if(g[n]){b.draggable(m)}})};var f="funid="+b.funId+"&pagetype=editgrid&eventcode=addtemp&templetid="+e.templetid;Request.postRequest(f,c)},saveTemp:function(h){var l=this;var n=h.items.get(0);var j=n.items;var a=j.getCount();var b=[a];if(a==0){return}var d=n.getPosition(true);for(var f=0;f<a;f++){var q=j.get(f);var m=q.getPosition(true);b[f]={x:m[0]-d[0],y:m[1]-d[1],width:q.getWidth(),height:q.getHeight(),title:q.title,iconCls:q.iconCls,collapse:(q.collapsed?"1":"0"),id:q.pletid,typecode:q.typecode,objectid:q.objectid}}var p=Ext.encode(b);var g=encodeURIComponent;var o=h.settype||"1";var c="funid="+l.funId+"&pagetype=editgrid&eventcode=savetemp";c+="&templetid="+h.templetid+"&settype="+o+"&config="+g(p);Request.postRequest(c)},defTemp:function(c){var a=this;var b=function(f){if(Ext.isEmpty(f)){return}c.removeAll(true);var e=a.createPortal(f,"0");c.add(e);c.doLayout()};var d="funid="+a.funId+"&pagetype=editgrid&eventcode=deftemp&templetid="+c.templetid;Request.postRequest(d,b)},updateTemp:function(c){var a=this;var b=function(l){if(Ext.isEmpty(l)){return}c.removeAll(true);var m=l.newconfig;var h=l.oldconfig;for(var g=0;g<h.length;g++){for(var f=0;f<m.length;f++){if(h[g].id==m[f].id){delete m[f].height;h[g]=Ext.apply(h[g],m[f]);break}}}var e=a.createPortal(h,"0");c.add(e);c.doLayout()};var d="funid="+a.funId+"&pagetype=editgrid&eventcode=reinfo&templetid="+c.templetid+"&settype="+c.settype;Request.postRequest(d,b)},readTemp:function(e,c,b){var d=this;var f="funid="+d.funId+"&pagetype=editgrid&eventcode="+e+"&templetid="+c;var a=function(h){if(h.length==0){JxHint.alert(jx.util.pletndd);return}var l=(b=="0")?jx.util.pletsdp:jx.util.pletcdp;var j=Jxstar.sysMainTab;var i=j.add({templetid:c,settype:b,label:l,autoScroll:true,layout:"fit",closable:true,iconCls:"function",border:false});j.activate(i);var g=d.createPortal(h,"0");i.add(g);i.doLayout()};Request.postRequest(f,a)},draggable:function(d){var c=this;var b=new Ext.Resizable(d.el,{handles:"all",minWidth:60,minHeight:30,dynamic:true,draggable:true,transparent:true,widthIncrement:c.XINC,heightIncrement:c.YINC});b.on("resize",function(g,e,f){var i=Ext.getCmp(g.getEl().id);i.setWidth(e);i.setHeight(f);i.doLayout()});var a=b.dd;a.setXConstraint(1500,1500,c.XINC);a.setYConstraint(1500,1500,c.YINC);a.endDrag=function(h){var g=Ext.getCmp(a.getDragEl().id);var j=g.getPosition(true);var f=j[0],i=j[1];if((f%c.XINC)==0&&(i%c.YINC)==0){return true}f=Math.floor(f/c.XINC)*c.XINC;i=Math.floor(i/c.YINC)*c.YINC;g.setPosition(f,i)}}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt.contentTypes.portlet_chart={refresh:function(a){this.showPortlet(a)},showPortlet:function(b){JxUtil.loadCharts();var a=this;if(b.body){a.renderPortlet(b)}else{b.on("afterrender",function(){a.renderPortlet(b)})}},renderPortlet:function(target){var self=this;target.removeAll(target.getComponent(0),true);var chartId=target.initialConfig.objectid;var hdCall=function(chartJson){var ct=target.body.dom;var chart=echarts.init(ct);var co=chartJson.chart_option||"";var option={};try{var fx=co.indexOf("function");if(-1<fx&&fx<5){var s="(function(){var fn = "+co+" return fn;})()";var fn=window.eval(s);var datas={};if(chartJson.chart_data){datas=Ext.decode(chartJson.chart_data)}option=fn(datas,chart)}else{if(chartJson.chart_data){window.CHART_DATAS=Ext.decode(chartJson.chart_data)}if(co&&co.length>0){option=Ext.decode(co)}window.CHART_DATAS=null}}catch(e){alert("error json : "+co);return}window.CHART_DATAS=null;chart.setOption(option);if(JxExt.getIE()<9){Ext.fly(ct).child("div").setHeight(Ext.fly(ct).getHeight()-4)}target.doLayout()};var params="funid=plet_chart&eventcode=qrychart&chart_id="+chartId;Request.dataRequest(params,hdCall)}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt.contentTypes.portlet_fun={refresh:function(a){this.showPortlet(a)},setFun:function(){var d="plet_fun.owner_user_id = ?";var a="string";var b=Jxstar.session.user_id;var c=function(f){JxUtil.delay(500,function(){if(!f.isXType("grid")){f=f.getComponent(1).getComponent(0)}f.fkFunId="sys_user";f.fkValue=b;Jxstar.loadData(f,{where_sql:d,where_value:b,where_type:a})})};var e=Jxstar.findNode("plet_fun");Jxstar.showData({filename:e.gridpage,title:e.nodetitle,pagetype:"editgrid",nodedefine:e,callback:c})},showPortlet:function(b){var a=this;if(b.body){a.renderPortlet(b)}else{b.on("afterrender",function(){a.renderPortlet(b)})}},renderPortlet:function(e){var b=this;var c=e.getTool("gear");if(!c){var c={id:"gear",qtip:jx.bus.text58,handler:function(i,h,g){b.setFun()}};e.addTool(c)}e.removeAll(e.getComponent(0),true);var d=function(q){var g=q.colnum,p=parseFloat(1/g).toFixed(2);var n={xtype:"container",layout:"column",items:[]};for(var m=0;m<g;m++){n.items[m]={columnWidth:p}}var r=new Ext.Container(n);e.add(r);var h=0;for(var m=0;m<q.type.length;m++){var o=q.type[m].type;if(q.type.length<2){o=""}var l=b.createPortlet(m,o,q.data[q.type[m].value]);r.getComponent(h).add({html:l,xtype:"box"});h=(h==(g-1))?0:(h+1)}e.doLayout()};var a=e.initialConfig.pletid;var f="funid=queryevent&eventcode=query_pletfun&portletid="+a;Request.dataRequest(f,d)},createPortlet:function(d,f,h){var j=(d%2==0)?"even":"odd";var a="";if(f&&f.length>0){a='<div class="nav_fun_type '+j+'"><span>'+f+"</span></div>"}var e=new Ext.Template('<div class="nav_fun_body">',a,'<ul class="nav_fun_table">',"{rows}","</ul>","</div>");var g=new Ext.Template('<li class="{cls}" onclick="Jxstar.createNode(\'{funid}\', {isfast:{isfast}});">','<div class="fun-body"><i class="fa {funicon}"></i> {funname}</div>',"</li>");var l=[];var c=h.length;for(var b=0;b<c;b++){if(Jxstar.validNode(h[b].funid)==false){continue}h[b].cls=(b%2==0)?"even":"odd";h[b].isfast=(h[b].isfast=="1");l[b]=g.apply(h[b])}return e.apply({rows:l.join("")})}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt.contentTypes.portlet_news={refresh:function(a){this.showPortlet(a)},showPortlet:function(b){var a=this;if(b.body){a.renderPortlet(b)}else{b.on("afterrender",function(){a.renderPortlet(b)})}},renderPortlet:function(e){e.body.setStyle("overflow-x","hidden");var d=this;if(e==null){JxHint.alert(jx.plet.noparent);return}e.removeAll(e.getComponent(0),true);var c=[{msgtype:"check",color:"green",msgicon:"fa-external-link-square",msgtitle:jx.cloud.text27},{msgtype:"warn",color:"orange",msgicon:"fa-warning",msgtitle:jx.cloud.text28},{msgtype:"board",color:"red",msgicon:"fa-bullhorn",msgtitle:jx.cloud.text29},{msgtype:"notify",color:"blue",msgicon:"fa-bell",msgtitle:jx.base.hint}];var b=d.createPortlet(c);var a=e.add({html:b,xtype:"box"});e.doLayout();a.el.select("div.plet-msg-header").on("click",function(j,h){var f=j.getTarget(".plet-msg-header",3,true);if(f.hasClass("header-0")){return}var g=f.child(".nav-flag i");var i=f.next(".plet-msg-ct");if(i.isDisplayed()){f.removeClass("plet-msg-header-open");i.setStyle("display","none");g.replaceClass("fa-angle-down","fa-angle-right")}else{f.addClass("plet-msg-header-open");i.setStyle("display","");g.replaceClass("fa-angle-right","fa-angle-down")}});a=Ext.get("plet-msg-check");d.queryCheck(a);a=Ext.get("plet-msg-warn");d.queryWarn(a);a=Ext.get("plet-msg-board");d.queryBoard(a,e);a=Ext.get("plet-msg-notify");d.queryNotify(a)},createPortlet:function(a){var c=new Ext.Template('<ul class="plet-msg">',"{rows}","</ul>");var e=new Ext.Template('<li id="plet-msg-{msgtype}">','<div class="plet-msg-header header-0">','<div class="msg-object {color}">','<span class="msg-icon"><i class="fa {msgicon}"></i></span>',"</div>",'<span class="pull-right nav-flag"><i class="fa fa-angle-right bigger-150"></i></span>','<span class="pull-right badge badge-grey">0</span>','<div class="msg-body">',"{msgtitle}","</div>","</div>",'<ul class="plet-msg-ct"></ul>',"</li>");var d=[];for(var b=0;b<a.length;b++){d[b]=e.apply(a[b])}return c.apply({rows:d.join("")})},updateHtml:function(g,f,j){var e=f?f.length:0;var c=g.child(".plet-msg-header"),l=g.child(".plet-msg-header .badge");if(e>0){c.addClass("plet-msg-header-open");c.removeClass("header-0");c.child(".nav-flag i").replaceClass("fa-angle-right","fa-angle-down");l.update(e)}else{c.addClass("header-0");c.removeClass("plet-msg-header-open");l.update("0")}var d="";if(e>0){var m=[];var h=new Ext.Template(j);for(var b=0,a=e;b<a;b++){m[b]=h.apply(f[b])}d=m.join("")}g.child(".plet-msg-ct").update(d)},queryCheck:function(c){var d=this;var b=JxDefault.getUserId();var e=function(g){g=g.root;var h='<li funid="{wf_assign__fun_id}">{wf_instance__process_name}&nbsp;[{process_num}]</li>';d.updateHtml(c,g,h);c.select(".plet-msg-ct li").on("click",function(j,i){var l=i.getAttribute("funid");JxUtil.showCheckData(l,"",b)})};var a=encodeURIComponent("wf_assign.assign_userid = ?");var f="eventcode=query_data&funid=queryevent&query_funid=wf_assign_num&where_sql="+a+"&where_value="+b+"&where_type=string&has_page=0";Request.dataRequest(f,e)},queryWarn:function(a){var b=this;var c=function(e){e=e.root;var f='<li funid="{fun_id}" wheresql="{whereSql}">{warn_name}&nbsp;[{warn_num}]</li>';b.updateHtml(a,e,f);a.select(".plet-msg-ct li").on("click",function(j,h){var i=h.getAttribute("funid");var g=h.getAttribute("wheresql");var l={whereSql:g};Jxstar.createNode(i,l)})};var d="funid=sys_warn&eventcode=cntwarn";Request.dataRequest(d,c)},queryBoard:function(b,e){var a=this;var d=e.initialConfig.objectid||"1,2";var c=function(g){datas=g;var h='<li newsId="{news_id}" wheresql="{whereSql}">{news_title}&nbsp;</li>';a.updateHtml(b,datas,h);b.select(".plet-msg-ct li").on("click",function(l,j){var n=j.getAttribute("newsId");var i=j.getAttribute("wheresql");var m={whereSql:i};JxSender.readBoard(n)})};var f="funid=oa_news&eventcode=qrycont&pagetype=grid&shownum=6&conttype="+d;Request.dataRequest(f,c)},queryNotify:function(a){var b=this;b.updateHtml(a,[],"")}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt.contentTypes.portlet_result={refresh:function(b){var a=b.getComponent(0);if(a.isXType("grid")){Jxstar.reload(a)}else{if(a.reload){a.reload()}}},showPortlet:function(b){var a=this;if(b==null){JxHint.alert(jx.plet.noparent);return}if(b.body){a.renderPortlet(b)}else{b.on("afterrender",function(){a.renderPortlet(b)})}},renderPortlet:function(b){b.removeAll(b.getComponent(0),true);var d=b.initialConfig.objectid;var c={pageType:"notoolgrid",showCall:function(j){if(j.showCall){j.showCall(b)}if(j.isXType("grid")){var i=j.getStore();var f=new Ext.PagingToolbar({store:i,displayInfo:false,pageSize:Jxstar.pageSize,hidden:true,listeners:{change:function(v,r){var p=b.header;var q=p.child("i.x-tool-prev");var o=p.child("i.x-tool-next");var s=(r.pages>1);if(q){q.up("button").setVisible(s)}if(o){o.up("button").setVisible(s)}if(q){q.up("button").dom.disabled=(v.cursor==0)}if(o){o.up("button").dom.disabled=((v.cursor+v.pageSize)>=r.total)}var m=p.child("span.xpt-panel-header-text");if(m){var l=m.child("em");if(l){l.remove()}var u=(r.total==0)?"default":"primary";m.insertHtml("beforeEnd",'<em class="text-'+u+'" style="display:inline;">&nbsp;('+r.total+")</em>")}}}});var h={id:"x-tool-prev",qtip:"上一页",hidden:true,handler:function(n,m,l){f.movePrevious()}};var g={id:"x-tool-next",qtip:"下一页",hidden:true,handler:function(n,m,l){f.moveNext()}};b.addTool(h);b.addTool(g)}}};var a="gridpage";var e=Jxstar.findNode(d);if(e){if(e[a].length==0){a="layout"}}Jxstar.createPage(d,a,b,c)}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPortalExt.contentTypes.portlet_work={refresh:function(b){var a=this;a.updateTab(0,b);a.updateTab(1,b);a.updateTab(2,b);a.queryWarn(b)},getMoreInfo:function(a){Jxstar.createNode(a,{isNotRight:"1"})},showPortlet:function(b){var a=this;if(b.body){a.renderPortlet(b)}else{b.on("afterrender",function(){a.renderPortlet(b)})}},renderPortlet:function(d){var c=this;var b=new Ext.TabPanel({id:"x_main_tab_work",cls:"x_tab_work",border:false,activeTab:0,deferredRender:false,defaults:{autoScroll:true},items:[{itemId:"v_wf_assign",title:jx.cloud.text31,html:'<span class="x-work-nodata">'+jx.cloud.text30+"</span>"},{itemId:"wf_work_exe",title:jx.cloud.text32,html:'<span class="x-work-nodata">'+jx.cloud.text30+"</span>"},{itemId:"wf_work_end",title:jx.cloud.text33,html:'<span class="x-work-nodata">'+jx.cloud.text30+"</span>"},{itemId:"wf_work_warn",title:jx.cloud.text34,html:'<span class="x-work-nodata">'+jx.cloud.text30+"</span>"}]});d.add(b);d.doLayout();c.updateTab(0,d);c.updateTab(1,d);c.updateTab(2,d);c.queryWarn(d);var a=d.getTool("fa-search");if(!a){var a={id:"fa-search",qtip:jx.cloud.text35,handler:function(i,h,f){var g=b.items.indexOf(b.activeTab);if(g<3){c.getMoreInfo(b.getActiveTab().getItemId())}else{JxHint.hint(jx.cloud.text36)}}};d.addTool(a)}setInterval(function(){c.updateTab(0,d);c.queryWarn(d)},1000*60*5)},updateTab:function(e,f){var h=this,d;var j=Jxstar.systemVar.wf__msg__num||"0";if(j=="1"){h.updateTabNum(e,f);return}var i=f.getComponent(0);var b=i.getItem(e);var g=b.getItemId();var a=function(l){var m=l.total;var n='<span class="badge badge-important">'+m+"</span>";if(e==1||e==2||m==0){n="("+m+")"}b.setTitle(h.getTitle(b.title)+n);if(m>0){d=h.createPortlet(g,l.root,e)}else{d='<span class="x-work-nodata">'+jx.cloud.text30+"</span>"}b.update(d)};var c="eventcode=query_data&funid=queryevent&pagetype=grid&query_funid="+g+"&start=0&limit=5";Request.dataRequest(c,a,{has_page:"1",wait:false})},createPortlet:function(e,g,c){var f=new Ext.Template('<table class="x-work-table">',"{rows}","</table>");var b=Jxstar.session.user_id;var j="showCheckData";if(c>0){j="showCheckHisData"}var l="v_wf_assign",d="v_wf_assign__assign_date";if(c==1){l="wf_instance";d="wf_instance__start_date"}if(c==2){l="wf_instancehis";d="wf_instancehis__end_date"}var h=new Ext.Template("<tr funid={"+l+"__fun_id} dataid={"+l+"__data_id} keyid={"+l+'__key_id} msgtype="'+c+'">',"<td>",'<span class="x-msgshow" onclick="JxUtil.'+j+"('{"+l+"__fun_id}', '{"+l+"__data_id}', '"+b+"');\">{"+l+"__instance_title}</span>","</td>",'<td width="70" class="small">',"{"+l+"__start_user}","</td>",'<td width="80" class="small">',"{"+d+"}","</td>",'<td width="100" class="small">',"{"+l+"__process_name}","</td>","</tr>");var m=[];for(var a=0;a<g.length;a++){g[a][d]=JxUtil.shortTime(g[a][d]);m[a]=h.apply(g[a])}return f.apply({rows:m.join("")})},getTitle:function(b){var a=b.indexOf("(");if(a<0){a=b.indexOf("<")}if(a>0){b=b.substring(0,a)}return b},queryWarn:function(d){var b=this;var a=d.getComponent(0).getItem(3);var c=function(f){f=f.root;var j="",g=f?f.length:0;var o=(g==0)?"("+g+")":'<span class="badge badge-important">'+g+"</span>";a.setTitle(b.getTitle(a.title)+o);if(g>0){var l=[];var m=new Ext.Template('<li funid="{fun_id}" wheresql="{whereSql}">{warn_name}&nbsp;[{warn_num}]</li>');for(var h=0,p=g;h<p;h++){l[h]=m.apply(f[h])}j=l.join("");j='<ul class="plet-msg-ct">'+j+"</ul>"}else{j='<span class="x-work-nodata">'+jx.cloud.text30+"</span>"}a.update(j);a.el.select(".plet-msg-ct li").on("click",function(r,n){var q=n.getAttribute("funid");var i=n.getAttribute("wheresql");var s={whereSql:i};Jxstar.createNode(q,s)})};var e="funid=sys_warn&eventcode=cntwarn";Request.dataRequest(e,c)},updateTabNum:function(a,e){var c=this;var b=e.getComponent(0).getItem(a);var d=function(m){var n=m.total;var q=m.root;var g='<span class="badge badge-important">'+n+"</span>";if(a==1||a==2||n==0){g="("+n+")"}b.setTitle(c.getTitle(b.title)+g);var j,l=q.length;if(l>0){var o=[];var p=new Ext.Template('<li funid="{fun_id}">{process_name}&nbsp;[{wf_cnt}]</li>');for(var h=0;h<l;h++){o[h]=p.apply(q[h])}j=o.join("");j='<ul class="plet-msg-ct">'+j+"</ul>"}else{j='<span class="x-work-nodata">'+jx.cloud.text30+"</span>"}b.update(j);b.el.select(".plet-msg-ct li").on("click",function(v,s){var x=s.getAttribute("funid");var y=Jxstar.findNode(x);var i=y.pkcol.replace("__",".");var r=Jxstar.session.user_id;var w;if(a==0){w={showType:"form",pageType:"check",whereSql:" exists (select * from v_wf_assign where assign_userid = ? and fun_id = ? and data_id = "+i+")",whereValue:r+";"+x,whereType:"string;string"}}else{var u=(a==1)?"wf_instance":"wf_instancehis";w={pageType:"chkqry",whereSql:" exists (select * from "+u+" where (start_userid = ? or exists (select * from wf_assignhis where check_userid = ? and "+u+".instance_id = wf_assignhis.instance_id)) and fun_id = ? and data_id = "+i+")",whereValue:r+";"+r+";"+x,whereType:"string;string;string"}}Jxstar.createNode(x,w)})};var f="eventcode=qrynum&funid=v_wf_assign&type="+a;Request.dataRequest(f,d)}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxMenu={};(function(){JxMenu.style="black";JxMenu.istree=false;var a=function(f,i,h){var g=i.getRelatedTarget();if(!g){return}if(!g.contains(i.getTarget())&&!f.getEl().contains(g)){if(!Ext.get(i.getTarget()).hasClass("x-menu-item")){f.hide()}}else{if(g.contains(f.getEl().dom)){if(!Ext.get(i.getTarget()).hasClass("x-menu-item-icon")&&!Ext.get(i.getTarget()).hasClass("x-menu-item")){f.hide()}}}};var b=function(f,g){if(g.isCollapsed){if(f.id=="xnode-11"&&!f.hasmv){f.eachChild(function(h){Ext.get(h.ui.getEl()).on("mouseenter",function(){if(this.isLeaf()){return}if(!g.isCollapsed||this.isExpanded()){return}this.fireEvent("click",this)},h)});f.hasmv=true}}else{if(f.attributes.cls=="one-menu"&&!f.hasmv){f.eachChild(function(h){Ext.get(h.ui.getEl()).on("mouseenter",function(){if(this.isLeaf()){return}if(g.isCollapsed||this.isExpanded()){return}this.fireEvent("click",this)},h)});f.hasmv=true}}};var e=function(j){if(j.isCollapsed){j.setWidth(200);var g=j.root.childNodes;for(var h=0;h<g.length;h++){var f=g[h].ui.getEl();f.querySelector("div.one-menu").classList.remove("collpse")}Ext.getCmp("top_left_img").setWidth(200);Ext.fly("main_logo_bg").removeClass("collpse");Jxstar.viewport.doLayout();j.isCollapsed=false}else{j.root.collapse(true);j.setWidth(56);var g=j.root.childNodes;for(var h=0;h<g.length;h++){var f=g[h].ui.getEl();f.querySelector("div.one-menu").classList.add("collpse")}Ext.getCmp("top_left_img").setWidth(56);Ext.fly("main_logo_bg").addClass("collpse");Jxstar.viewport.doLayout();j.isCollapsed=true}b(j.root,j);Ext.util.Cookies.set("menu_collapsed",j.isCollapsed?"1":"0")};var d=function(h){var j=(!Ext.isTrident&&Ext.isGecko)?"itc":"";if(h.isLeaf()){if(h.text.indexOf("fun-icon")<0){var i=h.attributes.iconcls;if(!i||i.length==0){i="fa-funicon"}var g='<i class="fun-icon fa '+i+'"></i>'+h.text;h.setText(g)}}else{if(h.attributes.cls!="one-menu"&&h.text.indexOf("funmd-icon")<0){var i=h.attributes.iconcls;if(!i||i.length==0){i="fa-folder-o"}var f=JxMenu.istree?"funmdy-icon ":"funmdx-icon ";var g='<i class="'+f+j+' fa fa-caret-right"></i><i class="funmd-icon fa '+i+'"></i>'+h.text;h.setText(g)}h.eachChild(function(l){d(l)})}};var c=function(m,n){var g=function(y,r,B){if(!y||y.length==0){return}var v=[];for(var u=0;u<y.length;u++){if(r.indexOf(y[u].id)==0){if(r==y[u].id){var p=[],x=y[u].children;for(var t=0;t<x.length;t++){var z=x[t].cls;var w=x[t].iconcls;if(!w||w.length==0){w="fa-funicon"}var A=x[t].text;if(A.indexOf("fun-icon")<0){A='<i class="fun-icon fa '+w+'"></i>'+A}var o={itemId:x[t].id,text:A,cls:z};if(z=="two-menu"){var A=x[t].text;if(A.indexOf("funmd-icon")<0){o.text='<i class="funmdx-icon fa fa-caret-right"></i><i class="funmd-icon fa fa-folder-o"></i>'+A}else{o.text=A}g(x,x[t].id,o)}p[p.length]=o}if(p.length>0){var q=new Ext.menu.Menu({width:200,cls:"x-menu x-menu-two",items:p});q.on("mouseout",a);B.menu=q;q.on("click",function(s,D){var E=D.getItemId();var C=D.initialConfig.cls;if(C=="three-menu"){Jxstar.createNode(E)}})}return}else{g(y[u].children,r,B)}}}};d(m);if((m.attributes.cls=="two-menu")||(n.isCollapsed&&m.attributes.cls=="one-menu")){if(!m.menu){var h=[];m.eachChild(function(r){var p=r.attributes.cls;var q=r.text;if(q.indexOf(" itc ")>0){q=q.replace(" itc "," ")}var o={itemId:r.id,text:q,cls:p};if(p=="two-menu"){g(n.menuData,r.id,o)}h[h.length]=o});if(m.attributes.cls=="one-menu"){var i=m.text.split(">");var l=i[i.length-2].split("<");h.insert(0,{itemId:m.id,text:l[0],disabled:true})}m.menu=new Ext.menu.Menu({width:200,cls:"x-menu x-menu-two",items:h});m.menu.on("mouseout",a);m.menu.on("click",function(o,q){var r=q.getItemId();var p=q.initialConfig.cls;if(p=="three-menu"){Jxstar.createNode(r)}})}var f=n.isCollapsed?55:199;var j=Ext.get(m.ui.getEl());m.menu.showAt([j.getX()+f,j.getY()-1]);return false}return true};Ext.apply(JxMenu,{init:function(h){var g=true;JxMenu.istree=Jxstar.systemVar.index__menu__mode=="tree";Ext.fly("main_collpse").on("click",function(){e(h)});var f=Ext.util.Cookies.get("menu_collapsed");h.on("expandnode",function(i){if(f=="1"&&g){e(h);g=false}if(!JxMenu.istree||h.isCollapsed){b(i,h)}});h.on("beforeexpandnode",function(i){if(JxMenu.istree&&!h.isCollapsed){d(i)}else{return c(i,h)}})},showProxy:function(){var h=Jxstar.session.proxy_id;if(h){Jxstar.isProxyUser=true;return}var i=function(l){Jxstar.hasProxyUser=(l.total>0)};var g=Jxstar.session.user_id;var f=(new Date()).add(Date.DAY,-1).format("Y-m-d");var j="eventcode=query_data&funid=queryevent&pagetype=grid&query_funid=sys_proxy&where_sql=auditing=1 and user_id = ? and end_date > ?&where_type=string;date&where_value="+g+";"+f;Request.dataRequest(j,i)},selProxy:function(){var f=function(l){var i=Jxstar.session.user_id;var h=(new Date()).add(Date.DAY,-1).format("Y-m-d");var j={where_sql:"auditing=1 and user_id = ? and end_date > ?",where_type:"string;date",where_value:i+";"+h};Jxstar.loadData(l,j)};var g=Jxstar.findNode("sys_proxy_sel");Jxstar.showData({filename:g.gridpage,title:g.nodetitle,pagetype:"selgrid",width:600,height:300,callback:f})},outProxy:function(){var f=Jxstar.session.proxy_id;var g=Jxstar.session.user_id;var h=Jxstar.session.proxy_user_id;JxMenu.loginProxy(g,h,"0",f)},loginProxy:function(j,l,i,h){var f=Jxstar.path+"/jxstar/other/jsp/workproxy.jsp?proxy_in="+i+"&to_userid="+j+"&proxy_userid="+l;if(h){f+="&proxy_id="+h}var g=function(m){Jxstar.viewport.destroy();Jxstar.viewport=null;var n=Ext.getCmp("main_user_menu");if(n){n.destroy()}delete Jxstar.isProxyUser;delete Jxstar.hasProxyUser;m.maxInterval=Jxstar.session.maxInterval;m.sessionId=Jxstar.session.sessionId;Jxstar.session=m;Request.loadJS("/public/core/JxBody.js")};Ext.Ajax.request({method:"POST",url:f,success:function(n){var m=Ext.decode(n.responseText);if(m.success==true||m.success=="true"){JxHint.hint(jx.util.exesus+m.message);g(m.data)}else{var o=m.message;JxHint.alert(jx.util.exefa+o)}},failure:function(m){m.srcdesc="JxMenu.js?login_url="+f;JxUtil.errorResponse(m)}})},updatePhoto:function(g){var f=Jxstar.session.user_id;var h="funid=sys_attach&eventcode=qryatt&attachfield=user_photo";h+="&tablename=sys_user&dataid="+f;Request.dataRequest(h,function(i){if(i&&i.attachId){var j="funid=sys_attach&eventcode=downPhoto&keyid="+i.attachId;j+="&dataType=byte&image_small_use=1&image_small_size=120&nousercheck=1&dc="+(new Date()).getTime();g.src=Jxstar.path+"/fileAction.do?"+j}})},updateNum:function(){var f="funid=oa_msg&eventcode=getnum";Request.dataRequest(f,function(h){var g=document.getElementById("main_msg_icon").querySelector("span.badge");if(g){if(!h||!h.num||h.num==0){h.num="";Ext.fly(g).addClass("hidden")}else{Ext.fly(g).removeClass("hidden")}g.innerHTML=h.num}})},showMsg:function(n){var m="xx_main_msg_win";var l=Ext.getCmp(m);if(l!=null){return}var f=450;var i=Jxstar.viewport;var j=Jxstar.sysMainTab;var h=function(p){var o=p();var q=new Ext.Window({id:m,title:"通知",x:i.getWidth()-f,y:i.getComponent(0).getHeight()+1,width:f,height:j.getHeight(),constrainHeader:true,border:false,modal:false,closeAction:"close",autoScroll:true,tools:[{id:"fa-cube",qtip:"标记全部已阅",handler:function(){o.readall()}},{id:"fa-search",qtip:"查看更多",handler:function(u,t,r){var s=Jxstar.session.user_id;Jxstar.createNode("oa_msg",{pageType:"query",isNotRight:"1",whereSql:"to_userid = ?",whereType:"string",whereValue:s});q.close()}}],items:[o]});q.show(n)};var g="/jxstar/oa/pub/plet_oa_msg.js";Request.loadJS(g,h)},changeTheme:function(g){var f=g.initialConfig.value;JxMenu.setTheme(f);Ext.util.Cookies.set("menu_theme",f)},setTheme:function(f){if(!f){f=Ext.util.Cookies.get("menu_theme")}var g=document.getElementsByTagName("head")[0];var i=Jxstar.domTheme;if(i){g.removeChild(i);Jxstar.domTheme=null}if(f=="green"){Jxstar.domTheme=JxUtil.loadCss("/resources/css/main-green.css",true)}else{if(f=="gray"){Jxstar.domTheme=JxUtil.loadCss("/resources/css/main-gray.css",true)}}return f},showTopMenu:function(j){var n=localStorage.getItem("select_tenants");if(n){Jxstar.tenants=JSON.parse(n);localStorage.removeItem("select_tenants")}var i=j.getComponent(2);var p=i.el.child("li.top-menu-msg");p.on("click",function(){JxMenu.showMsg(p)});JxMenu.updateNum();setInterval(function(){JxMenu.updateNum()},1000*60);var l,f=Jxstar.systemVar.index__style__use;if(f=="1"){l=JxMenu.setTheme();if(!l||l.length==0){l="black"}JxMenu.style=l}var g=i.el.child("li.top-menu-user");var h=g.child("img.nav-user-photo").dom;this.updatePhoto(h);var m=JxDefault.getDeptName();var r=JxDefault.getUserName();var q=Jxstar.session.proxy_user_name;if(JxLang.type!="zh"){q=Jxstar.session.proxy_user_code}if(q){r+="("+q+"-"+jx.base.proxy+")";r='<span title="'+r+'">'+r+"</span>"}var o=r+'<br><small title="'+m+'">'+m+"</small>";g.child("span.user-info").dom.innerHTML=o;g.on("click",function(){var t=Ext.getCmp("main_user_menu");if(!t){var s=[{text:jx.cloud.text1,handler:function(){JxUtil.showUser()}},{text:jx.base.lineuser,handler:function(){JxUtil.onLineUser()}},{text:jx.sys.modpwd,handler:function(){JxUtil.setPass(JxDefault.getUserId())}},"-",{text:jx.base.exitsys1,handler:function(){JxUtil.logout()}}];if(f=="1"){s.insert(1,{text:jx.cloud.text2,menu:{items:[{text:jx.cloud.text3,value:"black",checked:(l=="black"),group:"theme",handler:JxMenu.changeTheme},{text:jx.cloud.text4,value:"green",checked:(l=="green"),group:"theme",handler:JxMenu.changeTheme},{text:jx.cloud.text5,value:"gray",checked:(l=="gray"),group:"theme",handler:JxMenu.changeTheme}]}})}if(Jxstar.tenants){s.insert(2,{text:jx.cloud.text6,handler:function(){JxUtil.showTenants()}})}if(Jxstar.isProxyUser===true){s.insert(3,{text:jx.index.mtext2,handler:function(){JxMenu.outProxy()}})}else{if(Jxstar.hasProxyUser===true){s.insert(3,{text:jx.index.mtext1,handler:function(){JxMenu.selProxy()}})}}t=new Ext.menu.Menu({id:"main_user_menu",items:s})}t.showAt([g.getX(),g.getY()+60])})},addScroll:function(h){var g=h.body.dom;var f=h.body.child("ul.x-tree-root-ct",true);new JxScrollBar({mainBox:g,contentBox:f,onInit:function(i){h.on("expandnode",function(){i.resizeScorll()});h.on("resize",function(){i.resizeScorll()})}})}});JxUtil.showWfnav=function(f){var h=Ext.get(f);var g=function(q){if(q!=null){q=q.root}if(q==null||q.length==0){return}var l=[];for(var o=0,u=q.length;o<u;o++){var p=q[o].wfnav_graph__graph_id;var s=q[o].wfnav_graph__graph_name;if(JxLang.type!="zh"){var m=joLang.wftitle["wfnav__"+p];if(m&&m.length>0){s=m}}l[o]={text:s,itemId:p,handler:function(n){JxWfGraph.showGraphFun(n.getItemId(),null,false,n.text)}}}var r=new Ext.menu.Menu({items:l});r.showAt([h.getX(),h.getY()+60])};var j=encodeURIComponent("auditing = 1");var i="eventcode=query_data&funid=queryevent&pagetype=grid&query_funid=wfnav_graph&where_sql="+j;Request.dataRequest(i,g)}})();JxScrollBar=function(a){Ext.apply(this,a);this.init();JxScrollBar.superclass.constructor.call(this,a)};(function(){var c=-1;var e=false;function g(j,i,h){if(j.addEventListener){j.addEventListener(i,h,false)}else{if(j.attachEvent){j.attachEvent("on"+i,h)}else{j["on"+i]=h}}}function d(j,i){g(j,"mousewheel",function(l){var m=-h(l);i(m);if(document.all){window.event.returnValue=false}else{l.preventDefault()}});g(j,"DOMMouseScroll",function(l){var m=h(l);i(m);l.preventDefault()});function h(l){var m=l||window.event;return m.wheelDelta?m.wheelDelta:m.detail*40}}var f=function(m,j){var l=document.createElement("div");var h=document.createElement("div");var i=document.createElement("span");l.appendChild(h);h.appendChild(i);h.className=j;m.appendChild(l);return h};var b=function(j,m,h,i,l){j.onmousedown=function(n){var o=m.clientHeight;var r=j.offsetTop;var q=n||window.event;var p=q.clientY;document.onmousemove=s;document.onmouseup=function(t){this.onmousemove=null};function s(t){var v=t||window.event;var w=v.clientY;var u=w-p+r;if(u>(o-j.offsetHeight)){u=o-j.offsetHeight}if(u<=0){u=0}j.style.top=u+"px";h.style.top=-u*(h.offsetHeight/m.offsetHeight)+"px";c=u}};j.onmouseover=function(){this.style.background=l};j.onmouseout=function(){this.style.background=i}};var a=function(j,m,i){var h=0,l=0;d(m,function(n){if(!e){return}l+=n;if(c>=0){h=c;j.style.top=h+"px";l=c*12;c=-1}else{h=l/12}if(h<=0){h=0;l=0}if(h>=(m.offsetHeight-j.offsetHeight)){h=(m.clientHeight-j.offsetHeight);l=(m.clientHeight-j.offsetHeight)*12}j.style.top=h+"px";i.style.top=-h*(i.offsetHeight/m.offsetHeight)+"px"})};Ext.extend(JxScrollBar,Ext.util.Observable,{color_box:"#32404E",color_div:"#222",color_div_over:"#222",mainBox:null,contentBox:null,scrollDivClassName:"menu_scrolldiv",scrollDiv:null,init:function(){var h=JxMenu.style;if(h=="green"||h=="gray"){this.color_box="#C7C7CC";this.color_div="#929292";this.color_div_over="#797979"}this.scrollDiv=f(this.mainBox,this.scrollDivClassName);this.resizeScorll();b(this.scrollDiv,this.mainBox,this.contentBox,this.color_div,this.color_div_over);a(this.scrollDiv,this.mainBox,this.contentBox);if(this.onInit){this.onInit(this)}},resizeScorll:function(){var r=this;var m=r.scrollDiv;var o=r.mainBox;var q=r.contentBox;var i=m.parentNode;var s=q.offsetHeight;var j=o.clientWidth;var l=o.clientHeight;var n=m.offsetWidth;if(n==0){n=8}var t=j-n;i.style.width=n+"px";i.style.height=l+"px";i.style.left=t+"px";i.style.position="absolute";i.style.background=r.color_box;var h=parseInt(l*(l/s));if(h>=o.clientHeight){e=false;i.style.display="none";i.style.top="0px";q.style.top="0px"}else{e=true;i.style.display=""}m.style.height=h+"px";if(e){o.onmouseover=function(){i.style.display=""};o.onmouseout=function(){i.style.display="none"}}else{o.onmouseover=null;o.onmouseout=null}}})})();
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.JxPagerTool=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.JxPagerTool,Object,{init:function(b){var f=this;var e=[[20,"20"],[50,"50"],[100,"100"],[200,"200"]];var d=new Ext.form.ComboBox({triggerAction:"all",mode:"local",width:70,editable:false,store:new Ext.data.SimpleStore({fields:["value","text"],data:e}),valueField:"value",displayField:"text",value:f.pageSize||Jxstar.pageSize,listeners:{select:function(i,g,h){b.pageSize=g.get("value");b.changePage(1);return true}}});var c=Ext.Toolbar;var a=b.items.indexOf(b.displayItem);b.insert(a+1,new c.TextItem(", "+jx.query.ppage));b.insert(a+2,d);b.insert(a+3,new c.TextItem(jx.query.row))}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.form.JxImageField=Ext.extend(Ext.form.DisplayField,{imgStyle:"",addbtnCls:"fa x-tool-plus",delbtnCls:"fa x-tool-minus",blankText:"This field is required",allowBlank:true,value:"",initComponent:function(){Ext.ux.form.JxImageField.superclass.initComponent.call(this);this.addEvents("beforesave","aftersave","beforedelete","afterdelete")},onRender:function(b,a){Ext.ux.form.JxImageField.superclass.onRender.call(this,b,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-image-wrap"});this.el.hide();this.el.dom.removeAttribute("name");this.createImage();this.addbtn=this.wrap.createChild(this.addbtnCfg||{tag:"i",cls:"x-form-image-btn x-tool "+this.addbtnCls,title:"上传图片",style:"padding:7px;right:38px;"});this.delbtn=this.wrap.createChild(this.delbtnCfg||{tag:"i",cls:"x-form-image-btn x-tool "+this.delbtnCls,title:"删除图片",style:"padding:7px;right:12px;"});this.initBtn();this.wrap.setHeight(b.getHeight()+10);this.resizeEl=this.positionEl=this.wrap},afterRender:function(){Ext.ux.form.JxImageField.superclass.afterRender.call(this);if(this.rendered){this.loadImage(Ext.BLANK_IMAGE_URL)}},onResize:function(a,b){Ext.ux.form.JxImageField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a-10)},getErrors:function(a){var b=[];if(this.allowBlank==false&&(a.length<1||a===this.emptyText)){b.push(this.blankText)}return b},isValid:function(){var a=Ext.form.DisplayField.superclass.isValid.call(this);return a},validate:function(){var a=Ext.form.DisplayField.superclass.validate.call(this);return a},getRawValue:function(){return this.value},getValue:function(){return this.getRawValue()},setValue:function(a){this.value=a;return this},createImage:function(){this.imageEl=this.wrap.createChild({id:this.getImageId(),name:this.name||this.getId(),cls:"x-form-image",tag:"img",style:this.imgStyle,src:this.getImageUrl()})},getImageId:function(){return this.id+"-img"},getImageUrl:function(){return this.imageUrl||""},initBtn:function(){this.mon(this.addbtn,"click",this.onAddClick,this);this.addbtn.addClassOnOver(this.addbtnCls+"-over");this.mon(this.delbtn,"click",this.onDelClick,this);this.delbtn.addClassOnOver(this.delbtnCls+"-over");var a=this.imageEl;a.on("click",function(b){JxAttach.previewImage("image_field","浏览图片",a.dom.src)})},onDestroy:function(){Ext.destroy(this.imageEl,this.addbtn,this.delbtn,this.wrap);Ext.ux.form.JxImageField.superclass.onDestroy.call(this)},onDisable:function(){Ext.ux.form.JxImageField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.JxImageField.superclass.onEnable.call(this);this.doDisable(false)},setReadOnly:function(a){Ext.ux.form.JxImageField.superclass.setReadOnly.call(this,a);this.doDisable(a)},doDisable:function(a){if(this.addbtn&&this.delbtn){if(a){this.addbtn.addClass(this.disabledClass);this.delbtn.addClass(this.disabledClass)}else{this.addbtn.removeClass(this.disabledClass);this.delbtn.removeClass(this.disabledClass)}}this.disabled=a},loadImage:function(a){if(a){this.imageUrl=a}else{var b=JxAttach.attachParam(this,"fdown");if(b==null){return}b=b.params;if(this.loadImageParam){b=this.loadImageParam(this)}this.imageUrl=Jxstar.path+"/fileAction.do?"+b+"&dataType=byte&nousercheck=1&dc="+(new Date()).getTime()}this.imageEl.dom.src=this.imageUrl},clearImage:function(){this.setValue("");if(this.imageEl){this.imageUrl=Ext.BLANK_IMAGE_URL;this.imageEl.dom.src=this.imageUrl}},onDelClick:function(){if(this.disabled){return}var c=this;var b=c.image_small_use||"0";var d=c.image_small_size||"600";var a=c.deletecode||"fdelete";var e=function(){var j=JxAttach.attachParam(c,a);if(j==null){return}if(c.fireEvent("beforedelete",c,j)==false){return}var g="0",i="6";if(j.define.status){g=j.define.status.audit0}var f=g;if(j.define.auditcol.length>0){f=j.form.get(j.define.auditcol)}if(f!=g&&f!=i){JxHint.alert(jx.util.auditnd);return}var h=function(){c.fireEvent("afterdelete",c,j);c.loadImage()};if(b=="1"){j.params+="&image_small_use=1&image_small_size="+d}Request.postRequest(j.params,h)};Ext.Msg.confirm(jx.base.hint,"确定删除当前图片附件吗？",function(f){if(f=="yes"){e()}})},onAddClick:function(){if(this.disabled){return}var b=this.image_small_use||"0";var d=this.image_small_size||"600";var g=this.createcode||"fcreate";var e=this;var f=this.name;var a=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",items:[{anchor:"95%",allowBlank:false,xtype:"fileuploadfield",useType:"file",fieldLabel:jx.event.selfile,name:f,labelSeparator:"*",buttonText:"",buttonCfg:{iconCls:"upload_icon"}}]});var c=this;var h=new Ext.Window({title:jx.event.uptitle,layout:"fit",width:400,height:170,resizable:false,modal:true,closeAction:"close",items:[a],buttons:[{text:jx.base.ok,handler:function(){var l=a.getForm();if(!l.isValid()){return}var i=l.get(f);var n=JxAttach.attachParam(e,g);if(n==null){return}if(c.fireEvent("beforesave",c,n)==false){return}var m=n.params+"&attach_name="+encodeURIComponent(i);if(b=="1"){m+="&image_small_use=1&image_small_size="+d}var j=function(){h.close();c.fireEvent("aftersave",c,n);e.setValue(i);e.originalValue=i;if(n.form&&n.form.myRecord){var o=n.form.myRecord;o.set(f,i);o.commit()}e.loadImage()};Request.fileRequest(l,m,j)}},{text:jx.base.cancel,handler:function(){h.close()}}]});h.show()}});Ext.reg("imagefield",Ext.ux.form.JxImageField);
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Request={};(function(){if(Ext.LoadMask){Ext.LoadMask.prototype.msg=jx.req.exeing}Ext.apply(Request,{loadXML:function(data){if(data==null||data.length==0){return}var xdoc=null;if(typeof(DOMParser)=="undefined"){xdoc=new ActiveXObject("Microsoft.XMLDOM");xdoc.async="false";xdoc.loadXML(data)}else{var parser=new DOMParser();xdoc=parser.parseFromString(data,"application/xml")}return xdoc},loadJS:function(url,hdCall,cached){if(cached==null){cached=false}if(url==null||url.length==0){JxHint.alert("Request.loadJS"+jx.req.nopath);return}if(url.charAt(0)!="/"){url="/"+url}Ext.Ajax.request({method:"GET",url:Jxstar.path+url,success:function(response){var f=eval(response.responseText);if(!f&&response.responseText.indexOf("Jxstar.currentPage")>=0){JxUtil.delay(200,function(){f=eval(response.responseText);if(!f){alert("js load error: "+response.responseText)}else{if(f&&hdCall!=null){hdCall(f)}f=null;Jxstar.currentPage=null}});return}if(f&&hdCall!=null){hdCall(f)}f=null;Jxstar.currentPage=null},failure:function(response){response.srcdesc="Request.loadJS?url="+url;JxUtil.errorResponse(response)},disableCaching:!cached})},loadJsp:function(url){if(url==null||url.length==0){JxHint.alert("Request.loadJsp"+jx.req.nopath);return}Ext.getBody().load({method:"GET",url:url,scripts:true})},postRequest:function(params,hdCall,options){options=options||{};options.action="event";this.asynchRequest(params,hdCall,options)},dataRequest:function(params,hdCall,options){options=options||{};options.action="query";this.asynchRequest(params,hdCall,options)},asynchRequest:function(params,hdCall,options){SessionTimer.resetTimer();var myMask=null;var useWait=options.wait||false;var dataType=options.type||"json";var action=options.action;var sync=options.sync||false;var timeout=options.timeout||60000;params+="&user_id="+Jxstar.session.user_id;params+="&dataType="+dataType;params+="&appid=jxstar";if(action=="query"){params+="&query_type="+(options.query_type||"0");params+="&has_page="+(options.has_page||"0")}useWait=useWait||(action=="event");if(useWait){if(!myMask){myMask=new Ext.LoadMask(Ext.getBody())}myMask.show()}Ext.Ajax.request({method:"POST",url:Jxstar.path+"/commonAction.do",timeout:timeout,success:function(response){var result={};if(dataType=="xml"){var xdoc=response.responseXML;var query=Ext.DomQuery;result.data=query.selectValue("data",xdoc);result.success=query.selectValue("success",xdoc);result.message=query.selectValue("message",xdoc)}else{try{result=JSON.parse(response.responseText)}catch(e){alert("JSON格式错误：\n"+response.responseText+"\nJSON解析异常：\n"+e.message);return}}if(useWait&&myMask){myMask.hide();myMask=null}if(result.success==true||result.success=="true"){var msg=result.message;if(action=="event"){if(msg.length==0){msg=jx.req.success}JxHint.hint(msg)}if(hdCall!=null){hdCall(result.data,result.extData)}}else{if(options&&options.errorcall){options.errorcall(result)}else{var msg=result.message;if(msg.length==0){msg=jx.req.faild}if(msg.indexOf(jx.req.onlyone)>=0){alert(msg);JxUtil.isLogout=true;window.location.href=Jxstar.logoutUrl||Jxstar.path}else{JxHint.alert(msg)}}}},failure:function(response){if(useWait&&myMask){myMask.hide();myMask=null}response.srcdesc="Request.asynchRequest=/commonAction.do?"+params;JxUtil.errorResponse(response)},params:params})},fileUpdate:function(targetId,params,hdCall){SessionTimer.resetTimer();params=params||"";if(params.indexOf("&user_id=")<0){params+="&user_id="+Jxstar.session.user_id}if(params.indexOf("&dataType=")<0){params+="&dataType=byte"}Ext.get(targetId).load({method:"POST",url:Jxstar.path+"/fileAction.do",scripts:true,nocache:true,callback:function(el,success,response,options){if(success==true){if(hdCall!=null){hdCall(response.responseText)}}else{response.srcdesc="Request.fileUpdate=/fileAction.do?"+params;JxUtil.errorResponse(response)}},params:params})},fileDown:function(params){SessionTimer.resetTimer();params=params||"";if(params.indexOf("&user_id=")<0){params+="&user_id="+Jxstar.session.user_id}if(params.indexOf("&dataType=")<0){params+="&dataType=byte"}var href=Jxstar.path+"/fileAction.do?"+params;href+="&_dc="+(new Date()).getTime();Request.postFormURL(href)},postFormURL:function(href){var fd=Ext.get("frmPostHref");if(!fd){fd=Ext.DomHelper.append(Ext.getBody(),{tag:"form",method:"post",id:"frmPostHref",name:"frmPostHref",target:"frmhidden",cls:"x-hidden"},true)}fd.dom.action=href;fd.dom.submit()},attachDown:function(params){Request.fileDown(params)},fileRequest:function(form,params,hdCall,field){SessionTimer.resetTimer();params=params||"";if(params.indexOf("&user_id=")<0){params+="&user_id="+Jxstar.session.user_id}form.fileUpload=true;form.method="POST";form.submit({url:Jxstar.path+"/fileAction.do",waitTitle:jx.req.wait,waitMsg:jx.req.uping,clientValidation:false,success:function(form,action){var rsp=action.response;var result=Ext.decode(rsp.responseText);if(result.success){var msg=result.message;if(msg.length==0){msg=jx.req.success}JxHint.hint(msg);if(hdCall!=null){hdCall(result.data)}}else{if(field){field.setValue("")}if(rsp){rsp.srcdesc="Request.fileRequest=/fileAction.do?"+params;JxUtil.errorResponse(rsp)}else{JxHint.alert(jx.req.ajaxerror)}}},failure:function(form,action){if(field){field.setValue("")}switch(action.failureType){case Ext.form.Action.CLIENT_INVALID:JxHint.alert(jx.req.formnd);break;case Ext.form.Action.CONNECT_FAILURE:JxHint.alert(jx.req.confa);break;case Ext.form.Action.SERVER_INVALID:var rsp=action.response;if(rsp){rsp.srcdesc="Request.fileRequest=/fileAction.do?"+params;JxUtil.errorResponse(rsp)}else{JxHint.alert(jx.req.ajaxerror)}}},params:params})},expFile:function(getParams,postParams){var fd=Ext.get("frmExpFile");if(!fd){fd=Ext.DomHelper.append(Ext.getBody(),{tag:"form",method:"post",id:"frmExpFile",name:"frmExpFile",target:"frmhidden",cls:"x-hidden",cn:[{tag:"input",name:"exp_text",id:"exp_text",type:"hidden"},{tag:"input",name:"query_type",id:"query_type",type:"hidden"},{tag:"input",name:"where_sql",id:"where_sql",type:"hidden"},{tag:"input",name:"where_value",id:"where_value",type:"hidden"},{tag:"input",name:"where_type",id:"where_type",type:"hidden"}]},true)}var pps=postParams||{};fd.child("#exp_text").set({value:pps.exp_text||""});fd.child("#query_type").set({value:pps.query_type||"0"});fd.child("#where_sql").set({value:pps.where_sql||""});fd.child("#where_value").set({value:pps.where_value||""});fd.child("#where_type").set({value:pps.where_type||""});var href=Jxstar.path+"/fileAction.do";var gps=getParams||"";if(gps.indexOf("&user_id=")<0){gps+="&user_id="+Jxstar.session.user_id}if(gps.indexOf("&dataType=")<0){gps+="&dataType=byte"}if(gps.length>0){href+="?"+encodeURI(gps)}fd.dom.action=href;fd.dom.submit()},exportCSV:function(grid,fileName,includeHidden){var content=JxUtil.gridToCSV(grid,Ext.isEmpty(includeHidden)?true:includeHidden);this.exportString(fileName,content)},exportString:function(fileName,content,charset){if(charset==null){charset="GBK"}var fd=Ext.get("frmDummy");if(!fd){fd=Ext.DomHelper.append(Ext.getBody(),{tag:"form",method:"post",id:"frmDummy",name:"frmDummy",action:Jxstar.path+"/jxstar/other/jsp/exportfile.jsp",target:"_blank",cls:"x-hidden",cn:[{tag:"input",name:"charset",id:"charset",type:"hidden"},{tag:"input",name:"fileName",id:"fileName",type:"hidden"},{tag:"input",name:"exportContent",id:"exportContent",type:"hidden"}]},true)}fd.child("#charset").set({value:charset});fd.child("#fileName").set({value:fileName});fd.child("#exportContent").set({value:content});fd.dom.submit()}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
function XmlRequest(f,b,c,d,e,a){this.url=b;this.params=d;this.method=f||"POST";this.async=(c!=null)?c:true;this.username=e;this.password=a}XmlRequest.prototype.url=null;XmlRequest.prototype.params=null;XmlRequest.prototype.method=null;XmlRequest.prototype.async=null;XmlRequest.prototype.binary=false;XmlRequest.prototype.username=null;XmlRequest.prototype.password=null;XmlRequest.prototype.request=null;XmlRequest.prototype.isBinary=function(){return this.binary};XmlRequest.prototype.setBinary=function(a){this.binary=a};XmlRequest.prototype.getText=function(){return this.request.responseText};XmlRequest.prototype.isReady=function(){return this.request.readyState==4};XmlRequest.prototype.getDocumentElement=function(){var a=this.getXml();if(a!=null){return a.documentElement}return null};XmlRequest.prototype.getXml=function(){var a=this.request.responseXML;if(a==null||a.documentElement==null){a=mxUtils.parseXml(this.request.responseText)}return a};XmlRequest.prototype.getText=function(){return this.request.responseText};XmlRequest.prototype.getStatus=function(){return this.request.status};XmlRequest.prototype.create=function(){if(window.XMLHttpRequest){return function(){var a=new XMLHttpRequest();if(this.isBinary()&&a.overrideMimeType){a.overrideMimeType("text/plain; charset=x-user-defined")}return a}}else{if(typeof(ActiveXObject)!="undefined"){return function(){return new ActiveXObject("Microsoft.XMLHTTP")}}}}();XmlRequest.prototype.send=function(b,a){this.request=this.create();if(this.request!=null){if(b!=null){this.request.onreadystatechange=mxUtils.bind(this,function(){if(this.isReady()){b(this);this.onreadystatechaange=null}})}this.request.open(this.method,this.url,this.async,this.username,this.password);this.setRequestHeaders(this.request,this.params);this.request.send(this.params)}};XmlRequest.prototype.setRequestHeaders=function(a,b){if(b!=null){a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}};
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Ext.ns("Jxstar");Jxstar.GridEvent=function(a){this.define=a;this.grid=null;this.audit0="0";this.audit1="1";this.audit2="2";this.audit6="6";this.audit_b="";this.audit_e="7";if(this.define.status){this.audit0=this.define.status.audit0;this.audit1=this.define.status.audit1;this.audit_b=this.define.status.audit_b;this.audit_e=this.define.status.audit_e}this.addEvents("beforecreate","beforesave","aftersave","beforedelete","afterdelete","beforeaudit","afteraudit","beforecopy","aftercopy","beforecustom","aftercustom","beforeimport","afterimport","beforeprint","afterprint","beforecheck");Jxstar.GridEvent.superclass.constructor.call(this,a)};(function(){Ext.extend(Jxstar.GridEvent,Ext.util.Observable,{myDestroy:function(){this.define=null;delete this.define;this.grid=null;delete this.grid},setPage:function(page){this.grid=page},openFun:function(funid){Jxstar.createNode(funid)},impType:function(){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}var rightTypeId=self.grid.rightTypeId;var rightGrid=self.grid.rightGrid;var selUserIds=self.grid.selUserIds;if(!rightGrid||!rightTypeId||!selUserIds){JxHint.alert(jx.event.noqxbg);return}var endcall=function(data){rightGrid.getStore().reload();self.grid.rightGrid=null;delete self.grid.rightGrid;self.grid.rightTypeId=null;delete self.grid.rightTypeId;self.grid.selUserIds=null;delete self.grid.selUserIds;var win=self.grid.findParentByType("window");if(win){win.close()}};var params="funid="+self.define.nodeid+"&userids="+selUserIds;for(var i=0;i<records.length;i++){params+="&keyid="+records[i].get(self.define.pkcol)}params+="&pagetype=imptype&eventcode=imptype&typeid="+rightTypeId;Request.postRequest(params,endcall)},customEvent:function(eventCode,notConfirm,notSelected){var records=JxUtil.getSelectRows(this.grid);if(!notSelected){if(!JxUtil.selected(records)){return}}if(this.fireEvent("beforecustom",this,eventCode)==false){return}var self=this;var hdcall=function(){var params="funid="+self.define.nodeid;if(!notSelected){for(var i=0;i<records.length;i++){params+="&keyid="+records[i].get(self.define.pkcol)}}params+="&pagetype=grid&eventcode="+eventCode;var endcall=function(data){if(self.grid.gridNode.param.substat){self.substat(self.grid)}self.fireEvent("aftercustom",self,data,eventCode);self.grid.getStore().reload()};Request.postRequest(params,endcall)};if(notConfirm&&(notConfirm=="1"||notConfirm==true)){hdcall()}else{Ext.Msg.confirm(jx.base.hint,jx.event.doyes,function(btn){if(btn=="yes"){hdcall()}})}},showForm:function(){var store=this.grid.getStore();var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selectone(records)){return}var items={define:this.define,grid:this.grid,record:records[0],store:store};if(this.define.isCloud){JxCloud.showForm(items)}else{Jxstar.showForm(items)}},showSubForm:function(){var self=this;var url=self.define.formpage;if(url==null||url.length==0){return}var store=this.grid.getStore();var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selectone(records)){return}Jxstar.openSubForm({filename:url,title:self.define.nodetitle,grid:self.grid,pagetype:"subform",parentNodeId:self.grid.gridNode.parentNodeId,record:records[0],store:store})},create:function(){var self=this;var store=this.grid.getStore();var items={define:self.define,grid:self.grid,record:null,store:store};if(self.define.isCloud){JxCloud.showForm(items)}else{Jxstar.showForm(items)}},subcreate:function(){var self=this;var store=this.grid.getStore();Jxstar.openSubForm({filename:self.define.formpage,title:self.define.nodetitle,grid:self.grid,pagetype:"subform",parentNodeId:self.grid.gridNode.parentNodeId,record:null,store:store})},checkAudit:function(auditval){if(Ext.isEmpty(auditval)){auditval=this.audit1}var records=JxUtil.getSelectRows(this.grid);for(var i=0;i<records.length;i++){var auditcol=this.define.auditcol;if(Ext.isEmpty(auditcol)){return false}var state=records[i].get(auditcol);if(Ext.isEmpty(state)){state=this.audit0}if(auditval==this.audit0){if(state!=this.audit1){JxHint.alert(jx.event.selaudit0);return true}}else{if(auditval==this.audit1){if(state!=this.audit0&&state!=this.audit6){JxHint.alert(jx.event.selaudit1);return true}}}}return false},del:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}if(this.checkAudit()){return}if(this.fireEvent("beforedelete",this,records)==false){return}var self=this;var hdcall=function(){var params="funid="+self.define.nodeid;for(var i=0;i<records.length;i++){params+="&keyid="+records[i].get(self.define.pkcol)}params+="&pagetype=grid&eventcode=delete";var endcall=function(data){if(self.grid.gridNode.param.substat){self.substat(self.grid)}self.fireEvent("afterdelete",self,data);self.grid.getStore().reload()};Request.postRequest(params,endcall)};Ext.Msg.confirm(jx.base.hint,jx.event.delyes,function(btn){if(btn=="yes"){hdcall()}})},audit:function(){var eas=Jxstar.systemVar.edit__audit__save||"0";var store=this.grid.getStore();var mrow=store.getModifiedRecords();if(eas=="1"&&this.grid.isXType("editorgrid")&&mrow.length>0){var fn=function(){this.baseAudit(this.audit1,"audit",true)};this.editSave(fn.createDelegate(this))}else{this.baseAudit(this.audit1,"audit")}},unaudit:function(){this.baseAudit(this.audit0,"unaudit")},auditBack:function(){if(Ext.isEmpty(this.audit_b)){JxHint.alert(jx.event.auditbe);return}this.baseAudit(this.audit_b,"audit_back")},auditCancel:function(){if(Ext.isEmpty(this.audit_e)){JxHint.alert(jx.event.auditee);return}this.baseAudit(this.audit_e,"audit_cancel")},baseAudit:function(auditval,eventcode,isdir){var store=this.grid.getStore();var mrow=store.getModifiedRecords();if(mrow.length>0){if(confirm(jx.event.saveyes)){this.editSave();return false}else{store.rejectChanges()}}var keyids=[];var cm=this.grid.getColumnModel();var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}if(JxAttach.checkGrid(this.grid)==false){return}if(JxUtil.validateGrid(this.grid)==false){return}if(Ext.isEmpty(eventcode)){eventcode="audit"}if(Ext.isEmpty(auditval)){auditval=this.audit1}if(this.checkAudit(auditval)){return}if(this.fireEvent("beforeaudit",this)==false){return}var self=this;var define=this.define;var hdcall=function(){var params="funid="+self.define.nodeid;for(var i=0;i<records.length;i++){params+="&keyid="+records[i].get(self.define.pkcol)}params+="&pagetype=grid&eventcode="+eventcode+"&auditvalue="+auditval;var endcall=function(data){self.fireEvent("afteraudit",self,data);self.grid.getStore().reload()};var errorcall=function(result){var extd=result.extData;if(extd&&extd.checkMsg){JxUtil.checkResult(extd)}else{var msg=result.message;if(msg.length==0){msg=jx.req.faild}JxHint.alert(msg)}};Request.postRequest(params,endcall,{errorcall:errorcall})};var shint="";if(auditval==self.audit0){shint=jx.event.auditno}else{if(auditval==self.audit_b){shint=jx.event.auditback}else{if(auditval==self.audit_e){shint=jx.event.auditcancel}else{shint=jx.event.audityes}}}var eas=Jxstar.systemVar.edit__audit__save||"0";if(eas=="1"&&eventcode=="audit"&&isdir){hdcall()}else{Ext.Msg.confirm(jx.base.hint,shint,function(btn){if(btn=="yes"){hdcall()}})}},editCreate:function(){var g=this.grid;var fkValue=g.fkValue||"";if(fkValue.length==0&&g.gridNode.pageType.indexOf("sub")>=0){var fpage=JxUtil.getParentForm(g,true);if(!fpage){JxHint.alert(jx.event.noform);return}else{var fn=this.editCreate.createDelegate(this);fpage.formNode.event.save(fn);return}}var record=this.createRecord();var store=g.getStore();g.stopEditing();store.insert(0,record);var col=JxUtil.getEditCol(g);g.startEditing(0,col);var sm=g.getSelectionModel();if(sm.selectRow){sm.selectFirstRow()}else{sm.select(0,col)}if(this.fireEvent("beforecreate",this)==false){return}},createRecord:function(){var cm=this.grid.getColumnModel();var store=this.grid.getStore();var record=new (store.reader.recordType)({});var cols=record.fields.keys;for(var i=0;i<cols.length;i++){var colobj=cm.getColumnById(cols[i]);var defaultval=(colobj)?colobj.defaultval:"";if(typeof defaultval=="string"&&defaultval.indexOf("fun_")==0){var val=eval("JxDefault."+defaultval.split("fun_")[1]);record.set(cols[i],val)}else{if(typeof defaultval=="undefined"){record.set(cols[i],"")}else{record.set(cols[i],defaultval)}}}return record},substat:function(subGrid){var params="funid=sysevent&pagetype=subgrid&eventcode=substat";var fkv=subGrid.fkValue?subGrid.fkValue:"";if(Ext.isEmpty(fkv)){return}params+="&fkValue="+fkv;var pfunId=subGrid.gridNode.parentNodeId;if(Ext.isEmpty(pfunId)){return}params+="&pfunid="+pfunId;var endcall=function(data){if(Ext.isEmpty(data)){return}var form=JxUtil.getParentForm(subGrid);if(!Ext.isEmpty(form)&&form.myRecord){var record=form.myRecord;Ext.iterate(data,function(key,value){form.oset(key,value);record.set(key,value)});record.commit()}else{var mGrid=JxUtil.getParentGrid(subGrid);if(mGrid){var records=JxUtil.getSelectRows(mGrid);if(records&&records.length>0){var record=records[0];Ext.iterate(data,function(key,value){record.set(key,value)});record.commit()}}}};Request.postRequest(params,endcall)},editDelete:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}if(this.checkAudit()){return}if(this.fireEvent("beforedelete",this,records)==false){return}var self=this;var pkcol=self.define.pkcol;var store=self.grid.getStore();var hdcall=function(){var keys="";for(var i=0;i<records.length;i++){var k=records[i].get(pkcol);if(k==null||k.length==0){store.remove(records[i])}else{keys+="&keyid="+records[i].get(pkcol)}}if(keys.length==0){return true}var params="funid="+self.define.nodeid+keys;params+="&pagetype=editgrid&eventcode=delete_eg";var endcall=function(data){if(self.grid.gridNode.param.substat){self.substat(self.grid)}self.fireEvent("afterdelete",self,data);self.grid.getStore().reload()};Request.postRequest(params,endcall)};Ext.Msg.confirm(jx.base.hint,jx.event.delyes,function(btn){if(btn=="yes"){hdcall()}})},editCopy:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}if(this.fireEvent("beforecopy",this)==false){return}var keys="";var pkcol=this.define.pkcol;for(var i=0;i<records.length;i++){keys+="&keyid="+records[i].get(pkcol)}var self=this;var hdcall=function(text){var params="funid="+self.define.nodeid;params+=keys+"&copynum="+text;var attr=self.grid.treeNodeAttr;if(attr){var parentId=attr.id;var levelCol=attr.node_level;params+="&parentId="+parentId+"&levelCol="+levelCol}params+="&pagetype=grid&eventcode=copy_eg";var endcall=function(data){if(self.grid.gridNode.param.substat){self.substat(self.grid)}self.fireEvent("aftercopy",self,data);self.grid.getStore().reload()};Request.postRequest(params,endcall)};Ext.MessageBox.prompt(jx.base.hint,jx.event.copynum,function(btn,text){if(btn!="ok"){return}if(text.length==0||isNaN(text)){JxHint.alert(jx.event.nocopynum);return}if(text<1){text="1"}hdcall(text)},null,null,"1")},editSave:function(auditcall){var cm=this.grid.getColumnModel();var store=this.grid.getStore();var mrow=store.getModifiedRecords();if(mrow.length==0){return}if(this.fireEvent("beforesave",this)==false){return}var keys="";var pkcol=this.define.pkcol;var self=this;for(var i=0,n=mrow.length;i<n;i++){var record=mrow[i];var fields=record.fields.keys;keys+="&keyid="+record.get(pkcol);for(var j=0;j<fields.length;j++){var name=fields[j];var value=record.data[name];if(value==null){value=""}var colIndex=cm.findColumnIndex(name);var rowIndex=store.indexOfId(record.id);var editor=cm.getCellEditor(colIndex,rowIndex);if(editor==null){continue}var field=editor.field;if(field!=null&&!field.validateValue(value)){JxHint.alert(jx.event.datavalid);self.grid.startEditing(rowIndex,colIndex);return}}}var params="funid="+this.define.nodeid;var fkn=this.grid.fkName;if(fkn&&fkn.length>0){var fkv=this.grid.fkValue?this.grid.fkValue:"";if(fkv.length==0){JxHint.alert(jx.event.nofkv);return}params+="&fkValue="+fkv}var pfunId=this.grid.gridNode.parentNodeId;if(!Ext.isEmpty(pfunId)){params+="&pfunid="+pfunId}var attr=self.grid.treeNodeAttr;if(attr){var parentId=attr.id;var levelCol=attr.node_level;params+="&parentId="+parentId+"&levelCol="+levelCol}params+=keys+"&pagetype=editgrid&eventcode=save_eg";Ext.each(mrow,function(item){params+="&"+Ext.urlEncode(item.data)});var self=this;var endcall=function(data){var w=0;for(var i=0,n=mrow.length;i<n;i++){var record=mrow[i];var k=record.get(pkcol);if(record&&Ext.isEmpty(k)&&data[w]){record.set(pkcol,data[w].keyid);self.grid.selectKeyId=data[w].keyid;w++}}var eas=Jxstar.systemVar.edit__audit__save||"0";if(eas=="1"&&auditcall&&typeof auditcall=="function"){var sm=self.grid.getSelectionModel();sm.selectRecords(mrow);store.commitChanges();Ext.Msg.confirm(jx.base.hint,jx.event.auditsave,function(btn){if(btn=="yes"){auditcall()}});return}store.commitChanges();if(self.grid.gridNode.param.substat){self.substat(self.grid)}self.fireEvent("aftersave",self,data);var fk=self.grid.fkValue;if(fk&&fk.length>=0&&self.grid.fkName){Jxstar.loadSubData(self.grid,fk)}else{self.grid.getStore().reload()}};Request.postRequest(params,endcall)},viewHtmlReport:function(){var self=this;var funid=self.define.nodeid;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selectone(records)){return}var keyid=records[0].get(self.define.pkcol);var viewReport=function(reportId){var pk=self.define.pkcol.replace("__",".");var whereSql=pk+" = ?";var title=self.define.nodetitle+"-"+jx.wf.form;var params="funid="+funid+"&reportId="+reportId+"&isCheck=true&printType=html&whereSql="+whereSql+"&whereValue="+keyid+"&whereType=string&user_id="+Jxstar.session.user_id;var url=Jxstar.path+"/report/html/htmlprint.jsp";window.tmp_print_title=title;window.tmp_print_params=params;window.open(url)};var hdCall=function(data){if(data==null||data.length==0){JxHint.alert(jx.event.funnwf);return}viewReport(data[0].report_id)};var params="funid=rpt_list&pagetype=grid&eventcode=checkrpt&selfunid="+funid+"&dataid="+keyid+"&repttype=form&wheresql=";Request.dataRequest(params,hdCall)},dataImport:function(){var self=this;if(this.fireEvent("beforeimport",this)==false){return}var routes=RuleData[self.define.nodeid];if(!routes||routes.length==0){JxHint.alert(jx.event.gridnsql);return false}var endcall=function(page,srcnode,win){var title=jx.base.imp+"--"+srcnode.nodetitle;if(win==null){win=new Ext.Window({tbar:tbar,title:title,layout:"fit",width:750,height:500,constrainHeader:true,resizable:true,border:false,modal:true,closeAction:"close",autoScroll:true,items:[page]});win.show()}else{win.setTitle(title);win.remove(0);win.add(page);win.doLayout()}};var tbar=null;if(routes.length>1){var items=[];var showSrcFun=function(radio){if(radio.getValue()=="0"){return}var srcId=radio.inputValue;var win=radio.findParentByType("window");if(win==null){return}for(var i=0,n=routes.length;i<n;i++){if(routes[i].srcNodeId==srcId){self.showImpGrid(routes[i],endcall,win);break}}};for(var i=0,n=routes.length;i<n;i++){var srcId=routes[i].srcNodeId;var srcnode=Jxstar.findNode(srcId);var srcName=srcnode?srcnode.nodetitle:srcId;var item={xtype:"radio",boxLabel:srcName,name:"impSrcNodeId",inputValue:srcId,handler:showSrcFun};if(i==0){item.checked=true}items[i]=item}tbar=new Ext.Toolbar({style:"border-bottom-width:1;height:48px;padding:12px 0;",items:items})}self.showImpGrid(routes[0],endcall)},showImpGrid:function(route,endcall,win){var self=this;var fkValue=self.grid.fkValue||"";if(fkValue.length==0&&self.grid.gridNode.pageType.indexOf("sub")>=0){var fpage=JxUtil.getParentForm(self.grid,true);if(!fpage){JxHint.alert(jx.event.noform);return}else{var fn=self.dataImport.createDelegate(self);fpage.formNode.event.save(fn);return}}var srcNodeId=route.srcNodeId;var layout=route.layout;var whereSql=route.whereSql||"";var whereType=route.whereType||"";var whereValue=route.whereValue||"";var impExtendParam="";if(whereSql.length>0){whereSql="("+whereSql+")"}if(whereSql.indexOf("{FKEYID}")>=0){whereSql=whereSql.replace("{FKEYID}","?");whereType=whereType.length==0?"string":"string;"+whereType;whereValue=whereValue.length==0?fkValue:fkValue+";"+whereValue}if(typeof self.dataImportParam=="function"){var options=self.dataImportParam(srcNodeId);if(!options){return}if(options.whereSql!=null&&options.whereSql.length>0){if(whereSql.length>0){whereSql+=" and ("+options.whereSql+")"}else{whereSql=options.whereSql}}if(options.whereType!=null&&options.whereType.length>0){if(whereType.length>0){whereType+=";"}whereType+=options.whereType}if(options.whereValue!=null&&options.whereValue.length>0){if(whereValue.length>0){whereValue+=";"}whereValue+=options.whereValue}if(options.extendParam!=null&&options.extendParam.length>0){impExtendParam=options.extendParam}}var loaddata=function(grid){JxUtil.delay(500,function(){if(typeof self.dataImportGrid=="function"){grid=self.dataImportGrid(grid,srcNodeId)}else{if(!grid.isXType("grid")){var tree=grid.getComponent(0).getComponent(0);if(tree.isXType("treepanel")){if(grid.getComponent(1).getComponent(0).isXType("grid")){grid=grid.getComponent(1).getComponent(0)}else{if(grid.getComponent(1).getComponent(0).isXType("tabpanel")){grid=grid.getComponent(1).getComponent(0).getComponent(0).getComponent(0)}else{JxHint.alert(jx.event.gridnt)}}}else{if(grid.isXType("tabpanel")){grid=grid.getComponent(0).getComponent(0)}else{grid=grid.getComponent(1).getComponent(0);if(!grid.isXType("grid")){grid=grid.getComponent(0).getComponent(0);if(!grid.isXType("grid")){JxHint.alert(jx.event.gridnt)}}}}}}grid.destParentId=fkValue;grid.destNodeId=self.define.nodeid;grid.destGrid=self.grid;grid.on("beforedestroy",function(gp){gp.destParentId=null;delete gp.destParentId;gp.destNodeId=null;delete gp.destNodeId;gp.destGrid=null;delete gp.destGrid;gp=null;return true});if(grid.isShow=="1"){Jxstar.loadData(grid,{where_sql:whereSql,where_value:whereValue,where_type:whereType})}else{grid.jxstarParam.old_wsql=whereSql||"";grid.jxstarParam.old_wtype=whereType||"";grid.jxstarParam.old_wvalue=whereValue||""}grid.impExtendParam=impExtendParam})};var srcnode=Jxstar.findNode(srcNodeId);if(layout==null||layout.length==0){layout=srcnode.gridpage}var hdcall=function(f){var pagetype="import";var page=f(srcnode,{pageType:pagetype});if(typeof page.showPage=="function"){page=page.showPage(pagetype)}endcall(page,srcnode,win);loaddata(page)};Request.loadJS(layout,hdcall)},imp:function(){var self=this;var tb=self.grid.getTopToolbar();var btn=JxUtil.getButton(tb,"import");if(!btn){return}var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}btn.disable();var keys="";var pkcol=self.define.pkcol;for(var i=0;i<records.length;i++){keys+="&keyid="+encodeURIComponent(records[i].get(pkcol))}var parentId=self.grid.destParentId;var destFunId=self.grid.destNodeId;var params="funid="+self.define.nodeid+"&destfunid="+destFunId+keys;params+="&parentId="+parentId+"&pagetype=import&eventcode=import";var extparam=self.grid.impExtendParam;if(extparam&&extparam.length>0){if(extparam.charAt(0)!="&"){extparam="&"+extparam}params+=extparam}var endcall=function(data){btn.enable();self.fireEvent("afterimport",self,{srcFunId:self.define.nodeid,destFunId:destFunId,data:data});self.grid.getStore().reload();var destGrid=self.grid.destGrid;if(destGrid!=null){if(destGrid.gridNode.param.substat){self.substat(destGrid)}var fk=destGrid.fkValue;if(fk&&fk.length>=0&&destGrid.fkName){Jxstar.loadSubData(destGrid,fk)}else{destGrid.getStore().reload()}}var win=self.grid.findParentByType("window");if(win){win.close()}};var errorcall=function(result){btn.enable();var msg=result.message;if(msg.length==0){msg=jx.req.faild}JxHint.alert(msg)};Request.postRequest(params,endcall,{errorcall:errorcall})},clearRecord:function(){this.grid.getSelectionModel().clearSelections();this.grid.fireEvent("rowclick",this.grid);this.grid.fireEvent("rowdblclick",this.grid)},selRecord:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}this.grid.fireEvent("rowclick",this.grid);this.grid.fireEvent("rowdblclick",this.grid)},addAttach:function(attachField){if(attachField!=null&&attachField.isXType&&attachField.isXType("button")){attachField=null}var dataId,dataFunId,dataField,tableName;var nodeid=this.define.nodeid;var isAttach=this.define.isAttach;if(nodeid=="sys_attach"||nodeid=="project_attach"||isAttach){dataId=this.grid.attachDataId||"";dataFunId=this.grid.attachFunId||"";dataField=attachField||""}else{var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selectone(records)){return}var pkcol=this.define.pkcol;dataId=records[0].get(pkcol);dataFunId=nodeid;dataField=attachField||"";tableName=this.define.tablename}if(dataId.length==0){JxHint.alert(jx.event.noup);return}if(dataFunId.length==0){JxHint.alert(jx.event.noupfun);return}var self=this;var formItems=[{xtype:"fileuploadfield",useType:"file",maxLength:200,fieldLabel:jx.event.selfile,name:attachField||"attach_path",labelSeparator:"*",buttonText:"",buttonCfg:{iconCls:"upload_icon"},listeners:{fileselected:function(f,path){var len=path.length;if(len>0){var pos=path.lastIndexOf("\\");if(pos>=0){path=path.substr(pos+1,len)}}queryForm.getForm().findField("attach_name").setValue(path)}}},{xtype:"hidden",fieldLabel:jx.event.upname,name:"attach_name",labelSeparator:"*",maxLength:200}];var formHeight=170;var comboType=this.grid.attachTypeCombo;if(comboType){if(typeof comboType=="function"){comboType=comboType()}formHeight=200;formItems.insert(0,comboType)}var queryForm=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",defaults:{anchor:"95%",allowBlank:false,msgTarget:"side"},items:formItems});var win=new Ext.Window({title:jx.event.uptitle,layout:"fit",width:400,height:formHeight,resizable:false,modal:true,closeAction:"close",items:[queryForm],buttons:[{text:jx.base.ok,handler:function(){var form=queryForm.getForm();if(!form.isValid()){return}var params="funid=sys_attach&pagetype=editgrid";params+="&attach_field="+dataField+"&dataid="+dataId+"&datafunid="+dataFunId;if(dataField&&dataField.length>0){params+="&eventcode=fcreate&table_name="+tableName}else{params+="&eventcode=create"}var attach_type=form.get("attach_type_combo");if(attach_type.length>0){params+="&attach_type="+attach_type}var hdCall=function(){win.close();if(nodeid=="sys_attach"||nodeid=="project_attach"||attachField||isAttach){self.grid.getStore().reload()}};Request.fileRequest(form,params,hdCall)}},{text:jx.base.cancel,handler:function(){win.close()}}]});win.show()},upload:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selectone(records)){return}var self=this,define=this.define;var keyid=records[0].get(define.pkcol);if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var editFile=define.editCheckFile||false;var audit0="0";if(define.status){audit0=define.status.audit0}var state=records[0].get(define.auditcol);if(state==null||state.length==0){state=audit0}var deled=(state==audit0||state=="6");if(state=="2"&&editFile){deled=true}var options={};if(typeof self.uploadWhereParam=="function"){options=self.uploadWhereParam()}else{options.where_sql="sys_attach.data_id = ? and sys_attach.table_name = ?";options.where_type="string;string";options.where_value=keyid+";"+define.tablename}var comboType=null;if(typeof self.grid.attachTypeCombo=="function"){comboType=self.grid.attachTypeCombo()}var hdcall=function(grid){grid.attachDataId=keyid;grid.attachFunId=define.nodeid;grid.attachDeled=deled;if(comboType){grid.attachTypeCombo=comboType}grid.on("beforedestroy",function(gp){gp.attachDataId=null;delete gp.attachDataId;gp.attachFunId=null;delete gp.attachFunId;gp.attachDeled=null;delete gp.attachDeled;gp.attachTypeCombo=null;delete gp.attachTypeCombo;gp=null;return true});Jxstar.loadData(grid,options)};var srcDefine=Jxstar.findNode("sys_attach");Jxstar.showData({filename:srcDefine.gridpage,title:srcDefine.nodetitle,pagetype:"editgrid",nodedefine:srcDefine,callback:hdcall})},expxls:function(){JxExport.showWindow(this.grid.gridNode)},pivotexp:function(){JxPivotExp.showWindow(this.grid.gridNode)},print:function(){JxPrint.showWindow(this.grid.gridNode)},agree:function(){if(this.fireEvent("beforecheck",this,"agree")==false){return}this.basecheck("Y")},chkback:function(){if(this.fireEvent("beforecheck",this,"back")==false){return}this.basecheck("E")},basecheck:function(checkType){var store=this.grid.getStore();var mrow=store.getModifiedRecords();if(mrow.length>0){if(confirm(jx.event.saveyes)){this.editSave();return false}else{store.rejectChanges()}}var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}var hdcall=function(){var params="funid=wf_assign&pagetype=chkgrid&eventcode=execheck&check_funid="+self.define.nodeid;for(var i=0;i<records.length;i++){params+="&keyid="+records[i].get(self.define.pkcol)}var checkDesc=jx.event.agree;if(checkType=="E"){checkDesc=jx.wf.advnew}params+="&check_type="+checkType+"&check_desc="+encodeURIComponent(checkDesc);var endcall=function(data){self.grid.getStore().reload();var xt=Ext.getCmp("x_main_tab_work");if(xt){JxPortalExt.contentTypes.portlet_work.refresh(xt.ownerCt)}};Request.postRequest(params,endcall)};var hintDesc=jx.event.agreeyes;if(checkType=="E"){hintDesc=jx.event.auditback}Ext.Msg.confirm(jx.base.hint,hintDesc,function(btn){if(btn=="yes"){hdcall()}})},check:function(){var store=this.grid.getStore();var mrow=store.getModifiedRecords();if(mrow.length>0){if(confirm(jx.event.saveyes)){this.editSave();return false}else{store.rejectChanges()}}var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selected(records)){return}JxUtil.myCheckGrid=this.grid;if(this.fireEvent("beforecheck",this,"check")==false){return}if(records.length>1){this.checkMore(records)}else{this.baseWf("check_work",false)}},checkMore:function(records){var self=this;var dataId=records[0].get(self.define.pkcol);var dataIds="";for(var i=0,n=records.length;i<n;i++){dataIds+=records[i].get(self.define.pkcol);if(i<n-1){dataIds+=","}}var appData={funId:self.define.nodeid,dataId:dataId,dataIds:dataIds};if(this.fireEvent("beforecheck",this,"checkmore",appData)==false){return}JxUtil.showCheckWindow(appData,"check_work")},showassign:function(){this.baseWf("check_work",true)},takecheck:function(){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selectone(records)){return}var pkcol=self.define.pkcol;var funId=self.define.nodeid;var hdcall=function(){var params="funid=wf_task&pagetype=chkgrid&eventcode=takecheck&check_funid="+funId;params+="&keyid="+records[0].get(pkcol);var checkType="K",checkDesc=String.format(jx.event.takedesc,JxDefault.getUserName());params+="&check_type="+checkType+"&check_desc="+encodeURIComponent(checkDesc);var endcall=function(data){self.grid.getStore().reload()};Request.postRequest(params,endcall)};Ext.Msg.confirm(jx.base.hint,jx.event.takeyes,function(btn){if(btn=="yes"){hdcall()}})},tocheck:function(){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selectone(records)){return}var pkcol=self.define.pkcol;var funId=self.define.nodeid;var params="funid=sysevent&eventcode=tocheck&check_funid="+funId;params+="&keyid="+records[0].get(pkcol);Request.postRequest(params,null)},showlist:function(){var dataId="";var records=JxUtil.getSelectRows(this.grid);if(records.length>0){var pkcol=this.define.pkcol;dataId=records[0].get(pkcol)||""}var funId=this.define.nodeid;var appData={funId:funId,dataId:dataId};JxUtil.showCheckWindow(appData,"check_list")},baseWf:function(fileName,hideForm){var funId=this.define.nodeid;this.showWorkFlow(funId,fileName,hideForm)},editLog:function(){var records=JxUtil.getSelectRows(this.grid);if(!JxUtil.selectone(records)){return}var pkcol=this.define.pkcol;var nodeid=this.define.nodeid;var keyid=records[0].get(pkcol);if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var options={};options.where_sql="(fun_id = ? and data_id = ?) or (pfun_id = ? and pdata_id = ?)";options.where_type="string;string;string;string";options.where_value=nodeid+";"+keyid+";"+nodeid+";"+keyid;var hdcall=function(grid){JxUtil.delay(500,function(){Jxstar.loadData(grid,options)})};var df=Jxstar.findNode("sys_log_edit");Jxstar.showData({filename:df.gridpage,title:df.nodetitle,pagetype:"editgrid",nodedefine:df,pagetype:"query",callback:hdcall})},showWorkFlow:function(funId,fileName,hideForm){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}var dataId=records[0].get(self.define.pkcol);var appData={funId:funId,dataId:dataId,hideForm:hideForm};JxUtil.showCheckWindow(appData,fileName)},showPicture:function(){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}var funId=self.define.nodeid;var url=Jxstar.path+"/commonAction.do?funid=sys_attach&pagetype=editgrid&eventcode=showpic&selfunid="+funId;url+="&dataType=json&user_id="+Jxstar.session.user_id;for(var i=0,n=records.length;i<n;i++){var keyid=records[i].get(self.define.pkcol);url+="&keyid="+keyid}var viewPicture=function(url){var tabPanel=self.grid.findParentByType("tabpanel");var shower=new ImageShower({parentCtl:tabPanel,url:url});var tab=shower.show();tabPanel.activate(tab)};viewPicture(url)},impExcel:function(imp_index){var impIndex="";if(Ext.isNumber(imp_index)||Ext.isString(imp_index)){impIndex=imp_index}var nodeid=this.define.nodeid;var queryForm=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",defaults:{anchor:"95%",allowBlank:false,msgTarget:"side"},items:[{xtype:"fileuploadfield",useType:"file",fieldLabel:jx.event.selfile,name:"import_file",buttonText:"",maxLength:200,buttonCfg:{iconCls:"upload_icon"}}]});var self=this;var win=new Ext.Window({title:"选择导入文件",layout:"fit",width:400,height:170,resizable:false,modal:true,closeAction:"close",items:[queryForm],buttons:[{text:"下载模板",handler:function(){var params="funid=imp_list&impFunId="+nodeid+"&pagetype=grid&eventcode=downtpl&impIndex="+impIndex;Request.fileDown(params)}},{text:jx.base.ok,handler:function(){var form=queryForm.getForm();if(!form.isValid()){return}var fkValue=self.grid.fkValue;var params="funid="+nodeid+"&pagetype=grid&eventcode=impexcel&fkValue="+fkValue+"&impFunId="+nodeid+"&impIndex="+impIndex;var hdCall=function(data){if(!Ext.isEmpty(data)&&!Ext.isEmpty(data.valueInfo)){JxHint.alert(data.valueInfo)}win.close();self.grid.getStore().reload();if(self.grid.gridNode.param.substat){self.substat(self.grid)}};Request.fileRequest(form,params,hdCall)}},{text:jx.base.cancel,handler:function(){win.close()}}]});win.show()},dirPrint:function(printMode,printScope,printType,reportId){if(!Ext.isString(printMode)){printMode="0"}printMode=printMode||"0";printScope=printScope||"select";printType=printType||"html";reportId=reportId||"";var pageNode=this.grid.gridNode;var funId=this.define.nodeid;JxPrint.exePrint(pageNode,funId,reportId,printType,printScope,printMode)},showPic:function(){var self=this;var records=JxUtil.getSelectRows(self.grid);if(!JxUtil.selected(records)){return}var pkcol=self.define.pkcol;var funId=self.define.nodeid;var tablename=self.define.tablename;var url=Jxstar.path+"/commonAction.do?funid="+funId+"&pagetype=grid&eventcode=showpic&tablename="+tablename;url+="&dataType=json&user_id="+Jxstar.session.user_id;for(var i=0,n=records.length;i<n;i++){var keyid=records[i].get(pkcol);url+="&keyid="+keyid}var tabid="funAttachImgs";var mainTab=Jxstar.sysMainTab;var tab=mainTab.getComponent(tabid);if(tab){mainTab.remove(tabid,true)}tab=mainTab.add({id:tabid,pagetype:"formpic",label:jx.base.showpic,border:false,layout:"fit",closable:true,iconCls:"function"});mainTab.activate(tab);var shower=new ImageShower({parentCtl:tab,url:url});shower.show()},refresh:function(){this.grid.getStore().reload()},labPrintOut:function(caseCode,modelNo){var me=this;var records=JxUtil.getSelectRows(me.grid);if(!JxUtil.selected(records)){return}var datas=[records.length];for(var i=0;i<records.length;i++){datas[i]=records[i].data}if(typeof JxLabPrint=="undefined"){JxUtil.loadJS("/public/layout/ux/lab_print.js",true)}var btn=JxUtil.getButton(me.grid.getTopToolbar(),"labprintout");var hdcall=function(data){if(Ext.isEmpty(data)){JxHint.alert(jx.event.gridpn);return}var dataNum=Jxstar.systemVar.labprint__bat__num||6;var pageNum=Math.floor(datas.length/dataNum);if(dataNum*pageNum<datas.length){pageNum=pageNum+1}if(data.length==1){for(var k=0;k<pageNum;k++){var codes=JxLabPrint.buildCodes_page(datas,data[0],k,dataNum);JxLabPrint.printBarCode(codes)}}else{var items=[];for(var i=0;i<data.length;i++){items[i]={text:data[i].model_name,data:data[i],handler:function(obj){var md=obj.initialConfig.data;for(var k=0;k<pageNum;k++){var codes=JxLabPrint.buildCodes_page(datas,md,k,dataNum);JxLabPrint.printBarCode(codes)}}}}var el=btn.getEl();if(!el){JxHint.alert(jx.event.gridnbl);return}var extMenu=new Ext.menu.Menu({items:items});extMenu.show(el)}};modelNo=modelNo||"";var params="funid=lab_case&eventcode=qrymodel&caseCode="+caseCode+"&modelNo="+modelNo;Request.postRequest(params,hdcall)},labPrint:function(caseCode,modelNo){var me=this;var records=JxUtil.getSelectRows(me.grid);if(!JxUtil.selected(records)){return}var datas=[records.length];for(var i=0;i<records.length;i++){datas[i]=records[i].data}if(typeof JxLabPrint=="undefined"){JxUtil.loadJS("/public/layout/ux/lab_print.js",true)}var btn=JxUtil.getButton(me.grid.getTopToolbar(),"labprint");var hdcall=function(data){if(Ext.isEmpty(data)){JxHint.alert(jx.event.gridpn);return}if(data.length==1){var codes=JxLabPrint.buildCodes(datas,data[0]);JxLabPrint.showPreView(codes)}else{var items=[];for(var i=0;i<data.length;i++){items[i]={text:data[i].model_name,data:data[i],handler:function(obj){var md=obj.initialConfig.data;var codes=JxLabPrint.buildCodes(datas,md);JxLabPrint.showPreView(codes)}}}var el=btn.getEl();if(!el){JxHint.alert(jx.event.gridnbl);return}var extMenu=new Ext.menu.Menu({items:items});extMenu.show(el)}};modelNo=modelNo||"";var params="funid=lab_case&eventcode=qrymodel&caseCode="+caseCode+"&modelNo="+modelNo;Request.postRequest(params,hdcall)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Ext.ns("Jxstar");Jxstar.FormEvent=function(a){this.define=a;this.page=null;this.form=null;this.audit0="0";this.audit1="1";this.audit2="2";this.audit3="3";this.audit5="5";this.audit6="6";this.audit_b="";this.audit_e="7";if(this.define.status){this.audit0=this.define.status.audit0;this.audit1=this.define.status.audit1;this.audit2=this.define.status.audit2;this.audit3=this.define.status.audit3;this.audit_b=this.define.status.audit_b;this.audit_e=this.define.status.audit_e}this.addEvents("beforecreate","aftercreate","beforesave","aftersave","beforedelete","afterdelete","beforeaudit","afteraudit","beforecopy","aftercopy","beforecustom","aftercustom","initother","beforeprint","afterprint","beforecheck");Jxstar.FormEvent.superclass.constructor.call(this,a)};(function(){Ext.extend(Jxstar.FormEvent,Ext.util.Observable,{myDestroy:function(){this.define=null;delete this.define;this.page=null;delete this.page;this.form=null;delete this.form},setPage:function(page){this.page=page;this.form=page.getForm()},customEvent:function(eventCode,notConfirm,notSelected){var keyid=this.getPkField().getValue();if(!notSelected){if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}}if(this.fireEvent("beforecustom",this,eventCode)==false){return}var self=this;var hdcall=function(){var endcall=function(data){self.fireEvent("aftercustom",self,data,eventCode)};var params="funid="+self.define.nodeid+"&keyid="+keyid;params+="&pagetype=form&eventcode="+eventCode;Request.postRequest(params,endcall)};if(notConfirm&&(notConfirm=="1"||notConfirm==true)){hdcall()}else{Ext.Msg.confirm(jx.base.hint,jx.event.doyes,function(btn){if(btn=="yes"){hdcall()}})}},initForm:function(ispop){var self=this;var record=self.form.myRecord;var toolBar=self.page.getTopToolbar();var formnode=self.page.formNode;if(record){var state=record.get(self.define.auditcol);if(state==null||state.length==0){state=self.audit0}var audit0=self.audit0,audit2=self.audit2,audit6=self.audit6;var pageType=self.page.formNode.pageType;if(pageType=="subform"){var parentGrid=JxUtil.getParentGrid(self.form.myGrid);if(!parentGrid){parentGrid=JxUtil.getParentForm(self.form.myGrid).myGrid}if(parentGrid){var records=parentGrid.getSelectionModel().getSelections();if(records.length>0){var pdef=parentGrid.gridNode.define;if(pdef.status){audit0=pdef.status.audit0;audit6=pdef.status.audit6}state=records[0].get(pdef.auditcol);if(state==null||state.length==0){state=audit0}}}}var dealEditState=function(){var noedit=(formnode.right.edit=="0");if(noedit||state!=null){var readOnly=noedit||(state!=audit0&&state!=audit6);JxUtil.disableButton(toolBar,readOnly);if(self.form.myGrid){var subdef=self.form.myGrid.gridNode.define;var subEdit=subdef.subChkEdit||false}if(pageType=="subform"&&subEdit&&state==audit2){var btn=JxUtil.getButton(toolBar,"save");if(btn.enable){btn.enable()}else{btn.disabled=false}}else{JxUtil.readOnlyForm(self.form,readOnly)}if(!noedit&&pageType=="form"){var createBtn=JxUtil.getButton(toolBar,"create");if(createBtn){createBtn.setDisabled(false)}var unaudit=JxUtil.getButton(toolBar,"unaudit");if(unaudit){unaudit.setDisabled(false)}}}};if(ispop==true){JxUtil.delay(500,function(){dealEditState()})}else{dealEditState()}}JxUtil.clearDirty(self.form);var nodeId=self.define.nodeid;var iswfld=Jxstar.systemVar.saas__wf__field||"0";var dataId=this.getPkField().getValue();if((state==self.audit2||state==self.audit5)&&formnode.pageType.indexOf("chk")>=0){if(iswfld=="1"){JxUtil.showCheckField(nodeId,dataId,self.form,"1")}else{JxUtil.showCheckEdit(nodeId,dataId,self.form)}}else{if(iswfld=="1"){var param=self.page.pageParam;if(param&&param.processid){JxUtil.showCheckField(param.nodeid,param.processid,self.form,"2")}else{var issa=Jxstar.systemVar.sys__saas__run||"0";if(issa=="1"){var b=(state==self.audit1||state==self.audit3);JxUtil.showCheckField(nodeId,dataId,self.form,"0",b)}}}}if(!Ext.isEmpty(dataId)){var images=self.page.findByType("imagefield");if(images&&images.length>0){Ext.each(images,function(item){var v=item.getValue();if(v.length==0){item.loadImage(Ext.BLANK_IMAGE_URL)}else{item.loadImage()}})}}var showtip=Jxstar.systemVar.edit__field__showtip||"0";if(showtip=="1"){JxUtil.delay(500,function(){JxUtil.fieldValueTip(self.page)})}if(Jxstar.systemVar.edit__check__flag=="1"){JxUtil.showAuditFlag(self)}self.fireEvent("initother",self);return self.initOther()},initOther:function(){},create:function(){var self=this;if(self.form.myRecord&&self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}}var record=self.createRecord();self.form.myRecord=record;self.form.loadRecord(record);self.form.clearInvalid();self.form.tmpKeyId=JxUtil.getTmpKeyId();JxUtil.readOnlyForm(self.form,false);var toolBar=self.page.getTopToolbar();JxUtil.disableButton(toolBar,false);var images=self.page.findByType("imagefield");if(images&&images.length>0){Ext.each(images,function(item){item.clearImage()})}if(Jxstar.systemVar.edit__check__flag=="1"){JxUtil.showAuditFlag(self)}if(self.fireEvent("beforecreate",self)==false){return}},createRecord:function(){var self=this;var fm=self.form;var record=null;var store=fm.myStore;if(store==null){record=self.newEmptyRecord()}else{record=new (store.reader.recordType)({})}var cols=record.fields.keys;for(var i=0;i<cols.length;i++){var field=fm.findField(cols[i]);if(field==null){continue}var defaultval=field.defaultval;if(typeof defaultval=="string"&&defaultval.indexOf("fun_")==0){var val=eval("JxDefault."+defaultval.split("fun_")[1]);record.set(cols[i],val)}else{if(typeof defaultval=="undefined"){if(cols[i]==self.define.auditcol){record.set(cols[i],self.audit0)}else{record.set(cols[i],"")}}else{record.set(cols[i],defaultval)}}}return record},newRecord:function(data){var record=this.newEmptyRecord();var cols=record.fields.keys;Ext.each(cols,function(f){record.set(f,data[f])});return record},newEmptyRecord:function(){var fields=[];var fm=this.form;fm.fieldItems().each(function(f){if(f.isFormField){var type=f.getXType();if(type=="datefield"){type="date"}else{if(type=="numberfield"){type="float"}else{type="string"}}var o={name:f.getName(),type:type};fields[fields.length]=o}});return new (Ext.data.Record.create(fields))()},del:function(){var self=this;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}if(this.checkAudit(self.audit1,"del")){return}if(this.fireEvent("beforedelete",this)==false){return}var hdcall=function(){var params="funid="+self.define.nodeid+"&keyid="+keyid;params+="&pagetype=form&eventcode=delete";var endcall=function(data){JxUtil.clearDirty(self.form);var record=self.form.myRecord;if(record!=null){var store=self.form.myStore;if(store!=null){store.remove(record)}}self.create();self.fireEvent("afterdelete",self,data)};Request.postRequest(params,endcall)};Ext.Msg.confirm(jx.base.hint,jx.event.delyes,function(btn){if(btn=="yes"){hdcall()}})},saveSub:function(mkey,isimp){var subfunid=this.define.subfunid;if(subfunid==null||subfunid.length==0){return}var ct=this.page;if(this.define.isFormTab){ct=this.page.findParentByType("tabpanel")}var subids=subfunid.split(",");var subpns=ct.findBy(function(c){if(c.getXType()=="editorgrid"&&c.gridNode){var funid=c.gridNode.nodeId;for(var i=0,n=subids.length;i<n;i++){if(funid==subids[i]){return true}}}return false});for(var i=0,n=subpns.length;i<n;i++){if(mkey){subpns[i].gridNode.page.fkValue=mkey}if(!isimp){subpns[i].gridNode.event.editSave()}}},save:function(impcall,auditcall){var self=this;if(this.checkAudit(self.audit1,"save")){return}if(this.fireEvent("beforesave",this)==false){return}var eventcode="save";var keyid=this.getPkField().getValue();if(keyid.length==0){eventcode="create"}if(eventcode=="save"&&!this.form.isDirty()){self.saveSub();if(auditcall&&typeof auditcall=="function"){var hs=jx.event.auditsave;if(!JxUtil.isModifyForm(this.page)){hs=jx.event.audityes}Ext.Msg.confirm(jx.base.hint,hs,function(btn){if(btn=="yes"){auditcall()}})}return}var params="funid="+this.define.nodeid+"&keyid="+keyid;params+=JxUtil.getFormValues(this.form,false);params+="&pagetype=form&eventcode="+eventcode;var mygrid=self.form.myGrid;if(mygrid!=null){var attr=mygrid.treeNodeAttr;if(attr){var parentId=attr.id;var levelCol=attr.node_level;params+="&parentId="+parentId+"&levelCol="+levelCol;if(typeof(levelCol)=="undefined"||levelCol=="undefined"){if(this.define.regtype=="treemain"){alert(jx.event.formop);return}}}}if(eventcode!=="create"){params+="&dirtyfields="+JxUtil.getDirtyFields(this.form)}else{params+="&tmpkeyid="+this.form.tmpKeyId}var fkv=this.form.fkValue?this.form.fkValue:"";params+="&fkValue="+fkv;var endcall=function(data){var mkey="";var record=self.form.myRecord;for(var key in data){var field,val=data[key];if(key=="keyid"){field=self.getPkField();if(field){field.osetValue(val)}mkey=val}else{key=key.replace(".","__");field=self.form.findField(key);if(field){field.osetValue(val)}}}if(eventcode=="create"){var fkn=self.form.fkName;if(fkv.length>0&&fkn&&fkn.length>0){self.form.findField(fkn).osetValue(fkv)}delete self.form.tmpKeyId}if(record!=null){self.form.updateRecord(record);record.commit();if(eventcode=="create"){var store=self.form.myStore;if(store!=null){store.insert(0,record);store.commitChanges()}var grid=self.form.myGrid;if(grid!=null){grid.getSelectionModel().selectFirstRow()}if(impcall&&typeof impcall=="function"){self.saveSub(mkey,true);JxUtil.delay(500,function(){impcall()})}else{self.saveSub(mkey)}}}if(eventcode=="save"){self.fireEvent("aftersave",self,data)}else{self.fireEvent("aftercreate",self,data)}JxUtil.clearDirty(self.form);if(eventcode=="save"){self.saveSub()}if(auditcall&&typeof auditcall=="function"){Ext.Msg.confirm(jx.base.hint,jx.event.auditsave,function(btn){if(btn=="yes"){auditcall()}})}};Request.postRequest(params,endcall)},checkAudit:function(auditval,srctype){var self=this;if(Ext.isEmpty(auditval)){auditval=self.audit1}if(Ext.isEmpty(srctype)){srctype="audit"}if(srctype!="del"){if(srctype=="save"){var chk=Jxstar.systemVar.edit__check__blank||"0";var valid=(chk=="1")?self.form.isValid():self.form.isValidBlank();if(!valid){JxHint.alert(jx.event.datavalid);return true}}if(srctype=="audit"&&!self.form.isValid()){JxHint.alert(jx.event.datavalid);return true}}var auditcol=self.define.auditcol;if(Ext.isEmpty(auditcol)){return false}var record=self.form.myRecord;var state=record.get(auditcol);if(Ext.isEmpty(state)){state=self.audit0}if(auditval==self.audit0){if(state!=self.audit1){JxHint.alert(jx.event.curaudit0);return true}}else{if(auditval==self.audit1){if(state!=self.audit0&&state!=self.audit2&&state!=self.audit5&&state!=self.audit6){JxHint.alert(jx.event.curaudit1);return true}}}return false},audit:function(){var s=Jxstar.systemVar.edit__audit__save||"0";if(s=="1"){var fn=function(){this.baseAudit(this.audit1,"audit")};this.save(null,fn.createDelegate(this))}else{this.baseAudit(this.audit1,"audit")}},unaudit:function(){this.baseAudit(this.audit0,"unaudit")},auditBack:function(){if(Ext.isEmpty(this.audit_b)){JxHint.alert(jx.event.auditbe);return}this.baseAudit(this.audit_b,"audit_back")},auditCancel:function(){if(Ext.isEmpty(this.audit_e)){JxHint.alert(jx.event.auditee);return}this.baseAudit(this.audit_e,"audit_cancel")},baseAudit:function(auditval,eventcode){var keyid=this.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var self=this;var record=self.form.myRecord;if(self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}else{return}}if(JxUtil.checkSubGrid(self.page)==false){return}if(JxAttach.checkAttach(self.page)==false){return}if(Ext.isEmpty(eventcode)){eventcode="audit"}if(Ext.isEmpty(auditval)){auditval=self.audit1}if(this.checkAudit(auditval)){return}if(this.fireEvent("beforeaudit",this)==false){return}var hdcall=function(){var params="funid="+self.define.nodeid+"&keyid="+keyid;params+="&pagetype=form&eventcode="+eventcode+"&auditvalue="+auditval;var endcall=function(data){if(!Ext.isEmpty(data)){Ext.iterate(data,function(key,value){record.set(key,value)});record.commit();self.form.loadRecord(record)}self.fireEvent("afteraudit",self,data);JxUtil.clearDirty(self.form);var readOnly=(auditval==self.audit1);JxUtil.readOnlyForm(self.form,readOnly);var toolBar=self.page.getTopToolbar();JxUtil.disableButton(toolBar,readOnly);var createBtn=JxUtil.getButton(toolBar,"create");if(createBtn){createBtn.setDisabled(false)}if(Jxstar.systemVar.edit__check__flag=="1"){JxUtil.showAuditFlag(self)}if(s=="1"){self.backGrid()}};var errorcall=function(result){var extd=result.extData;if(extd&&extd.checkMsg){JxUtil.checkResult(extd)}else{var msg=result.message;if(msg.length==0){msg=jx.req.faild}JxHint.alert(msg)}};Request.postRequest(params,endcall,{errorcall:errorcall})};var shint="";if(auditval==self.audit0){shint=jx.event.auditno}else{if(auditval==self.audit_b){shint=jx.event.auditback}else{if(auditval==self.audit_e){shint=jx.event.auditcancel}else{shint=jx.event.audityes}}}var s=Jxstar.systemVar.edit__audit__save||"0";if(s=="1"&&eventcode=="audit"){hdcall()}else{Ext.Msg.confirm(jx.base.hint,shint,function(btn){if(btn=="yes"){hdcall()}})}},viewHtmlReport:function(){var self=this;var funid=self.define.nodeid;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var viewReport=function(reportId){var pk=self.define.pkcol.replace("__",".");var whereSql=pk+" = ?";var title=self.define.nodetitle+"-"+jx.wf.form;var params="funid="+funid+"&reportId="+reportId+"&isCheck=true&printType=html&whereSql="+whereSql+"&whereValue="+keyid+"&whereType=string&user_id="+Jxstar.session.user_id;var url=Jxstar.path+"/report/html/htmlprint.jsp";window.tmp_print_title=title;window.tmp_print_params=params;window.open(url)};var hdCall=function(data){if(data==null||data.length==0){JxHint.alert(jx.event.funnwf);return}viewReport(data[0].report_id)};var params="funid=rpt_list&pagetype=grid&eventcode=checkrpt&selfunid="+funid+"&dataid="+keyid+"&repttype=form&wheresql=";Request.dataRequest(params,hdCall)},getPkField:function(){return this.form.findField(this.define.pkcol)},preRecord:function(){var self=this;var record=this.form.myRecord;if(record!=null){if(self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}}var store=this.form.myStore;if(store!=null){var index=store.indexOf(record);if(index>=1){var cunidx=index-1;record=store.getAt(cunidx);this.form.myRecord=record;this.form.loadRecord(record);var grid=this.form.myGrid;if(grid){grid.getSelectionModel().selectRow(cunidx);grid.fireEvent("rowclick",grid,cunidx)}self.initForm();return true}else{JxHint.alert(jx.event.firstrec)}}}return false},nextRecord:function(){var self=this;var record=self.form.myRecord;if(record!=null){if(self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}}var store=this.form.myStore;if(store!=null){var index=store.indexOf(record);if(index<0){index=0}if(index<store.getCount()-1){var cunidx=index+1;record=store.getAt(cunidx);this.form.myRecord=record;this.form.loadRecord(record);var grid=this.form.myGrid;if(grid){grid.getSelectionModel().selectRow(cunidx);grid.fireEvent("rowclick",grid,cunidx)}self.initForm();return true}else{JxHint.alert(jx.event.endrec)}}}return false},upload:function(){var keyid=this.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var self=this,define=this.define;var editFile=define.editCheckFile||false;var audit0="0";if(define.status){audit0=define.status.audit0}var state=self.form.get(define.auditcol);if(state==null||state.length==0){state=audit0}var deled=(state==audit0||state=="6");if(state=="2"&&editFile){deled=true}var options={};if(typeof this.uploadWhereParam=="function"){options=this.uploadWhereParam()}else{options.where_sql="sys_attach.data_id = ? and sys_attach.table_name = ?";options.where_type="string;string";options.where_value=keyid+";"+define.tablename}var hdcall=function(grid){grid.attachDataId=keyid;grid.attachFunId=define.nodeid;grid.attachDeled=deled;grid.on("beforedestroy",function(gp){gp.attachDataId=null;delete gp.attachDataId;gp.attachFunId=null;delete gp.attachFunId;gp.attachDeled=null;delete gp.attachDeled;gp=null;return true});Jxstar.loadData(grid,options)};var srcDefine=Jxstar.findNode("sys_attach");Jxstar.showData({filename:srcDefine.gridpage,title:srcDefine.nodetitle,pagetype:"editgrid",nodedefine:srcDefine,callback:hdcall})},print:function(){JxPrint.showWindow(this.page.formNode)},agree:function(){if(this.fireEvent("beforecheck",this,"agree")==false){return}this.basecheck("Y")},chkback:function(){if(this.fireEvent("beforecheck",this,"back")==false){return}this.basecheck("E")},basecheck:function(checkType){var self=this;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}if(self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}}var hdcall=function(){var params="funid=wf_assign&pagetype=chkgrid&eventcode=execheck&check_funid="+self.define.nodeid;params+="&keyid="+keyid;var checkDesc=jx.event.agree;if(checkType=="E"){checkDesc=jx.wf.advnew}params+="&check_type="+checkType+"&check_desc="+encodeURIComponent(checkDesc);var endcall=function(data){self.backGrid();var xt=Ext.getCmp("x_main_tab_work");if(xt){JxPortalExt.contentTypes.portlet_work.refresh(xt.ownerCt)}};Request.postRequest(params,endcall)};var hintDesc=jx.event.agreeyes;if(checkType=="E"){hintDesc=jx.event.auditback}Ext.Msg.confirm(jx.base.hint,hintDesc,function(btn){if(btn=="yes"){hdcall()}})},backGrid:function(){var me=this;var mygrid=me.form.myGrid;if(mygrid){var store=mygrid.getStore();store.reload();if(me.define.isCloud){var ct=JxCloud.apps[me.define.nodeid];var ly=ct.getLayout();ly.setActiveItem(0);ly.activeItem.doLayout()}else{var tab=me.page.findParentByType("tabpanel");if(tab){tab.activate(tab.getComponent(0))}}}},takecheck:function(){var self=this;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}var hdcall=function(){var params="funid=wf_assign&pagetype=chkgrid&eventcode=takecheck&check_funid="+self.define.nodeid;params+="&keyid="+keyid;var checkType="Y",checkDesc=String.format(jx.event.takedesc,JxDefault.getUserName());params+="&check_type="+checkType+"&check_desc="+encodeURIComponent(checkDesc);Request.postRequest(params,null)};Ext.Msg.confirm(jx.base.hint,jx.event.takeyes,function(btn){if(btn=="yes"){hdcall()}})},tocheck:function(){var self=this;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}var params="funid=sysevent&eventcode=tocheck&check_funid="+self.define.nodeid+"&keyid="+keyid;Request.postRequest(params,null)},check:function(){JxUtil.myCheckForm=this.page;if(this.fireEvent("beforecheck",this,"check")==false){return}this.baseWf("check_work",false)},showassign:function(){this.baseWf("check_work",true)},takecheck:function(){var self=this;var funId=self.define.nodeid;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}var hdcall=function(){var params="funid=wf_task&pagetype=chkgrid&eventcode=takecheck&check_funid="+funId+"&keyid="+keyid;var checkType="K",checkDesc=String.format(jx.event.takedesc,JxDefault.getUserName());params+="&check_type="+checkType+"&check_desc="+encodeURIComponent(checkDesc);var endcall=function(data){var grid=self.form.myGrid;if(grid){grid.getStore().reload();if(self.define.isCloud){var ct=JxCloud.apps[funId];var ly=ct.getLayout();ly.setActiveItem(0);ly.activeItem.doLayout()}}};Request.postRequest(params,endcall)};Ext.Msg.confirm(jx.base.hint,jx.event.takeyes,function(btn){if(btn=="yes"){hdcall()}})},baseWf:function(fileName,hideForm){var self=this;var keyid=self.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nokey);return}if(self.form.isDirty()){if(confirm(jx.event.saveyes)){self.save();return}}var funId=self.define.nodeid;var appData={funId:funId,dataId:keyid,hideForm:hideForm};JxUtil.showCheckWindow(appData,fileName)},editLog:function(){var nodeid=this.define.nodeid;var keyid=this.getPkField().getValue();if(keyid==null||keyid.length==0){JxHint.alert(jx.event.nosave);return}var options={};options.where_sql="(fun_id = ? and data_id = ?) or (pfun_id = ? and pdata_id = ?)";options.where_type="string;string;string;string";options.where_value=nodeid+";"+keyid+";"+nodeid+";"+keyid;var hdcall=function(grid){JxUtil.delay(500,function(){Jxstar.loadData(grid,options)})};var df=Jxstar.findNode("sys_log_edit");Jxstar.showData({filename:df.gridpage,title:df.nodetitle,pagetype:"editgrid",nodedefine:df,pagetype:"query",callback:hdcall})},dirPrint:function(printMode,printScope,printType,reportId){if(!Ext.isString(printMode)){printMode="0"}printMode=printMode||"0";printScope=printScope||"select";printType=printType||"html";reportId=reportId||"";var pageNode=this.page.formNode;var funId=this.define.nodeid;JxPrint.exePrint(pageNode,funId,reportId,printType,printScope,printMode)}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxExt={};(function(){var a=navigator.userAgent.toLowerCase();var b=function(){var c=/trident/;return c.test(a)};Ext.isTrident=b();JxExt.isIE=b()||Ext.isIE;JxExt.getIE=function(){var c=a.indexOf("msie ");if(c>=0){var f=a.substring(c,a.length).split(";");if(f[0]&&f[0].length>6){f=f[0].split(" ");var g=f[f.length-1];return parseInt(g)}}else{if(Ext.isTrident){c=a.indexOf("rv:");var f=a.substring(c,a.length).split(")");if(f[0]&&f[0].length>4){f=f[0].split(":");var g=f[f.length-1];return parseInt(g)}}}return -1};if(Ext.isTrident){var e=document.body||document.getElementsByTagName("body")[0];Ext.fly(e,"_internal").replaceClass("ext-gecko ext-gecko3","ext-ie")}window.HTMLElement=window.HTMLElement||Element;if(!("classList" in document.documentElement)){Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){var c=this;function f(g){return function(j){var i=c.className.split(/\s+/g),h=i.indexOf(j);g(i,h,j);c.className=i.join(" ")}}return{add:f(function(h,g,i){if(!~g){h.push(i)}}),remove:f(function(h,g){if(~g){h.splice(g,1)}}),toggle:f(function(h,g,i){if(~g){h.splice(g,1)}else{h.push(i)}}),contains:function(g){return !!~c.className.split(/\s+/g).indexOf(g)},item:function(g){return c.className.split(/\s+/g)[g]||null}}}})}var d=function(){var g=/[=][\s]*on/gi;var f=/(script)|(eval)|(frame)|(src)|(cookie)|(style)|(expression)/gi;var c=function(i){var h="";if(typeof i=="undefined"||i.length==0){return""}h=i.replace(g,"");h=h.replace(f,"");return h};Ext.form.Field.prototype.beforeBlur=function(){var h=this.getValue();if(typeof h=="string"){h=c(h);this.setValue(h)}}};setTimeout(function(){if(Jxstar.systemVar){var c=Jxstar.systemVar.page__filter__xss;if(c=="1"){d()}}},2000)})();Array.prototype.insert=function(a,c){if(a>=this.length){this[this.length]=c;return this}if(a<0){a=this.length+a}for(var b=this.length-1;b>=a;b--){this[b+1]=this[b]}this[a]=c;return this};Ext.Element.prototype.getAttribute=Ext.isIE?function(a,c){var e=this.dom;if(e.getAttribute(a)){return e.getAttribute(a)}if(e.getAttribute(c+":"+a)){return e.getAttribute(c+":"+a)}var b=typeof e[c+":"+a];if(["undefined","unknown"].indexOf(b)==-1){return e[c+":"+a]}return e[a]}:function(a,b){var c=this.dom;return c.getAttributeNS(b,a)||c.getAttribute(b+":"+a)||c.getAttribute(a)||c[a]};Ext.enableListenerCollection=true;Ext.urlEncode=function(f,d){var b,a=[],c=encodeURIComponent;Ext.iterate(f,function(e,g){b=Ext.isEmpty(g);Ext.each(b?e:g,function(h){a.push("&",c(e),"=",(!Ext.isEmpty(h)&&(h!=e||!b))?(Ext.isDate(h)?h.dateFormat("Y-m-d H:i:s"):c(h)):"")})});if(!d){a.shift();d=""}return d+a.join("")};Ext.Window.prototype.border=false;Ext.PagingToolbar.prototype.doLoad=function(d){var c={};var b=this.store.lastOptions;if(b&&b.params){c=b.params}var a=this.getParams();c[a.start]=d;c[a.limit]=this.pageSize;if(this.fireEvent("beforechange",this,c)!==false){this.store.load({params:c})}Jxstar.startNo=d};Ext.PagingToolbar.prototype.onLoad=function(a,c,h){var e=this.getParams();this.cursor=(h.params&&h.params[e.start])?h.params[e.start]:0;var g=this.getPageData(),b=g.activePage,f=g.pages;if(!this.rendered){this.dsLoaded=[a,c,h];this.fireEvent("change",this,g);return}this.afterTextItem.setText(String.format(this.afterPageText,g.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==f);this.last.setDisabled(b==f);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,g)};Ext.PagingToolbar.prototype.cls="x-pagebar";Ext.grid.RowNumberer.prototype.width=40;var rownumwidth=(Ext.isGecko)?39:41;Ext.grid.RowNumberer.prototype.css="width:"+rownumwidth+"px !important;";Ext.grid.GridView.prototype.getColumnStyle=function(b,d){var a=this.cm,f=a.config,c=d?f[b].hcss||"":f[b].css||"",e=f[b].align;c+=String.format("width: {0};",this.getColumnWidth(b));if(a.isHidden(b)){c+="display: none; "}if(e){c+=String.format("text-align: {0};",e)}return c};Ext.grid.GridView.prototype.onHeaderClick=function(b,a){if(this.headersDisabled||!this.cm.isSortable(a)){return}if(b.store.getModifiedRecords().length>0){return}b.stopEditing(true);b.store.sort(this.cm.getDataIndex(a))};Ext.grid.GridView.prototype.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>',"</td>");Ext.grid.PropertyGrid.prototype.initComponent=function(){this.customRenderers=this.customRenderers||{};this.customEditors=this.customEditors||{};this.lastEditRow=null;var b=new Ext.grid.PropertyStore(this);this.propStore=b;var a=new Ext.grid.PropertyColumnModel(this,b);this.addEvents("beforepropertychange","propertychange");this.cm=a;this.ds=b.store;Ext.grid.PropertyGrid.superclass.initComponent.call(this);this.mon(this.selModel,"beforecellselect",function(e,d,c){if(c===0){this.startEditing.defer(200,this,[d,1]);return false}},this)};Ext.tree.TreeLoader.prototype.handleResponse=function(e){this.transId=false;var c=e.argument;var g=c.node;var j=function(a,f){var m=f.queryParams;if(!m){return a}if(!f.total){return a}var n=m.start;var d=m.limit;var l=[];if(f.count<d){l=a.slice(n)}else{l=a.slice(n,n+d)}return l};if(g.myResults){e.responseData=j(g.myResults,g)}else{var b=this.treeDataFn;var h=Ext.decode(e.responseText);var i=h.data;if(i!=null){if(b){e.responseData=b(i,g)}else{if(i.total&&i.root){g.total=i.total||0;g.count=i.root.length;e.responseData=i.root}else{e.responseData=i}}}else{if(b){e.responseData=b(h,g)}else{e.responseData=h}}if(g.loadRemote===false){g.myResults=e.responseData;e.responseData=j(g.myResults,g)}}this.processResponse(e,g,c.callback,c.scope);this.fireEvent("load",this,g,e)};Ext.tree.TreeLoader.prototype.getParams=function(b){var a=Ext.apply({},this.baseParams),c=this.nodeParameter;c&&(a[c]=b.id);if(b.queryParams){a=Ext.apply(a,b.queryParams)}return a};Ext.tree.TreeLoader.prototype.requestData=function(c,d,b){if(this.fireEvent("beforeload",this,c,d)!==false){if(this.directFn){var a=this.getParams(c);a.push(this.processDirectResponse.createDelegate(this,[{callback:d,node:c,scope:b}],true));this.directFn.apply(window,a)}else{if(c.loadRemote===false&&c.myResults){this.handleResponse({responseData:c.myResults,responseText:null,argument:{callback:d,node:c,scope:b}})}else{this.transId=Ext.Ajax.request({timeout:this.timeout||100000,method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:d,node:c,scope:b},params:this.getParams(c)})}}}else{this.runCallback(d,b||c,[])}};Ext.form.BasicForm.prototype.set=function(b,d){var c=this.findField(b);if(c){var a=c.getValue();c.setValue(d);c.fireEvent("change",c,a,d)}return this};Ext.form.BasicForm.prototype.get=function(a){var b=this.findField(a);if(b){return b.getValue()}return""};Ext.form.BasicForm.prototype.getNum=function(a){var c="";var b=this.findField(a);if(b){c=b.getValue()}if(c==null||c.length==0){return 0}return parseFloat(c)};Ext.form.BasicForm.prototype.oset=function(b,d){var c=this.findField(b);if(c){var a=c.getValue();c.setValue(d);c.originalValue=d}return this};Ext.form.BasicForm.prototype.fieldItems=function(){var a=new Ext.util.MixedCollection(false,function(b){return b.getItemId()});this.items.each(function(b){if(b.isComposite){b.items.each(function(c){a.add(c.getItemId(),c)})}else{a.add(b.getItemId(),b)}});return a};Ext.form.BasicForm.prototype.isDirty=function(){var a=false;this.items.each(function(b){if(!Ext.isEmpty(b.name)&&b.isDirty()){a=true;return false}});return a};Ext.form.ComboBox.prototype.restrictHeight=function(){this.innerList.dom.style.height="";var c=this.innerList.dom,g=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,e=Math.max(c.clientHeight,c.offsetHeight,c.scrollHeight),a=this.getPosition()[1]-Ext.getBody().getScroll().top,i=Ext.lib.Dom.getViewHeight()-a-this.getSize().height,f=Math.max(a,i,this.minHeight||0)-this.list.shadowOffset-g-5;e=Math.min(e,f,this.maxHeight);if(Ext.isIE){var b=c.clientWidth,d=c.offsetWidth;if(b<d){e+=18}}else{e+=1}this.innerList.setHeight(e);this.list.beginUpdate();this.list.setHeight(e+g);this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));this.list.endUpdate()};Ext.form.ComboBox.prototype.getValue=function(){var a="";if(this.valueField){a=Ext.isDefined(this.value)?this.value:""}else{a=Ext.form.ComboBox.superclass.getValue.call(this)}if(a==jx.star.select){a="";this.value="";this.originalValue=""}return a};Ext.form.Checkbox.prototype.getValue=function(){if(this.rendered&&this.el){return this.el.dom.checked?"1":"0"}else{return this.checked?"1":"0"}};Ext.form.Checkbox.prototype.isDirty=function(){if(this.disabled||!this.rendered){return false}return String(this.getValue())!==String(this.originalValue)};Ext.form.RadioGroup.prototype.getValue=function(){var a="";this.eachItem(function(b){if(b.checked){a=b.inputValue;return false}});return a};Ext.form.CheckboxGroup.prototype.getValue=function(){var a="";this.eachItem(function(b){if(b.checked){a+=b.inputValue+","}});a=a.slice(0,a.length-1);return a};Ext.form.CheckboxGroup.prototype.setValueForItem=function(a){this.originalValue=a;a=String(a).split(",");this.eachItem(function(b){if(a.indexOf(b.inputValue)>-1){b.setValue(true)}else{b.setValue(false)}})};Ext.form.CheckboxGroup.prototype.isDirty=function(){if(this.disabled||!this.rendered){return false}return String(this.getValue())!==String(this.originalValue)};Ext.form.BasicForm.prototype.updateRecord=function(b){b.beginEdit();var a=b.fields,d,c;a.each(function(e){d=this.findField(e.name);if(d){c=d.getValue();if(typeof c!=undefined&&c.getGroupValue){c=c.getGroupValue()}b.set(e.name,c)}},this);b.endEdit();return this};Ext.form.Field.prototype.osetValue=function(a){this.setValue(a);this.originalValue=a};Ext.form.DateField.prototype.onSelect=function(b,c){if(Ext.isDate(c)){var a=new Date();c.setHours(a.getHours(),a.getMinutes(),a.getSeconds())}this.setValue(c);this.fireEvent("select",this,c);this.menu.hide()};Ext.form.DateField.prototype.parseDate=function(f){if(!f||Ext.isDate(f)){return f}if(!Ext.isEmpty(f)&&f.length==7&&this.format=="Y-m"){return Date.parseDate(f+"-01","Y-m-d")}var b=this.safeParse(f,this.format),c=this.altFormats,e=this.altFormatsArray;if(!b&&c){e=e||c.split("|");for(var d=0,a=e.length;d<a&&!b;d++){b=this.safeParse(f,e[d])}}return b},Ext.layout.FormLayout.prototype.labelSeparator="";Ext.form.NumberField.prototype.selectOnFocus=true;Ext.form.TextField.prototype.selectOnFocus=true;Ext.form.BasicForm.prototype.trackResetOnLoad=true;Ext.Component.prototype.stateful=false;Ext.Window.prototype.shadow=false;Ext.layout.MenuLayout.prototype.isValidParent=function(d,b){var a=d.el.up("li.x-menu-list-item",5);if(Ext.isEmpty(a)){return false}return a.dom.parentNode===(b.dom||b)};Ext.form.Field.prototype.setReadOnly=function(a){if(this.rendered&&this.el){this.el.dom.readOnly=a;if(a){this.el.addClass("x-field-only")}else{this.el.removeClass("x-field-only")}}this.readOnly=a};Ext.form.TriggerField.prototype.setReadOnly=function(a){if(a!=this.readOnly&&this.el){if(a){this.el.addClass("x-field-only")}else{this.el.removeClass("x-field-only")}this.readOnly=a;this.updateEditState()}};Ext.form.TriggerField.prototype.updateEditState=function(){if(this.rendered&&this.el){if(this.readOnly){this.el.dom.readOnly=true;this.el.addClass("x-field-only");this.el.addClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this);this.emptyText=""}else{if(!this.editable){this.el.dom.readOnly=true;this.el.addClass("x-trigger-noedit");this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.dom.readOnly=false;this.el.removeClass("x-field-only");this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}}}};Ext.form.DateField.prototype.onTriggerClick=function(){if(this.readOnly||this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on")};Ext.form.DateField.prototype.fieldClass="x-field-d";Ext.form.NumberField.prototype.fieldClass="x-field-n";Ext.EventObjectImpl.prototype.isSpecialKey=function(){var a=this.normalizeKey(this.keyCode);return(this.type=="keypress"&&this.ctrlKey)||this.isNavKeyPress()||(a==this.BACKSPACE)||(a>=16&&a<=20)||(a>=44&&a<=46)||(a>=112&&a<=123)};Ext.grid.RowSelectionModel.prototype.getEditor=Ext.emptyFn;Ext.data.Types.INT={convert:function(a){return a!==undefined&&a!==null&&a!==""?parseInt(String(a).replace(Ext.data.Types.stripRe,""),10):""},sortType:Ext.data.SortTypes.none,type:"int"};Ext.data.Types.FLOAT={convert:function(a){return a!==undefined&&a!==null&&a!==""?parseFloat(String(a).replace(Ext.data.Types.stripRe,""),10):""},sortType:Ext.data.SortTypes.none,type:"float"};Ext.data.Types.DATE={convert:function(b){var c=this.dateFormat;if(!b){return""}if(Ext.isDate(b)){return b}if(c){if(c=="timestamp"){return new Date(b*1000)}if(c=="time"){return new Date(parseInt(b,10))}return Date.parseDate(b,c)}else{if(Ext.isString(b)&&b.length==19){return Date.parseDate(b,"Y-m-d H:i:s")}}var a=Date.parse(b);return a?new Date(a):""},sortType:Ext.data.SortTypes.asDate,type:"date"};Ext.apply(Ext.form.VTypes,{time24:function(c,b){var a=/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9])$/i;return a.test(c)},time24Text:jx.base.timetext});Ext.data.Record.prototype.getNum=function(a){var b=this.data[a];if(b==null||b.length==0){return 0}return parseFloat(b)};Ext.data.Record.prototype.set=function(a,d){if(this.fields){var c=this.fields.get(a);if(c&&c.type.type=="date"){if(Ext.isString(d)&&d.length==19){d=Date.parseDate(d,"Y-m-d H:i:s")}}}var b=Ext.isPrimitive(d)?String:Ext.encode;if(b(this.data[a])==b(d)){return}this.dirty=true;if(!this.modified){this.modified={}}if(this.modified[a]===undefined){this.modified[a]=this.data[a]}this.data[a]=d;if(!this.editing){this.afterEdit()}};Ext.form.Hidden.prototype.setValue=function(a){if(!Ext.isEmpty(a)&&Ext.isDate(a)){a=a.dateFormat("Y-m-d H:i:s")}this.value=a;if(this.rendered){this.el.dom.value=(Ext.isEmpty(a)?"":a);this.validate()}return this};Ext.form.TextField.prototype.getErrors=function(a){var d=Ext.form.TextField.superclass.getErrors.apply(this,arguments);a=Ext.isDefined(a)?a:this.processValue(this.getRawValue());if(Ext.isFunction(this.validator)){var c=this.validator(a);if(c!==true){d.push(c)}}if(a.length<1||a===this.emptyText){if(this.allowBlank){return d}else{if(!this.isBlankCheck){d.push(this.blankText)}}}if(!this.isBlankCheck&&!this.allowBlank&&(a.length<1||a===this.emptyText)){d.push(this.blankText)}if(JxUtil.strlen(a)<this.minLength){d.push(String.format(this.minLengthText,this.minLength))}if(JxUtil.strlen(a)>this.maxLength){d.push(String.format(this.maxLengthText,this.maxLength))}if(this.vtype){var b=Ext.form.VTypes;if(!b[this.vtype](a,this)){d.push(this.vtypeText||b[this.vtype+"Text"])}}if(this.regex&&!this.regex.test(a)){d.push(this.regexText)}return d};Ext.form.BasicForm.prototype.isValidBlank=function(){var a=true;this.items.each(function(b){b.isBlankCheck=true;if(!b.validate()){a=false}delete b.isBlankCheck});return a};Ext.Container.prototype.getComponent=function(a){if(Ext.isObject(a)){a=a.getItemId()}if(this.items==null){return null}return this.items.get(a)};Ext.form.Field.prototype.afterRender=function(){Ext.form.Field.superclass.afterRender.call(this);this.initEvents();this.initValue();var b=function(h,o){if(h.getKey()==h.ENTER){var m=this;var j=m.findParentByType("form");if(Ext.isEmpty(j)){return}var l=j.form.items;var c=0,f=-1,g=-1,d=-1;l.each(function(e){if(e.isFormField&&e.rendered&&e.name&&!e.isXType("hidden")&&!e.isXType("textarea")){if(f<0){f=c}if(e.name==m.name){g=c}else{if(g>=0){d=c;return false}}}c++});if(g>=0&&d<0){d=f}if(d>=0){var n=l.get(d);if(n){n.focus(true)}}}};var a=Jxstar.systemVar.edit__field__next;if(a=="1"){this.mon(this.el,Ext.EventManager.getKeyEvent(),b,this)}};Ext.grid.RowSelectionModel.prototype.onEditorKey=function(n,l){var d=l.getKey(),f,h=this.grid,p=h.lastEdit,i=h.activeEditor,b=l.shiftKey,o,p,a,m;var j=(Jxstar.systemVar.edit__field__next=="1");if(h.isNextField!=null){j=h.isNextField}if(j){if(d==l.ENTER){if(b){f=h.walkCells(p.row,p.col-1,-1,this.acceptsNav,this)}else{f=h.walkCells(p.row,p.col+1,1,this.acceptsNav,this)}}else{if(d==l.TAB){l.stopEvent();i.completeEdit();if(this.moveEditorOnEnter!==false){if(b){f=h.walkCells(p.row-1,p.col,-1,this.acceptsNav,this)}else{f=h.walkCells(p.row+1,p.col,1,this.acceptsNav,this)}}}}}else{if(d==l.TAB){l.stopEvent();i.completeEdit();if(b){f=h.walkCells(i.row,i.col-1,-1,this.acceptsNav,this)}else{f=h.walkCells(i.row,i.col+1,1,this.acceptsNav,this)}}else{if(d==l.ENTER){if(this.moveEditorOnEnter!==false){if(b){f=h.walkCells(p.row-1,p.col,-1,this.acceptsNav,this)}else{f=h.walkCells(p.row+1,p.col,1,this.acceptsNav,this)}}}}}if(f){a=f[0];m=f[1];this.onEditorSelect(a,p.row);if(h.isEditor&&h.editing){o=h.activeEditor;if(o&&o.field.triggerBlur){o.field.triggerBlur()}}h.startEditing(a,m)}if(l.ctrlKey&&l.altKey&&i){i.completeEdit()}};Ext.Editor.prototype.onShow=function(){this.el.show();if(this.hideEl!==false){this.boundEl.hide()}if(Ext.isIE){this.field.show().focus(false,true)}else{this.field.show().focus(false,100)}this.fireEvent("startedit",this.boundEl,this.startValue)};Ext.ux.ToolbarKeyMap=Ext.extend(Object,(function(){var c,a,e;var d=function(f){if(c=f.keyBinding){delete f.keyBinding;if(!c.fn&&f.handler){c.fn=function(g,h){h.preventDefault();h.stopEvent();f.handler.call(f.scope,f,h)}}e.push(c)}if((f instanceof Ext.Button)&&f.menu){f.menu.cascade(d)}};var b=function(){delete this.onRender;if(a=this.ownerCt){e=[];this.cascade(d);if(!a.menuKeyMap){a.menuKeyMap=new Ext.KeyMap(a.el,e);a.el.dom.tabIndex=0}else{a.menuKeyMap.addBinding(e)}}};return{init:function(f){f.onRender=f.onRender.createSequence(b);f.doLayout=f.doLayout.createSequence(b)}}})());Ext.form.NumberField.prototype.parseValue=function(a){a=String(a).replace(/,/g,"");a=parseFloat(String(a).replace(this.decimalSeparator,"."));return isNaN(a)?"":a};Ext.form.NumberField.prototype.setValue=function(a){a=String(a).replace(/,/g,"");a=this.fixPrecision(a);a=Ext.isNumber(a)?a:parseFloat(String(a).replace(this.decimalSeparator,"."));a=isNaN(a)?"":String(a).replace(".",this.decimalSeparator);if(this.renderer){a=this.renderer(a)}return Ext.form.NumberField.superclass.setValue.call(this,a)};Ext.form.NumberField.prototype.getErrors=function(b){var c=Ext.form.NumberField.superclass.getErrors.apply(this,arguments);b=Ext.isDefined(b)?b:this.processValue(this.getRawValue());if(b.length<1){return c}b=String(b).replace(this.decimalSeparator,".");b=String(b).replace(/,/g,"");if(isNaN(b)){c.push(String.format(this.nanText,b))}var a=this.parseValue(b);if(a<this.minValue){c.push(String.format(this.minText,this.minValue))}if(a>this.maxValue){c.push(String.format(this.maxText,this.maxValue))}if(c&&c.length>0){this.setValue("")}return c};JxExt.bbsurl=function(b){var a="./fileAction.do?funid=sys_attach&pagetype=editgrid&eventcode=down&nousercheck=1&dataType=byte&keyid="+b;return a};JxExt.bbsfile=function(b){var c=document.getElementById("frmhidden");c.src=JxExt.bbsurl(b.id)};ImgHtmlEditor=Ext.extend(Ext.form.HtmlEditor,{enableAlignments:false,enableColors:false,enableFont:false,enableFontSize:false,enableFormat:false,enableLinks:false,enableLists:false,enableSourceEdit:true,addImage:function(l){var g=this;var c=g.findParentByType("form");if(Ext.isEmpty(c)){return}var a=c.getForm();var e=c.formNode.define;var j=e.nodeid;var i=e.tablename;var b=a.get(e.pkcol);var h=[{xtype:"fileuploadfield",useType:"file",maxLength:200,fieldLabel:jx.event.selfile,name:"attach_path",buttonText:"",buttonCfg:{iconCls:"upload_icon"},listeners:{fileselected:function(n,o){var m=o.length;if(m>0){var p=o.lastIndexOf("\\");if(p>=0){o=o.substr(p+1,m)}}d.getForm().findField("attach_name").setValue(o)}}},{xtype:"hidden",name:"attach_name"}];var d=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",defaults:{anchor:"95%",allowBlank:false,msgTarget:"side"},items:h});var f=new Ext.Window({title:jx.plet.text18,width:400,height:170,modal:true,closeAction:"close",items:[d],buttons:[{text:jx.bus.text48,type:"submit",handler:function(){var n=d.form;var o="funid=sys_attach&pagetype=editgrid";o+="&attach_field=&dataid="+b+"&datafunid="+j;o+="&eventcode=create";var m=function(q){if(Ext.isEmpty(q)){JxHint.alert(jx.util.attfa);return}var p;if(l=="1"){p='<div align="center"><img src="'+JxExt.bbsurl(q.attachId)+'" height="400" width="640"></div>'}else{p='<div style="padding:2px 30px"><a id="'+q.attachId+'" onclick="return JxExt.bbsfile(this);">'+n.get("attach_name")+"</a></div>"}g.focus();g.insertAtCursor(p);f.close()};Request.fileRequest(n,o,m)}},{text:jx.base.close,handler:function(){f.close()}}]});f.show()},createToolbar:function(a){ImgHtmlEditor.superclass.createToolbar.call(this,a);this.tb.insertButton(0,{iconCls:"fa-image blue",tooltip:jx.plet.text16,handler:function(){this.addImage("1")},scope:this});this.tb.insertButton(0,{iconCls:"fa-paperclip blue",tooltip:jx.plet.text17,handler:function(){this.addImage("0")},scope:this})},initEditor:function(){ImgHtmlEditor.superclass.initEditor.call(this);this.getDoc().body.style.lineHeight="28px"}});Ext.reg("imghtmleditor",ImgHtmlEditor);Ext.Window.prototype.show=function(c,a,b){if(window.LODOP_SHOW){window.LODOP_SHOW.style.visibility="hidden"}if(!this.rendered){this.render(Ext.getBody())}if(this.hidden===false){this.toFront();return this}if(this.fireEvent("beforeshow",this)===false){return this}if(a){this.on("show",a,b,{single:true})}this.hidden=false;if(Ext.isDefined(c)){this.setAnimateTarget(c)}this.beforeShow();if(this.animateTarget){this.animShow()}else{this.afterShow()}return this};Ext.Window.prototype.doClose=function(){if(window.LODOP_SHOW){window.LODOP_SHOW.style.visibility="visible"}this.fireEvent("close",this);this.destroy()};Ext.Button.buttonTemplate=new Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-mc"><em class="{2}" unselectable="on"><button type="{0}"></button></em></td></tr>',"</tbody></table>");Ext.Button.prototype.setIconClass=function(a){this.iconCls=a;if(this.el&&a){var d="x-fa fa "+a;var b=this.getText();if(!b||b.length==0){d="x-icon-only fa "+a;this.btnEl.update("")}this.btnEl.insertHtml("afterBegin",'<i class="'+d+'"></i>');this.setButtonClass()}return this};Ext.Panel.prototype.setIconClass=function(c){var e=(c=="x-tool-toggle");var b=this.iconCls;this.iconCls=c;if(this.rendered&&this.header){if(this.frame){this.header.addClass("x-panel-icon");this.header.replaceClass(b,this.iconCls)}else{var g=this.header,d;if(e){d=g.child("button.x-tool")}else{d=g.child("div.x-tool")}if(d){Ext.fly(d).replaceClass(b,this.iconCls)}else{var f=g.child("span."+this.headerTextCls);if(f&&(!e||(e&&this.collapsible))){var a={tag:"div",cls:"x-panel-inline-icon",html:"<i class='fa "+this.iconCls+"'></i>"};if(e){a={tag:"button",cls:"x-tool x-panel-inline-icon",html:"<i class='fa "+this.iconCls+"'></i>"}}var h=Ext.DomHelper.insertBefore(f.dom,a);if(e){Ext.get(h).on("mousedown",this.toggleCollapse,this);setTimeout(function(){var i=g.child("button.x-tool>i.toggle");if(i&&i.dom.parentNode){Ext.get(i.dom.parentNode).remove()}},500)}}}}}this.fireEvent("iconchange",this,c,b)};Ext.form.TriggerField.prototype.onRender=function(b,a){this.doc=Ext.isIE?Ext.getBody():Ext.getDoc();Ext.form.TriggerField.superclass.onRender.call(this,b,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-field-trigger-wrap"});this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"a",cls:"x-form-trigger",html:"<i class='fa "+this.triggerClass+"'></i>"});this.initTrigger();if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())}this.resizeEl=this.positionEl=this.wrap};Ext.Panel.prototype.toolTemplate=new Ext.XTemplate("<tpl if=\"id=='space1'\">",'<div class="x-tool-space">&#160;</div>',"</tpl>","<tpl if=\"id=='close'\">",'<button class="x-tool" type="button"><i class="fa x-tool-{id}"></i></button>',"</tpl>","<tpl if=\"(id!='space1' && id!='close')\">",'<button class="x-tool" type="button" righttype="{rightType}" eventcode="{eventCode}"><i class="fa {id}"></i></button>',"</tpl>");Ext.TabPanel.prototype.itemTpl=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></a>',"</li>");Ext.Panel.prototype.border=false;Ext.menu.Menu.prototype.shadow=false;(function(){var b=function(f){var d=f.getState();var n=f.colModel;var h=d.columns;var l="";if(h){for(var e=0,j=h.length;e<j;e++){var o=h[e];var m=n.getColumnById(o.id);if(m){if(!(m.dataIndex)||m.dataIndex.length==0){continue}l+="{";l+="n:"+m.dataIndex+",";l+="x:"+e+",";l+="w:"+o.width+",";l+="h:"+(o.hidden?"true":"false");l+="}-"}}if(h.length>0){l=l.substring(0,l.length-1)}}return l};var c=function(e){var m=e.split("-");var r,q,p,h=[m.length];for(var l=0,n=m.length;l<n;l++){r=m[l].substring(1,m[l].length-1);q=r.split(",");var f={};for(var g=0;g<q.length;g++){p=q[g];f[p.substr(0,1)]=p.substr(2,p.length-2)}h[l]=f}return h};var a=function(f,d){if(!f||!d){return}var j=c(d);var n=f.colModel,o,l,m;for(var e=0,h=j.length;e<h;e++){o=j[e];l=n.findColumnIndex(o.n);if(l>-1){n.setHidden(l,(o.h=="true"));n.setColumnWidth(l,parseInt(o.w));m=parseInt(o.x);if(m!=l){n.moveColumn(l,m)}}}};JxExt.gridStateEvent=function(f){var i=function(g){var j=f.gridNode;var l=j.nodeId+"@@"+j.pageType+"@@grid";if(g){l+="_old"}return l};var d=function(){var g=b(f);Ext.util.Cookies.set(i(),g,(new Date()).add(Date.MONTH,100))};f.on("columnmove",d);f.on("columnresize",d);var h="";var e=function(){var g=Ext.util.Cookies.get(i());if(g&&g.length>0){h=b(f);a(f,g)}};f.on("render",e);f.on("headerclick",function(p,m){var r=p.colModel.getColumnId(m);if(r!="numberer"){return}var q=function(){if(!p.locker){return[]}var z=p.getColumnModel().config;var A,w=[];w.push({text:"解锁列",handler:function(){var s=p.locker;if(!s){return}s.unlock()}},"-");var y=function(){var t=this.colid;var s=p.locker;if(!s){return}if(s.lockColId==t){return}s.unlock();s.lock(t)};for(var v=0,g=0;v<z.length;v++){A=z[v];if(A&&!A.hidden){g++;if(g>=3&&g<=6){var x=A.header.replace("*","");var u="锁定列-"+x;w.push({text:u,colid:A.id,handler:y})}}}w.push("-");return w};var o=p.getView().getHeaderCell(m);var l=Ext.get(o);if(!p.setmenu){var j=q();var n=[{text:"恢复列位置",handler:function(){Ext.util.Cookies.set(i(),"");Ext.util.Cookies.clear(i());if(h.length>0){a(p,h)}}}];j=j.concat(n);p.setmenu=new Ext.menu.Menu({items:j})}p.setmenu.showAt([l.getX()+15,l.getY()+30])})}})();GridLocker=function(b){this.grid=b.grid;this.lockBody=null;this.lockInner=null;this.scrollBar=null;this.locked=false;this.lockNum=0;this.lockColId=null;var c=b.grid;var a=function(h){var e=h.locker;if(e&&e.locked){var f=e.lockColId;e.unlock();e.lock(f)}};c.on("resize",a);c.getStore().on("load",function(){a(c)});var d=function(g,f){var e=this.locker;if(e&&e.locked){e.lockInner.scrollTo("top",f)}};c.on("bodyscroll",d)};GridLocker.prototype.getLockWidth=function(e){var a=0,g,b=0;var f=this.grid.getColumnModel().config;for(var d=0;d<f.length;d++){g=f[d];if(g.width&&!g.hidden){a+=g.width;b++}if(g.id==e){this.lockNum=b;return a}}};GridLocker.prototype.copyHead=function(o){var f=this.grid.getView().innerHd;var e=Ext.get(f).query("td.x-grid3-hd");if(e.length==0){return}var g=this.lockBody.child("tr.x-grid3-hd-row");var l=this.grid.getColumnModel().config;var m="",h,n=0;for(var d=0,b=0;b<o;d++){h=l[d];m+=e[d].outerHTML;if(h&&h.width&&!h.hidden){n+=h.width;b++}}g.update(m);var p=g.up("table",2);var a=this.lockBody.getWidth()-0.6;p.setWidth(a)};GridLocker.prototype.copyRow=function(){var c=this.grid.getView().mainBody;var a=c.dom.innerHTML;this.lockInner.update(a);var d=this.lockInner.dom.childNodes;for(var b=0;b<d.length;b++){d[b].rowIndex=b}};GridLocker.prototype.lock=function(c){if(this.locked){return}this.locked=true;this.lockColId=c;var x=this;var a=this.grid;var m=this.getLockWidth(c);if(!this.lockBody){var f=a.body;var s=['<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset">','<table style="table-layout: fixed;" cellspacing="0" cellpadding="0" border="0">','<thead><tr class="x-grid3-hd-row"></tr></thead>',"</table>","</div>","</div>","</div>",'<div class="x-grid3-body">',"</div>"];var n={tag:"div",cls:"x-grid3-lockdiv",html:s.join("")};var q=f.createChild(n);q.setHeight(a.body.getHeight());q.setWidth(m);this.lockBody=q;var i=this.lockBody.down("div.x-grid3-body");i.setHeight(a.body.getHeight()-53);this.lockInner=i;var l=a.getView();this.lockInner.on({mouseover:function(v,h){l.onRowOver(v,h)},mouseout:function(v,h){l.onRowOut(v,h)}});this.copyHead(this.lockNum);this.copyRow()}if(!this.scrollBar){var f=a.body;var s=['<div class="x-scroll-leftdiv">',"</div>",'<div class="x-scroll-rightdiv">','<div class="x-scroll-rightbar"></div>',"</div>"];var n={tag:"div",cls:"x-grid3-scrollbar",html:s.join("")};var b=f.createChild(n);var j=a.body.getWidth();var r=a.body.getHeight();b.setWidth(j);b.setTop((r-16)+"px");this.scrollBar=b;var e=b.down("div.x-scroll-leftdiv");e.setWidth(m);var t=b.down("div.x-scroll-rightdiv");var g=j-m;t.setWidth(g);var o=a.getView();var d=o.mainBody.getWidth()-m;var u=b.child("div.x-scroll-rightbar");if(g<d){u.setWidth(d);t.on("scroll",function(v){var h=t.dom.scrollLeft;o.scroller.scrollTo("left",h)})}}var p=this.grid.body.getScroll().top;this.lockInner.scrollTo("top",p)};GridLocker.prototype.unlock=function(){var a=this.grid;this.locked=false;this.lockNum=0;this.lockColId=null;this.lockInner=null;if(this.lockBody){this.lockBody.remove();this.lockBody=null}if(this.scrollBar){this.scrollBar.remove();this.scrollBar=null}};var _updateLockRowCls=function(c,e,f,b){var a=c.locker;if(a&&a.locked){var d=a.lockInner.dom.childNodes;Ext.fly(d[e])[f](b)}};Ext.grid.GridView.prototype.addRowClass=function(b,a){var c=this.getRow(b);if(c){this.fly(c).addClass(a);_updateLockRowCls(this.grid,b,"addClass",a)}};Ext.grid.GridView.prototype.removeRowClass=function(b,a){var c=this.getRow(b);if(c){this.fly(c).removeClass(a);_updateLockRowCls(this.grid,b,"removeClass",a)}}
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
;Ext.ns("Jxstar");(function(){Ext.apply(Jxstar,{pageSize:50,startNo:0,session:{},rightNodes:[],editor:null,systemVar:{},createNode:function(e,l){if(e==null||e.length==0){JxHint.alert(jx.star.noid);return false}var h=Jxstar.findNode(e);if(h==null){JxHint.alert(String.format(jx.star.nodef,e));return false}if(h.isOpenWin){var b="page.jsp?nodeid="+e;window.open(b);return}if(h.showType){l=Ext.apply(l||{},{showType:h.showType})}if(h.isfast){l=Ext.apply(l||{},{isfast:true})}var d=(l&&l.isNotRight=="1");var a=(l&&l.pageType&&l.pageType=="check");if(!a&&!d&&!Jxstar.validNode(e)){JxHint.alert(String.format(jx.star.noright,e));return false}var f=Jxstar.sysMainTab;var g=h.nodetitle;if(l&&l.funTitle){g=l.funTitle}var j=f.getComponent("fun_"+h.nodeid);if(a){g+=jx.base.check}if(j!=null){f.remove(j,true);j=null}var i=function(o){var n=o(h,l);if(!n){return}if(typeof n.showPage=="function"){l=l||{};n=n.showPage(l.pageType,l.parentNodeId)}var m=false;var p="fun_"+h.nodeid;j=f.add({id:p,label:g,border:m,layout:"fit",closable:true,autoScroll:true,items:[n],listeners:{beforedestroy:function(){n=null;j=null},destroy:function(){if(Ext.isIE){CollectGarbage()}}}});f.activate(j);if(n.isXType("grid")){if(l&&l.whereSql&&l.whereSql.length>0){Jxstar.loadData(n,{where_sql:l.whereSql,where_value:l.whereValue,where_type:l.whereType,is_query:l.isQuery,query_type:l.queryType||"0"})}else{Jxstar.loadInitData(n)}}n=null};var c=h.layout;if(c==null||c.length==0){c=h.gridpage}if(c==null||c.length==0||c.indexOf(".jsp")>-1){JxHint.alert(String.format(jx.star.nopage,e));return false}Request.loadJS(c,i)},createPage:function(f,a,e,c){if(f==null||f.length==0){JxHint.alert(jx.star.noid);return}var g=Jxstar.findNode(f);if(g==null){JxHint.alert(String.format(jx.star.nodef,f));return}var b=function(l){var j=l(g,c);if(typeof j.showPage=="function"){c=c||{};j=j.showPage(c.pageType,c.parentNodeId)}var i=c.layoutCall;if(i){i(j)}else{e.add(j);e.doLayout()}j.pageParam=c;var m=c.showCall;if(m){m(j)}if(j.isXType("grid")){if(c&&c.showType&&(c.showType=="form"||c.showType=="report")){var h=j.getStore();if(h==null){return}h.on("load",function(){if(j==null){return}var n=0;if(c.updateId!=null&&c.updateId.length>0){n=h.find(g.pkcol,c.updateId)}if(n<0){return true}j.getSelectionModel().selectRow(n);if(c.showType=="report"){j.gridNode.event.viewHtmlReport()}else{if(h.getCount()>0){j.gridNode.event.showForm()}}j=null})}if(c&&c.whereSql&&c.whereSql.length>0){Jxstar.loadData(j,{where_sql:c.whereSql,where_value:c.whereValue,where_type:c.whereType,is_query:c.isQuery,query_type:c.queryType||"0"})}else{if(c.pageType!="import"){Jxstar.loadInitData(j)}}}else{if(j.reload){j.reload()}}if(j.isXType("form")){j.doLayout()}};var d=g[a];if(d.length==0){JxHint.alert(String.format(jx.star.nopage,f));return false}Request.loadJS(d,b)},createTree:function(b,g,d,c,h){if(b==null||b.length==0){JxHint.alert(jx.star.notreeid);return}d=d||g.getComponent(0);c=c||g.getComponent(1);var a="10";var i=function(r,s,t){var o=Jxstar.path+"/commonAction.do?eventcode=query_tree&funid=queryevent";o+="&tree_funid="+b+"&user_id="+Jxstar.session.user_id;var m=new Ext.Toolbar();var u=new Ext.tree.TreePanel({teamid:(r)?s:"",tbar:(r)?null:m,border:false,autoScroll:true,rootVisible:false,lines:false,useArrows:false,loader:new Ext.tree.TreeLoader({dataUrl:o,listeners:{beforeload:function(v,w){v.baseParams.tree_no=w.attributes.tree_no||"";if(r){v.baseParams.team_id=s}}}}),root:new Ext.tree.AsyncTreeNode({id:a,iconCls:"tree_root_ext",text:jx.star.refresh})});u.on("load",function(w){if(w.id==a){var y=w.firstChild;if(!y){return}var v=y.attributes;var x=JxLang.otherText("treetitle",b+"__"+v.tree_no,v.tree_title);if(x.length>0){m.items.get(0).setText(x)}w.attributes.tree_no=v.tree_no;w.attributes.table_name=v.table_name;w.attributes.node_level=v.node_level;w.attributes.right_where=v.right_where;if(y.id=="10"){y.remove(true)}}});var n=function(){u.getLoader().load(u.getRootNode());u.fireEvent("click",u.getRootNode())};m.add({text:jx.star.refresh,cls:"x-btn x-btn-white",handler:n});var q=function(){var z=c.getComponent(0);var w=z;if(!z.isXType("grid")){var y=z.getComponent(0);if(y){w=y.getComponent(0)}}var v=u.getRootNode();var x=v.attributes;w.treeNodeAttr={id:"",text:"",node_level:x.node_level,tree_no:x.tree_no,table_name:x.table_name};w.cmpTree=u;u.on("click",function(C){if(u.hasCustClick){return}if(z.isXType("tabpanel")){z.activate(z.getComponent(0))}var F=Jxstar.findNode(b);if(F&&F.isCloud){var J=JxCloud.apps[b];if(J){var B=J.getLayout();B.setActiveItem(0);B.activeItem.doLayout()}}var M=null;if(h!=null&&typeof h=="function"){M=h(u,C,w)}var L=C.attributes;var I=L.id;var G=JxUtil.calTreeLevel(I)+1;var A="string";var K=I+"%";var O=L.right_where;if(O&&O.length>0){O="("+O+")"}var E=u.getTopToolbar();if(E){var H=E.find("xtype","checkbox");if(H.length>0){if(H[0].getValue()=="1"){K=I}}}if(O.indexOf("=")>=0){K=I}if(a==I){K="%"}if(O.indexOf("[tree_id]")>=0){var N=/\[tree_id\]/g;O=O.replace(N,K)}if(O.indexOf("?")<0){A="",K=""}if(M!=null){if(!Ext.isEmpty(M.where_sql)){O+=" and "+M.where_sql}if(!Ext.isEmpty(M.where_value)){K+=";"+M.where_value}if(!Ext.isEmpty(M.where_type)){A+=";"+M.where_type}}var D=w.gridNode?w.gridNode.define.regtype:"";if(D=="treemain"&&(L.tree_no=="1"||L.tree_no=="")){if(L.has_level=="1"&&G>1){O+=" and ("+L.node_level+" = ? or "+L.node_level+" = ?)";K+=";"+G+";"+(G-1);A+=";int;int"}else{}}if(A.charAt(0)==";"){A=A.substring(1,A.length);K=K.substring(1,K.length)}if(!w.jxstarParam){w.jxstarParam={}}w.jxstarParam.tree_wsql=O;w.jxstarParam.tree_wtype=A;w.jxstarParam.tree_wvalue=K;if(w.isXType("grid")){Jxstar.loadData(w,{where_sql:O,where_value:K,where_type:A,is_query:1})}else{if(w.isXType("treegrid")){JxTreeGrid.myQuery(w,[O,K,A],"0")}}w.treeNodeAttr=L});u.on("beforedestroy",function(){w=null;z=null;c=null})};var l=function(v){var y=v.getComponent(0);if(Ext.isEmpty(y)){return null}var w=y;if(!y.isXType("grid")){var x=y.getComponent(0);if(x){w=x.getComponent(0)}}return w};var p=function(){var v=l(c);if(Ext.isEmpty(v)){JxUtil.delay(500,p)}else{q()}};JxUtil.delay(1000,p);return u};var j;var f=function(q){if(Ext.isEmpty(q)){j=i(false);d.add(j);d.doLayout();return}var v=q.length>1;var t;if(v){var o=new Array();for(var r=0,m=q.length;r<m;r++){var w=b+"__"+q[r].team_id;var u=JxLang.otherText("treetitle",w,q[r].team_title);o[r]=[q[r].team_id,u]}var l=Jxstar.createCombo("sel_tree",o,130);var p=d.getTopToolbar();p.add(l);l.on("select",function(n){var x=n.value;t=null;d.items.each(function(y){if(y.teamid==x){t=y}});if(t){d.layout.setActiveItem(t.id)}});var s=function(){t.getLoader().load(t.getRootNode());t.fireEvent("click",t.getRootNode())};p.add("->",{text:"",iconCls:"x-tbar-loading",handler:s});d.layout=new Ext.Container.LAYOUTS.card}for(var r=0,m=q.length;r<m;r++){var w=b+"__"+q[r].team_id;var u=JxLang.otherText("treetitle",w,q[r].team_title);j=i(v,q[r].team_id,u);d.add(j);d.doLayout()}d.activeItem=0;t=d.getComponent(0)};var e=Jxstar.findNode(b);f(e.treeteam);return j},openSubForm:function(a){var b=function(e){var d=e();if(typeof d.showPage=="function"){d=d.showPage(a.pagetype||"form",a.parentNodeId)}var g=new Ext.Window({title:a.title,layout:"fit",width:a.width||800,height:a.height||500,constrainHeader:true,modal:true,border:false,closeAction:"close",autoScroll:true,items:[d]});g.show();if(a.store!=null){var c=d.getForm();c.myGrid=a.grid;c.myStore=a.store;if(a.record==null){d.formNode.event.create()}else{c.myRecord=a.record;c.loadRecord(a.record)}c.fkName=a.grid.fkName;c.fkValue=a.grid.fkValue;d.formNode.event.initForm(true)}};Request.loadJS(a.filename,b)},showForm:function(b){var c=b.grid.findParentByType("tabpanel");if(c==null){return}var d=c.getComponent(1);if(d==null){return}var a=d.getComponent(0);if(a==null||!a.isXType("form")){return}var e=a.getForm();e.myGrid=b.grid;e.myStore=b.store;e.fkName=b.grid.fkName;e.fkValue=b.grid.fkValue;e.srcEvent="create";if(b.record==null){a.formNode.event.create()}else{e.myRecord=b.record;e.loadRecord(b.record)}c.activate(d)},showData:function(a){var b=function(e){var d=e(a.nodedefine,{pageType:a.pagetype});if(typeof d.showPage=="function"){d=d.showPage(a.pagetype)}var c=a.modal;if(a.modal==null){c=true}var h={title:a.title,layout:"fit",width:a.width||800,height:a.height||500,constrainHeader:true,border:false,modal:c,closeAction:"close",autoScroll:true,items:[d]};if(a.wincfg){Ext.apply(h,a.wincfg)}var g=new Ext.Window(h);g.show();if(a.callback){a.callback(d)}};Request.loadJS(a.filename,b)},showQuery:function(a){var b=function(d){var e=JxSearch.queryWindow(d,a);var f=new Ext.Window({title:jx.star.hqry,layout:"fit",width:750,height:450,constrainHeader:true,resizable:false,modal:true,closeAction:"close",items:[e]});f.show()};var c="funid=queryevent&eventcode=cond_query";c+="&selfunid="+a.nodeId;Request.dataRequest(c,b)},queryData:function(c,a){if(c==null||c.length==0||a==null){JxHint.alert(jx.star.noparam);return false}var d="eventcode=query_data&funid=queryevent&query_funid="+c;d+="&where_sql="+a.where_sql||"";d+="&where_value="+a.where_value||"";d+="&where_type="+a.where_type||"";var b=function(e){if(a.callback){a.callback(e.root)}};Request.dataRequest(d,b)},loadSubData:function(d,b){if(d==null){return}if(!d.isXType("grid")){if(d.isXType("treegrid")){d.loadTreeData({dataId:b});return}else{JxHint.alert(jx.star.nosubgrid);return}}if(b==null||b.length==0){return}var a=d.fkName;if(a==null||a.length==0){JxHint.alert(jx.star.nofk);return false}a=a.replace("__",".");d.fkValue=b;var c=a+" = ?";var f={where_sql:c,where_value:b,where_type:"string"};if(d.subWhereSql){f.where_sql=d.subWhereSql()}if(d.subWhereParam){f=d.subWhereParam()}if(d.gridNode){var e=d.gridNode.parentNodeId;if(e&&e.length>0){f.parent_funid=e;f.parent_keyid=b}}Jxstar.loadData(d,f)},reload:function(a){a.getStore().load({params:{start:0,limit:Jxstar.pageSize}})},loadData:function(d,c){if(d==null||d.getStore()==null){return}var f=Jxstar.systemVar.page__where__pos||"end";if(c.is_query==null){d.jxstarParam.old_wsql=c.where_sql||"";d.jxstarParam.old_wtype=c.where_type||"";d.jxstarParam.old_wvalue=c.where_value||""}else{var b=d.jxstarParam.old_wsql;var h=d.jxstarParam.old_wtype;var e=d.jxstarParam.old_wvalue;if(b&&b.length>0){if(c.where_sql&&c.where_sql.length>0){if(f=="end"){c.where_sql="("+b+") and ("+c.where_sql+")"}else{c.where_sql="("+c.where_sql+") and ("+b+")"}}else{c.where_sql=b}}if(h&&h.length>0){if(c.where_type&&c.where_type.length>0){if(f=="end"){c.where_type=h+";"+c.where_type}else{c.where_type=c.where_type+";"+h}}else{c.where_type=h}}if(e&&e.length>0){if(c.where_value&&c.where_value.length>0){if(f=="end"){c.where_value=e+";"+c.where_value}else{c.where_value=c.where_value+";"+e}}else{c.where_value=e}}}var a=JxUtil.getPageSize(d);var g=Ext.apply({start:0,limit:a},c);d.getStore().load({params:g});SessionTimer.resetTimer()},loadInitData:function(c){if(c!=null&&c.isXType("grid")){var b=c.getStore();var d=c.pageType;if(b!=null&&c.isShow=="1"&&(d!="combogrid"&&d.indexOf("sub")<0)){var a=JxUtil.getPageSize(c);b.load({params:{start:0,limit:a}})}}SessionTimer.resetTimer()},loadDataBc:function(a){if(a==null||a.getStore()==null){return}var b=a.getStore().getCount();var c=a.getSelectionModel();var d=Jxstar.getSelectIndex(a);if(d>-1&&b>0&&typeof c.selectRow!="undefined"){c.selectRow(d);if(b>0&&a.pageType!="combogrid"){a.fireEvent("rowclick",a,d)}}Jxstar.viewSumData(a);JxAttach.viewAttachFlag(a)},getSelectIndex:function(d){if(d==null||d.getStore()==null){return 0}var e=d.selectKeyId||"";var f=-1,b=d.getStore();if(e.length>0){var a=d.gridNode.define.pkcol;var c=b.find(a,e);if(c>-1){f=c}}return f},viewSumData:function(b){var a=b.getStore().reader.jsonData.data.sum;if(a!=null&&a.length>0){if(b.jxsum){b.jxsum.refresh({data:a[0]})}else{var c=new Jxstar.JxSum();c.init(b);c.refresh({data:a[0]})}}},findNode:function(a){var b=NodeDefine[a];if(b==null){return{gridpage:"",formpage:""}}b.nodetitle=JxLang.funText(b.nodeid,b.nodetitle);return b},validNode:function(c){if(Jxstar.isone=="1"){return true}var a=this;if(JxUtil.isAdminUser()){return true}for(var b=0;b<a.rightNodes.length;b++){if(a.rightNodes[b]==c){return true}}return false},findComboData:function(b){var a=ComboData[b];if(a==null){a=[["",""]]}return a},createComboMenu:function(b){var a=new Ext.menu.Menu({width:450,height:350});a.parentField=b;return a},createCombo:function(d,a,c){var b=new Ext.form.ComboBox({name:d,store:new Ext.data.SimpleStore({fields:["value","text"],data:a}),emptyText:jx.star.select,mode:"local",triggerAction:"all",valueField:"value",displayField:"text",editable:false,width:c||80,value:a[0][0]});return b},simpleQuery:function(b,a){var c=b.page;var d=c.getTopToolbar();Jxstar.addBaseQry(b,d,a)},addBaseQry:function(l,d,s){var r=this;var f=l.page;var m=l.define.first;var t=["nofield"];var B="";var q=l.param.cols;if(m.length>0){m=m.replace(/\./g,"__");t=m.split(",")}for(var w=0;w<t.length;w++){for(var x=0,A=0,u=q.length;x<u;x++){var g=q[x].col,b=q[x].field;if(b==null||b.name.length==0){continue}if(b.type!="string"){continue}var y=g.header;if(y.charAt(0)=="*"){y=y.substr(1)}if(t[0]=="nofield"){B=y;m=b.name;break}else{if(t[w]==b.name||(b.name+"&").indexOf("__"+t[w]+"&")>0){B+=y;if(w<t.length-1){B+=", "}}}}}B=jx.cloud.text11+B;var e=JxUtil.newId()+"_fqv",v=e+"i",p=e+"x",z=e+"b";var y=(d.name)?27:30;d.add({xtype:"box",itemId:z,width:250,style:"position:relative;",html:'<input id="'+e+'" style="width:250px; padding-left:10px; padding-right:25px; border-radius: 5px !important; height:'+y+'px !important;" class="x-form-text x-form-field" type="text" placeholder="'+B+'" data-fields="'+m+'"></input><i id="'+v+'" class="ace-icon fa eb_query x-btn-qryi"></i>'});if(d.isXType("toolbar")){d.add({text:jx.cloud.text12,cls:"x-btn x-btn-qry",tooltip:jx.star.hqry,handler:function(){r.showQuery(l)}});d.add({xtype:"box",itemId:"qidx",width:20,hidden:true,html:'<i id="'+p+'" class="ace-icon fa eb_clear x-btn-qryx"></i>'})}d.doLayout();var a=function(){var c=d.getComponent("qidx");if(c&&c.el){c.el.on("click",function(){c.setVisible(false);delete f.qryCondData;Jxstar.myQuery(f)})}var h=Ext.get(e);if(h){h.on("keydown",function(n,j){if(n.getKey()==n.ENTER){o(m,h.dom.value);n.preventDefault();if(c){c.setVisible(false)}delete f.qryCondData}})}var i=Ext.get(v);if(i){i.on("click",function(n,j){o(m,h.dom.value);n.preventDefault()})}};if(d.el){a()}else{d.on("afterrender",function(){JxUtil.delay(500,a)})}var o=function(E,F){var D=d.find("name","xx_isarch")[0];var c="0";if(D&&D.getValue()=="1"){c="1"}var h=E.split(",").length;var n=E.replace(/,/g," like ? or ");n=n.replace(/__/g,".");n="("+n+" like ?)";var G="",C="";for(var j=0;j<h;j++){G+="%"+F+"%;";C+="string;"}C=C.substr(0,C.length-1);G=G.substr(0,G.length-1);if(!s){Jxstar.myQuery(f,[n,G,C],c)}else{JxTreeGrid.myQuery(f,[n,G,C],"1")}}},myQuery:function(d,f,a){if(f==null){f=new Array("","","")}if(a==null){a="0"}var b=d.jxstarParam.tree_wsql;var e=d.jxstarParam.tree_wtype;var c=d.jxstarParam.tree_wvalue;if(b&&b.length>0){if(f[0]&&f[0].length>0){f[0]=b+" and ("+f[0]+")"}else{f[0]=b}}if(c&&c.length>0){if(f[1]&&f[1].length>0){f[1]=c+";"+f[1]}else{f[1]=c}}if(e&&e.length>0){if(f[2]&&f[2].length>0){f[2]=e+";"+f[2]}else{f[2]=e}}Jxstar.loadData(d,{where_sql:f[0],where_value:f[1],where_type:f[2],is_query:1,query_type:a})}})})();
/*
 * Copyright 2011-2016 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.com
 */
Ext.ns("JxCloud");(function(){Ext.apply(JxCloud,{apps:{},showForm:function(a){var d=this;var g=a.define;var e=a.define.nodeid;var b=this.apps[e];if(!b){return}var f=function(i){var h=i.getForm();h.myGrid=a.grid;h.myStore=a.store;h.fkName=a.grid.fkName;h.fkValue=a.grid.fkValue;if(a.record==null){i.formNode.event.create()}else{h.myRecord=a.record;h.loadRecord(a.record)}if(a.record||!b.showType||(!a.record&&b.showType=="form")){JxUtil.delay(500,function(){i.formNode.event.initForm()})}i.doLayout()};if(b.items.getCount()==1){var c=function(i){if(g.isFormTab){var j=i.formNode.config.subTabHeader;var h=b.add(d.formMainTab(e,i,j));b.getLayout().setActiveItem(1);JxFormSub.formShowSub(i.formNode);f(i)}else{var h=b.add({pagetype:"funform",layout:"fit",border:false,items:[i]});b.getLayout().setActiveItem(1);f(i)}};if(g.formpage.length==0){return}Jxstar.createPage(e,"formpage",null,{pageType:"form",layoutCall:c})}else{b.getLayout().setActiveItem(1);if(g.isFormTab){page=b.getComponent(1).getComponent(0).getComponent(0)}else{page=b.getComponent(1).getComponent(0)}if(page){f(page)}}},setMainTab:function(a,b){var c=Jxstar.findNode(a);c.isFormTab=true;c.tabTitles=b},formMainTab:function(q,a,o){var b=Jxstar.findNode(q);var c=b.subfunid;if(c==null||c.length==0){return}var g=b.notTabFunId||"";var f=b.subExpand||false;var h=o||[];var l=c.split(",");for(var p=0,m=l.length;p<m;p++){var d=l[p];if(d.length==0){continue}if(g.length>0&&g.indexOf(d)>=0){continue}var u=Jxstar.findNode(d);var e=u.nodetitle;u.showInForm=true;var j=(p>0);if(f){j=false}var r={title:e,showType:"inform",baseCls:"xs-panel",data:d,cls:"sub_panel",border:false,layout:"fit",anchor:"100%",height:200,hideCollapseTool:true,collapsible:true,collapsed:j,style:"margin-right:5px;"};if(b.isCloud){u.isCloud=true;r.iconCls="x-tool-toggle"}h[h.length]=r}var t=b.tabTitles;if(!t||t.length<2){JxHint.alert(jx.cloud.text14);return}var s=this;return{pagetype:"funform",xtype:"tabpanel",activeTab:0,border:false,deferredRender:false,cls:"form-tab",items:[{title:t[0],pagetype:"formtab",autoScroll:true,items:[a]},{title:t[1],pagetype:"formsub",autoScroll:true,items:h}],listeners:{tabchange:function(n,v){var i=v.initialConfig.pagetype;if(i=="formsub"){a.formNode.event.initForm()}}}}},showTabTooler:function(d){var f=d.getTopToolbar();var c=f.el.up("div");var b=d.ownerCt.ownerCt;if(!b.isXType("tabpanel")){return}var a=b.header.child(".x-tab-strip-wrap");a.setHeight(59);var e=a.createChild({tag:"div",height:40,cls:"x-tab-toolbar pull-right ",html:""});e.insertFirst(c)},addTools:function(a){var e=this;var b=a.ownerCt;var d=a.gridNode;if(d.param.showTools){e.showPageBar(a,b);e.showPageTool(a,b,d);return}var f=d.event;e.showPageBar(a,b);var g="funid=queryevent&eventcode=query_loadtb&selpfunid="+d.parentNodeId;g+="&selfunid="+d.nodeId+"&selpagetype="+d.pageType;var c=function(B){if(B==null){return}var w=B.buttons;var D=B.right;var q=[],s=[];for(var z=0,x=w.length;z<x;z++){JxLang.eventLang(d.nodeId,w[z]);var y=w[z].showType;if(w[z].method.length>0){var A=f[w[z].method];if(A==null){continue}var E=w[z].args;if(w[z].method=="customEvent"){E=[w[z].eventCode]}w[z].scope=f;if(E!=null&&E.length>0){w[z].handler=A.createDelegate(f,E)}else{A=A.createInterceptor(function(h){return !(h.disabled)});w[z].handler=A}}if(y=="menu"){s[s.length]=w[z]}else{var j=w[z].iconCls;if(j.indexOf("eb_")==0){var o=JxUtil.getRule("."+j+"::before");w[z].id=o?j:"eb_empty"}else{w[z].id=j}w[z].qtip=w[z].text;q[q.length]=w[z]}}q=q.concat([{id:"space1",hidden:(s.length==0)},{id:"x-tool-prev",qtip:"上一页",hidden:true,handler:function(n,i,h){a.pagebar.movePrevious()}},{id:"x-tool-next",qtip:"下一页",hidden:true,handler:function(n,i,h){a.pagebar.moveNext()}}]);if(s.length>1){var m=new Ext.menu.Menu({items:s});q[q.length]={id:"eb_more",qtip:jx.cloud.text13,menu:m,handler:function(i,h){m.show(h)}}}else{if(s.length==1){var C=s[0];var j=C.iconCls||"";if(j.indexOf("eb_")==0){var o=JxUtil.getRule("."+j+"::before");C.id=o?j:"eb_empty"}else{C.id=j}C.qtip=C.text;q[q.length]=C}}var r=function(F,n){var G=JxUtil.newId()+"_qv";var h=F.insertFirst({tag:"div",style:"height:27px;width:250px;float:right;"});var i=new Ext.Container({renderTo:h,name:G,layout:"fit"});Jxstar.addBaseQry(n,i)};var p=b.ownerCt.getXType();if(p=="tabpanel"){var u=d.nodeId;var l=b.ownerCt;var t=l.header.child(".x-tab-strip-wrap");var v=t.createChild({tag:"div",cls:"x-tab-toolbar "+u,html:""});if(!b.isVisible()){v.hide()}b.tabtooler=v;if(d.param.hasQuery==true){r(v,d)}e.tabTools(a,v,q)}else{if(d.param.hasQuery==true){r(b.header,d)}b.addTool.apply(b,q)}};Request.dataRequest(g,c)},showPageBar:function(b,c){var d=b.gridNode.param.pageSize||20;var a=new Ext.PagingToolbar({store:b.getStore(),displayInfo:false,pageSize:d,hidden:true,ct:c,listeners:{change:function(v,o){var i=v.ct;var l=i.header;if(!l){l=i.tabtooler;if(!l){return}}var m=l.child("i.x-tool-prev");var h=l.child("i.x-tool-next");var r=(o.pages>1);if(m){m.up("button").setVisible(r)}if(h){h.up("button").setVisible(r)}if(m){m.up("button").dom.disabled=(v.cursor==0)}if(h){h.up("button").dom.disabled=((v.cursor+v.pageSize)>=o.total)}var g=l.child("span.xs-panel-header-text");if(!g){var p=c.findParentByType("tabpanel");if(p){var j=p.header.child("ul.x-tab-strip");var q=p.items.indexOf(c);var u=j.query("li");if(u.length>=q){var e=Ext.get(u[q]);g=e.child("span.x-tab-strip-text")}}}if(g){var f=g.child("em");if(f){f.remove()}var s=(o.total==0)?"default":"primary";g.insertHtml("beforeEnd",'<em class="text-'+s+'" style="display:inline;">&nbsp;('+o.total+")</em>")}}}});b.pagebar=a;b.on("destroy",function(){a.destroy();delete b.pagebar})},showPageTool:function(j,b,e){var g=this;var f=[{id:"x-tool-prev",qtip:"上一页",hidden:true,handler:function(n,m,l){j.pagebar.movePrevious()}},{id:"x-tool-next",qtip:"下一页",hidden:true,handler:function(n,m,l){j.pagebar.moveNext()}}];var h=b.ownerCt.getXType();if(h=="tabpanel"){var a=e.nodeId;var d=b.ownerCt;var c=d.header.child(".x-tab-strip-wrap");var i=c.createChild({tag:"div",cls:"x-tab-toolbar "+a,html:""});if(!b.isVisible()){i.hide()}b.tabtooler=i;g.tabTools(j,i,f)}else{b.addTool.apply(b,f)}},tabTools:function(b,g,h){var e=Ext.Panel.prototype.toolTemplate;var j=function(n,a,i){return function(o){if(a.stopEvent!==false){o.stopEvent()}if(a.handler){a.handler.call(a.scope||n,o,n,i,a)}}};for(var d=0,l=h,f=l.length;d<f;d++){var c=l[d];var m=e.insertFirst(g,c,true);m.enableDisplayMode("block");b.mon(m,"click",j(m,c,b));if(c.hidden){m.hide()}if(c.qtip){if(Ext.isObject(c.qtip)){Ext.QuickTips.register(Ext.apply({target:m.id},c.qtip))}else{m.dom.qtip=c.qtip}}}}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxWfGraph={};Ext.apply(JxWfGraph,{editor:null,graphId:"",queryValue:null,isFlag:false,showGraphFun:function(c,f,d,h){var m=this;var e=Jxstar.sysMainTab;var a="wfnav_graph_fun_tab";var l=e.getComponent(a);var j=h||"流程导航图";if(l==null){l=e.add({id:a,label:j,border:false,layout:"fit",closable:true,autoScroll:false,iconCls:"function"})}else{l.setTitle(j);var i=Jxstar.funMainTab.getTab(a);var b=i.child("span",true);var g=b.innerHTML;if(g&&g.length>10){g=g.split("</i>")[0]+"</i>"+j;b.innerHTML=g}}e.activate(l);m.createGraph(l,c,f,d)},createGraph:function(f,a,g,e){var d=this;d.graphId=a;d.queryValue=g||{};d.isFlag=e||false;var c=f.getComponent(0);if(c==null){var b="wfnav_graph_tab";var h=['<div id="mx_graph_show_nav" style="height:100%;width:100%;background-color:white;overflow:none;">','<center id="mx_splash" style="padding-top:230px;">','<img src="lib/graph/images/loading.gif">',"</center>","</div>"];c=new Ext.Panel({id:b,border:false,layout:"fit",iconCls:"nav_flow",html:h.join("")});f.add(c);f.doLayout();c.on("destroy",function(){if(d.editor!=null){d.editor.destroy();mxClient.dispose();d.editor=null}});d.createEdit()}d.readDesign()},isTask:function(a){if(a==null){return false}var b=new mxCodec();var d=b.encode(a);var c=d.getAttribute("nodetype");if(c=="task"){return true}return false},getTaskId:function(a){if(a==null){return""}var b=new mxCodec();var d=b.encode(a);var c=d.getAttribute("nodetype");if(c=="task"){return d.getAttribute("id")}return""},createEdit:function(){var b=this;JxUtil.loadJxGraph();b.editor=new mxCanvas("lib/graph/config/showeditor_nav.xml");var c=b.editor.graph;c.setCellsEditable(false);c.setCellsSelectable(false);c.setConnectable(false);c.setCellsMovable(false);var a=new mxCellTracker(c);a.mouseMove=function(e,f){var d=this.getCell(f);if(d&&b.isTask(d)){f.getState().setCursor("pointer");if(this.cur_cell==null){this.cur_cell=d;b.moveNode(d,true)}}else{b.moveNode(this.cur_cell,false);this.cur_cell=null}};c.addListener(mxEvent.CLICK,function(f,e){var d=e.getProperty("cell");var g=b.getTaskId(d);if(g.length>0){b.clickCell(b.graphId,g)}})},clickCell:function(a,e){var b=this;var c=function(g){if(g==null||g.fun_id==null){JxHint.alert(jx.util.wfnn);return}var f=g.fun_id;if(!Ext.isEmpty(f)){if(!Jxstar.validNode(f)){JxHint.alert(String.format(jx.star.noright,f));return false}if(!Ext.isEmpty(g.where_sql)){var h={};h.whereSql=g.where_sql;h.whereValue=JxUtil.parseWhereValue(g.where_value,b.queryValue);h.whereType=g.where_type;h.isQuery="1";Jxstar.createNode(f,h)}else{Jxstar.createNode(f)}}};var d="funid=wfnav_graph&eventcode=querynode&pagetype=formdes";d+="&graph_id="+a+"&node_id="+e;Request.dataRequest(d,c)},readDesign:function(){var a=this;var b=function(d){if(d==null||d.length==0){JxHint.alert(jx.util.wfnds);return}var e=mxUtils.parseXml(d);var f=new mxCodec(e);f.decode(e.documentElement,a.editor.graph.getModel());a.queryFlag();a.disableFlag()};var c="funid=wfnav_graph&eventcode=readdesign&pagetype=formdes";c+="&graph_id="+a.graphId;Request.dataRequest(c,b,{type:"xml",wait:true})},queryFlag:function(){var b=this;if(!b.isFlag){return}var c=function(h){if(h==null||h.length==0){JxHint.alert(jx.util.wfnodes);return}for(var f=0,j=h.length;f<j;f++){var e=h[f].cnt;var g=h[f].node_id;if(e>0){b.flagCurNode(g)}}};var a="";if(!Ext.isEmpty(b.queryValue)){a=encodeURIComponent(Ext.urlEncode(b.queryValue))}var d="funid=wfnav_graph&eventcode=queryflag&pagetype=formdes";d+="&graph_id="+b.graphId+"&datavalue="+a;Request.dataRequest(d,c)},disableFlag:function(){var a=this;var b=function(e){var d=a.editor.graph.getModel();Ext.iterate(e,function(g){var f=d.getCell(g.node_id);if(!Jxstar.validNode(g.fun_id)){a.disableNode(f)}});Ext.iterate(d.cells,function(h,f){if(f.is_disabled){return}var g=false;Ext.iterate(e,function(i){if(h==i.node_id){g=true;return}});if(!g&&a.isTask(f)){a.disableNode(f)}})};var c="funid=wfnav_graph&eventcode=queryfun&pagetype=formdes";c+="&graph_id="+a.graphId;Request.dataRequest(c,b)},flagCurNode:function(c){var a=this;var b=a.editor.graph.getModel();var d=b.getCell(c);b.beginUpdate();try{a.editor.graph.setCellStyles("strokeWidth","1",[d]);a.editor.graph.setCellStyles("strokeColor","red",[d]);a.editor.graph.setCellStyles("fillColor","#BB0000",[d])}finally{b.endUpdate()}},disableNode:function(a){var b=this;var c=b.editor.graph.getModel();c.beginUpdate();try{b.editor.graph.setCellStyles("strokeColor","#ECECEC",[a]);b.editor.graph.setCellStyles("fillColor","#BBBBBB",[a]);a.is_disabled=true}finally{c.endUpdate()}},moveNode:function(a,d){if(a==null){return}if(a.is_disabled){return}var b=this;var c=b.editor.graph.getModel();c.beginUpdate();try{b.editor.graph.setCellStyles("strokeColor",d?"#A1A1FF":"#87CEFA",[a]);b.editor.graph.setCellStyles("fillColor",d?"#A1A1FF":"#87CEFA",[a])}finally{c.endUpdate()}}});
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxLabelPrint={};(function(){var a=function(f){if(Ext.isIE==false){JxHint.alert(jx.util.labnie);return}var d=function(i){var g="";var h=function(l){if(l==null){return}if(l.nodeType==1||l.nodeType==2){g+="<"+l.nodeName+">"}if(l.attributes){for(j=0;j<l.attributes.length;j++){format=(j>0)?" ":":";g+=(format+l.attributes[j].nodeName+"="+l.attributes[j].text)}}if(l.hasChildNodes&&l.firstChild.nodeType!=3){for(var j=0;j<l.childNodes.length;j++){arguments.callee(l.childNodes[j]);if(j==l.childNodes.length-1){g+="</"+l.nodeName+">"}}}else{g+=l.text;g+="</"+l.nodeName+">";return}};h(i);return g};var e=new ActiveXObject("Msxml2.DOMDocument");e.async=false;e.load(f);root=e.documentElement;return d(root)};var b=function(d,q,r){var g=JxUtil.getSelectRows(d);if(!JxUtil.selected(g)){return}var o="";for(var l=0,e=g.length;l<e;l++){o+="<print>";for(var h=0,f=r.length;h<f;h++){var p=g[l].get(q+"__"+r[h]);p=Ext.isDate(p)?p.dateFormat("Y-m-d"):p;o+="<"+r[h]+">"+p+"</"+r[h]+">"}o+="</print>##"}if(o.length>2){o=o.substr(0,o.length-2)}return o};var c=function(){var e=Ext.get("printcodectl");if(Ext.isEmpty(e)){var d='<object id="printcodectl" classid="clsid:7EDC7219-8CEE-451f-9C21-98C812DD8CAE" width="0" height="0" codebase="ysbarprintExe.exe"></object>';e=Ext.getBody().insertHtml("beforeEnd",d,true)}return e.dom};Ext.apply(JxLabelPrint,{print:function(d,j,f,l,n,e,i){if(Ext.isIE==false){JxHint.alert(jx.util.labnie);return}var m=a(j);var h=a(f);if(Ext.isEmpty(m)||Ext.isEmpty(h)){JxHint.alert(jx.util.labnset);return}var g=b(d,l,n);if(e=="1"){c().printviewByXml(m,h,g)}else{c().printByXml(m,h,g)}},printCtl:function(){if(Ext.isIE==false){JxHint.alert(jx.util.labnie);return}return c()}})})();
/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
JxPivotExp={};(function(){Ext.apply(JxPivotExp,{funId:"",charFields:[],listField:null,listColumn:null,listRow:null,listValue:null,selStatId:"",statGrid:null,fieldRender:{},init:function(p){this.funId=p.nodeId;this.charFields=[];var q=[],j=p.param.cols;var l=0;for(var d=0,a=j.length;d<a;d++){var o=j[d].col,g=j[d].field;if(o==null||g==null){continue}var m=g.name,f=m.length;if(o&&g&&(m.substring(f-2)!="id")){var e=o.header;if(e.charAt(0)=="*"){e=e.substr(1)}var b=[g.name,e];this.charFields[l++]=b}if(o.renderer&&g.type!="float"){this.fieldRender[g.name]=o.renderer}}},showWindow:function(c){var b=this;b.funid=c.nodeId;b.init(c);var a=b.listFieldCt();var f=b.listPivotCt();var e=[{text:"保存方案",iconCls:"eb_save",handler:b.saveCase.createDelegate(b),cls:"x-btn-white"},"->",{text:jx.group.stat,iconCls:"eb_chart",handler:b.exeStat.createDelegate(b,[c])}];var d=new Ext.Panel({layout:"border",items:[a,f],buttonCls:"",buttonAlign:"left",buttons:e});var h=new Ext.Window({title:"数据透视统计",layout:"border",width:600,height:600,constrainHeader:true,resizable:false,modal:true,closeAction:"close",items:[{xtype:"container",region:"west",layout:"fit",width:160,split:true,margins:"2 0 2 2"},{xtype:"container",region:"center",layout:"fit",margins:"2 2 2 0",items:[d]}]});var g=function(j){b.statGrid=j;j.on("rowclick",function(o,q,p){var l=o.getStore().getAt(q);if(l==null){return false}var m=l.get("sys_stat__stat_id");b.clickCase(m)});j.getStore().on("load",function(l){if(j.selectKeyId==null||j.selectKeyId.length==0){j.getSelectionModel().selectFirstRow();j.fireEvent("rowclick",j,0)}});j.gridNode.event.on("afterdelete",function(){b.createCase();j.selectKeyId=""});var i={where_sql:"stat_type = '2' and fun_id = ? and (is_share = '1' or user_id = ?)",where_value:b.funid+";"+JxDefault.getUserId(),where_type:"string;string"};Jxstar.loadData(j,i)};Jxstar.createPage("sys_stat","gridpage",h.getComponent(0),{pageType:"notool",showCall:g});h.on("destroy",function(){if(b.statGrid!=null){b.statGrid.destroy()}b.funId="";b.charFields=null;b.numFields=null;b.charLists=null;b.numLists=null;b.selStatId="";b.statGrid=null});h.show();return h},addDragDrop:function(c,a){var b=new Ext.dd.DragSource(c,{group:"target_list"});b.afterDragDrop=function(h,g,j){var d=this.id.split("_")[1];var i=a.getById(d);if(j=="target_list_value"){var f=new Ext.data.Record({text:"求和 - "+i.get("text"),value:i.get("value"),coluse:"sum"});Ext.getCmp(j).getStore().add(f)}else{i.set("coluse",(j=="target_list_column")?"col":"row");Ext.getCmp(j).getStore().add(i);a.remove(i)}}},listFieldCt:function(){var b=this;var c=new Ext.data.ArrayStore({data:b.charFields||[],fields:["value","text","coluse"]});var a=new Ext.ListView({region:"west",split:true,width:200,store:c,disableHeaders:true,style:"background-color:#fff;",columns:[{header:"字段列表 -- 拖到右边",dataIndex:"text"}],listeners:{afterrender:function(d){var e=d.getStore();for(var f=0;f<e.getCount();f++){var g=d.getNode(f);g.id="rec_"+e.getAt(f).id;b.addDragDrop(g,e)}}}});b.listField=a;return a},listPivotCt:function(){var i=this;var b=function(j,n){var l=j.getStore();var p=l.getAt(n);if(j.id!="target_list_value"){var m=i.listField.getStore();m.add(p);var o=i.listField.getNode(p);o.id="rec_"+p.id;i.addDragDrop(o,m)}l.removeAt(n)};var g=new Ext.data.ArrayStore({data:[],fields:["value","text","coluse"]});var d=new Ext.ListView({id:"target_list_column",region:"north",height:180,store:g,disableHeaders:true,style:"background-color:#fff;",columns:[{header:"列标签 -- 双击取消",dataIndex:"text"}],listeners:{dblclick:b}});new Ext.dd.DDTarget(d.id,"target_list");var c=new Ext.data.ArrayStore({data:[],fields:["value","text","coluse"]});var f=new Ext.ListView({id:"target_list_row",region:"center",store:c,disableHeaders:true,style:"background-color:#fff;",columns:[{header:"行标签 -- 双击取消",dataIndex:"text"}],listeners:{dblclick:b}});new Ext.dd.DDTarget(f.id,"target_list");var a=new Ext.data.ArrayStore({data:[],fields:["value","text","coluse"]});var e=new Ext.ListView({id:"target_list_value",region:"south",height:150,store:a,disableHeaders:true,style:"background-color:#fff;",columns:[{header:"数值 -- 双击取消、右击修改公式",dataIndex:"text"}],listeners:{dblclick:b,contextmenu:function(p,n,l){var r=p.getStore();i.listValue.selectRec=r.getAt(n);var j=i.listValue.menu;if(!j){var o=[];var q=ComboData.pivotformula;for(var m=0;m<q.length;m++){var s={data:q[m][0],text:q[m][1],handler:function(v){var u=v.initialConfig.data;var t=v.initialConfig.text;var x=i.listValue.selectRec;var w=t+" - "+x.get("text").split(" - ")[1];x.set("text",w);x.set("coluse",u)}};o.push(s)}j=new Ext.menu.Menu({items:o});i.listValue.menu=j}j.show(l)}}});new Ext.dd.DDTarget(e.id,"target_list");var h=new Ext.Container({layout:"border",region:"center",items:[d,f,e]});i.listRow=f;i.listValue=e;i.listColumn=d;return h},saveCase:function(){var i=this;i.selStatId="";var a=i.listValue.getStore();if(a.getCount()==0){JxHint.alert("没有选择数值字段，不能执行统计！");return}var d=i.listRow.getStore();var f=i.listColumn.getStore();var b=function(u,r){var p=encodeURIComponent;var q="",o="",n="",s="",m="",j="";d.each(function(v){n+="row,";q+=v.get("value")+",";o+=v.get("text")+","});f.each(function(v){n+="col,";q+=v.get("value")+",";o+=v.get("text")+","});if(q.length>0){q=q.substr(0,q.length-1);n=n.substr(0,n.length-1);o=o.substr(0,o.length-1)}a.each(function(v){s+=v.get("value")+",";j+=v.get("coluse")+",";m+=v.get("text").split(" - ")[1]+","});s=s.substr(0,s.length-1);j=j.substr(0,j.length-1);m=m.substr(0,m.length-1);var t=function(w){i.statGrid.selectKeyId=w.keyid;var v=i.statGrid.getStore();v.reload()};var l="funid=sys_stat&eventcode=savecase&statfunid="+i.funid+"&stat_type=2";l+="&keyid="+i.selStatId+"&statname="+p(u)+"&chars="+p(q)+"&is_share="+r;l+="&chartitles="+p(o)+"&nums="+s+"&numtitles="+p(m);l+="&charuse="+n+"&numuse="+j;Request.dataRequest(l,t)};var h=JxUtil.isAdminUser();var e={bodyStyle:"padding:20px 0 0 20px;",items:[{xtype:"textfield",fieldLabel:jx.group.casename,name:"stat_name",value:"透视方案",allowBlank:false,labelSeparator:"*",labelStyle:"color:#0077FF;",maxLength:50},{xtype:"checkbox",hidden:!h,fieldLabel:jx.query.share,name:"is_share"}]};var c={width:400,height:200};var g=function(l,m){var n=l.get("stat_name");if(n.length==0){JxHint.alert(jx.group.usename);return false}var j=l.get("is_share");b(n,j);m.close()};JxUtil.formWindow({formcfg:e,wincfg:c,okcall:g})},exeStat:function(e){var h=this;var a=h.listValue.getStore();if(a.getCount()==0){JxHint.alert("没有选择数值字段，不能执行统计！");return}var b=h.listRow.getStore();var d=h.listColumn.getStore();var i=[],f=[],g=[];b.each(function(j){i.push({colcode:j.get("value"),colname:j.get("text")})});d.each(function(j){f.push({colcode:j.get("value"),colname:j.get("text")})});a.each(function(j){g.push({colcode:j.get("value"),colname:j.get("text"),coluse:j.get("coluse")})});var c={rows:i,cols:f,nums:g};h.pivotexp(c,e,this.fieldRender)},pivotexp:function(h,o,l){var q=o.page.getStore();var m=[];for(var j=0;j<q.getCount();j++){m.push(q.getAt(j).data)}var n=[];q.fields.each(function(u){var t=u.name;var v={name:t,type:u.type.type};var i=l[t];if(i){v.convert=i}n.push(v)});var p=o.define.nodetitle;var e=[];for(var j=0;j<h.nums.length;j++){var b=h.nums[j].coluse;var s={dataIndex:h.nums[j].colcode,header:h.nums[j].colname,width:120,aggregator:b,exportStyle:[{width:120,format:(b=="count")?"General Number":"Fixed",alignment:{horizontal:"Right"}}]};if(b=="count"){s.renderer=function(i){return(!i)?"":parseInt(i)}}e.push(s)}var d=[];for(var j=0;j<h.rows.length;j++){var c=h.rows[j].colcode;var s={dataIndex:c,header:h.rows[j].colname};d.push(s)}var r=[];for(var j=0;j<h.cols.length;j++){var c=h.cols[j].colcode;var s={dataIndex:c,header:h.cols[j].colname};r.push(s)}var f={aggregate:e,leftAxis:d,topAxis:r};var g={config:f,datas:m,fields:n,title:p};var a=Jxstar.path+"/lib/pivot/exp.jsp";window.pivot_params=g;window.open(a)},createCase:function(){var b=this;var e=b.listField.getStore();var c=b.listColumn.getStore();var a=c.getRange(0,c.getCount());e.add(a);c.removeAll();c=b.listRow.getStore();a=c.getRange(0,c.getCount());e.add(a);c.removeAll();b.listValue.getStore().removeAll();for(var d=0;d<e.getCount();d++){var f=b.listField.getNode(d);if(!f.id||f.id.length==0){f.id="rec_"+e.getAt(d).id;b.addDragDrop(f,e)}}},clickCase:function(e){var c=this;c.createCase();c.selStatId=e;var g=function(j){var l=ComboData.pivotformula;for(var h=0;h<l.length;h++){if(l[h][0]==j){return l[h][1]}}return""};var d=function(n,j){if(j=="row"||j=="col"){var h=c.listField.getStore();var i=h.find("value",n.colcode);if(i<0){return}var m=(j=="row")?c.listRow:c.listColumn;var o=h.getAt(i);o.set("coluse",j);m.getStore().add(o);h.remove(o)}else{var l=new Ext.data.Record({text:g(n.coluse)+" - "+n.colname,value:n.colcode,coluse:n.coluse});c.listValue.getStore().add(l)}};var b=function(h,l){for(var j=0;j<h.length;j++){d(h[j],l)}};var a=function(h){b(h.cols,"col");b(h.rows,"row");b(h.nums,"num")};var f="funid=sys_stat&pagetype=grid&eventcode=selpivot&keyid="+e;Request.dataRequest(f,a)}})})();var mxBasePath="lib/graph";var onMxInit=function(a){mxConnectionHandler.prototype.connectImage=new mxImage("lib/graph/images/connector.gif",16,16);a.graph.setTooltips(false);a.graph.setConnectable(true);a.graph.connectionHandler.setCreateTarget(true)};var mxCanvas=function(b){var a=function(){var g=document.getElementById("mx_splash");if(g!=null){try{mxEvent.release(g);mxEffects.fadeOut(g,100,true)}catch(h){g.parentNode.removeChild(g)}}};try{if(!mxClient.isBrowserSupported()){mxUtils.error("当前浏览器不支持绘图程序！",200,false)}else{var d=mxUtils.load(b).getDocumentElement();var c=new mxEditor(d);a()}}catch(f){a();mxUtils.alert("不能打开绘图程序："+f.message);throw f}return c};